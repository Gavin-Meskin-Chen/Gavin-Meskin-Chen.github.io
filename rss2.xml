<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>参星阁</title>
    <link>https://gavin-chen.top/</link>
    
    <atom:link href="https://gavin-chen.top/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>南方嘉木的博客</description>
    <pubDate>Tue, 19 Sep 2023 09:42:58 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>点赞组件：让你的博客获得更多赞赏！</title>
      <link>https://gavin-chen.top/post/1c75834d.html</link>
      <guid>https://gavin-chen.top/post/1c75834d.html</guid>
      <pubDate>Tue, 19 Sep 2023 09:18:25 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;预览&quot;&gt;&lt;a href=&quot;#预览&quot; class=&quot;headerlink&quot; title=&quot;预览&quot;&gt;&lt;/a&gt;预览&lt;/h2&gt;&lt;p&gt;&lt;img</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309191713278.webp" alt="点赞组件预览图"></p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>点赞组件主要包括两个功能，一个是加载文章时，显示出最新点赞数，另一个是当用户点击点赞按钮时，点赞数自动加一，同时数据同步到云端数据库。</p><p>对于第一个功能，我设计成每次进入文章时都自动从云端拉取点赞数，主要请求参数为文章的 abbrlink 代码，采用 crc32 算法，一文一码，具有唯一性，也可以作为数据库的主键使用。文章的 abbrlink 可通过 window.location.pathname 得到。</p><p>对于第二个功能，为了避免同一用户重复点赞，我增加了一项 IP 参数，一篇文章一个 IP 只能点赞一次，当然，对于代理 IP 是无法识别的。由于 IP 的固定性，所以在网站首次加载时便将 IP 地址存入全局变量中，无需每次请求都获取一次 IP。</p><h2 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h2><p>数据库依旧采用 Supabase，新建一个 LikeCount 表，设三个键：index、count、ips，其中 index 为主键，保存文章 abbrlink 码，count 为点赞数，ips 为用户 IP 地址。表内无需插值，遇到新文章的请求，后端会自动在表中新建一行数据。</p><p>仿照 <a href="/post/602922a7.html">上篇文章</a> 的后端部分内容，补充以下代码即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章点赞计数</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/likecount&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mode = req.<span class="property">query</span>.<span class="property">mode</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> id = req.<span class="property">query</span>.<span class="property">id</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="string">&#x27;get&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: filterData, <span class="attr">error</span>: error1 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&#x27;LikeCount&#x27;</span>)</span><br><span class="line">        .<span class="title function_">select</span>()</span><br><span class="line">        .<span class="title function_">eq</span>(<span class="string">&#x27;index&#x27;</span>, id)</span><br><span class="line">      <span class="keyword">if</span> (error1) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error1);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;404&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;查询失败&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!filterData.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; <span class="attr">data</span>: insertData, <span class="attr">error</span>: error2 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">              .<span class="title function_">from</span>(<span class="string">&#x27;LikeCount&#x27;</span>)</span><br><span class="line">              .<span class="title function_">insert</span>([</span><br><span class="line">                &#123; <span class="attr">index</span>: id, <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">              ])</span><br><span class="line">              .<span class="title function_">select</span>()</span><br><span class="line">            <span class="keyword">if</span> (error2) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error2);</span><br><span class="line">              res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;500&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;新文章录入失败&#x27;</span>, <span class="attr">content</span>: insertData &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;201&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;新文章录入成功&#x27;</span>, <span class="attr">content</span>: insertData &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data Search completely&#x27;</span>);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;200&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;查询成功&#x27;</span>, <span class="attr">content</span>: filterData &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="string">&#x27;add&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> ip = req.<span class="property">query</span>.<span class="property">ip</span>.<span class="title function_">toString</span>();</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: oldData, <span class="attr">error</span>: error3 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&#x27;LikeCount&#x27;</span>)</span><br><span class="line">        .<span class="title function_">select</span>()</span><br><span class="line">        .<span class="title function_">eq</span>(<span class="string">&#x27;index&#x27;</span>, id)</span><br><span class="line">      <span class="keyword">if</span> (error3) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error3);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;404&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;查询失败&#x27;</span>, <span class="attr">content</span>: oldData &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ips = oldData[<span class="number">0</span>].<span class="property">ips</span></span><br><span class="line">        <span class="keyword">if</span> (ips.<span class="title function_">includes</span>(ip)) &#123;</span><br><span class="line">          res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;205&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;您已经点过赞啦&#x27;</span>, <span class="attr">content</span>: oldData &#125;);      </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> ipsArray = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(ips)</span><br><span class="line">          ipsArray.<span class="title function_">push</span>(ip)</span><br><span class="line">          <span class="keyword">var</span> newIps = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ipsArray)</span><br><span class="line">          <span class="keyword">var</span> newNum = oldData[<span class="number">0</span>].<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">          <span class="keyword">const</span> &#123; <span class="attr">data</span>: updateData, <span class="attr">error</span>: error4 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">            .<span class="title function_">from</span>(<span class="string">&#x27;LikeCount&#x27;</span>)</span><br><span class="line">            .<span class="title function_">update</span>(&#123; <span class="attr">count</span>: newNum, <span class="attr">ips</span>: newIps &#125;)</span><br><span class="line">            .<span class="title function_">eq</span>(<span class="string">&#x27;index&#x27;</span>, id)</span><br><span class="line">            .<span class="title function_">select</span>()</span><br><span class="line">          <span class="keyword">if</span> (error4) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error4);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">501</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;501&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;更新失败&#x27;</span>, <span class="attr">content</span>: oldData &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data update completely&#x27;</span>);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&#x27;200&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;更新成功&#x27;</span>, <span class="attr">content</span>: updateData &#125;);</span><br><span class="line">          &#125; </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Internal Server Error&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h2><p>前端设计按个人喜好，我是将点赞按钮和打赏按钮组合在一起，毕竟赞赏嘛，先赞再赏嘛哈哈哈哈。</p><p>修改 themes/butterfly/layout/includes/post/reward.pug 路径文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.post-reward</span><br><span class="line">  .like-button(onclick=&#x27;ctrl.sendArticleLike()&#x27;)</span><br><span class="line">    i.fas.fa-thumbs-up</span><br><span class="line">    = &#x27; 赞 &#x27;</span><br><span class="line">    span.like-count= &#x27;0&#x27;</span><br><span class="line">    span.load</span><br><span class="line">      i.fas.fa-spinner.fa-spin</span><br><span class="line">  .reward-button</span><br><span class="line">    i.fas.fa-qrcode</span><br><span class="line">    = &#x27; &#x27; + _p(&#x27;donate&#x27;)</span><br><span class="line">    .reward-main</span><br><span class="line">      ul.reward-all</span><br><span class="line">        each item in theme.reward.QR_code</span><br><span class="line">          - var clickTo = item.link ? item.link : item.img</span><br><span class="line">          li.reward-item</span><br><span class="line">            a(href=url_for(clickTo) data-fancybox=&#x27;gallery&#x27; target=&#x27;_blank&#x27;)</span><br><span class="line">              img.post-qr-code-img(src=url_for(item.img) alt=item.text)</span><br><span class="line">            .post-qr-code-desc=item.text</span><br></pre></td></tr></table></figure><p>修改 themes\butterfly\source\css_layout\reward.styl 路径文件：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.post-reward</span></span><br><span class="line">  <span class="attribute">position</span>: relative</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">80px</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line">  <span class="attribute">text-align</span>: center</span><br><span class="line">  <span class="attribute">pointer-events</span>: none</span><br><span class="line">  <span class="attribute">display</span>: flex</span><br><span class="line">  <span class="attribute">justify-content</span>: center</span><br><span class="line">  <span class="attribute">gap</span>: <span class="number">10px</span></span><br><span class="line"></span><br><span class="line">  &amp; &gt; *</span><br><span class="line">    <span class="attribute">pointer-events</span>: auto</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.like-button</span></span><br><span class="line">    <span class="attribute">display</span>: inline-block</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">12px</span></span><br><span class="line">    <span class="attribute">background</span>: red</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,.<span class="number">8</span>)</span><br><span class="line">    <span class="attribute">cursor</span>: pointer</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5rem</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span></span><br><span class="line">    <span class="attribute">pointer-events</span>: all</span><br><span class="line">    <span class="selector-pseudo">&amp;:not</span>(.loading)<span class="selector-pseudo">:hover</span></span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">90</span>, <span class="number">90</span>)</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-class">.loading</span></span><br><span class="line">      <span class="attribute">cursor</span>: default</span><br><span class="line">      <span class="attribute">pointer-events</span>: none</span><br><span class="line">      <span class="selector-class">.like-count</span></span><br><span class="line">        <span class="attribute">display</span>: none</span><br><span class="line">      <span class="selector-class">.load</span></span><br><span class="line">        <span class="attribute">display</span>: inline-block</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.like-count</span></span><br><span class="line">      <span class="attribute">width</span>: <span class="number">20px</span></span><br><span class="line">      <span class="attribute">display</span>: inline-block</span><br><span class="line">    <span class="selector-class">.load</span></span><br><span class="line">      <span class="attribute">width</span>: <span class="number">20px</span></span><br><span class="line">      <span class="attribute">display</span>: none</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.reward-button</span></span><br><span class="line">    <span class="attribute">display</span>: inline-block</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">4px</span> <span class="number">12px</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--gavin-blue3)</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,.<span class="number">8</span>)</span><br><span class="line">    <span class="attribute">cursor</span>: pointer</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5rem</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span></span><br><span class="line">    <span class="selector-pseudo">&amp;:hover</span></span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">var</span>(--gavin-blue1)</span><br><span class="line"></span><br><span class="line">      &amp; &gt; <span class="selector-class">.reward-main</span></span><br><span class="line">        <span class="attribute">display</span>: block</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.reward-main</span></span><br><span class="line">    <span class="attribute">position</span>: absolute</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">40px</span></span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span></span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span></span><br><span class="line">    <span class="attribute">display</span>: none</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.reward-all</span></span><br><span class="line">      <span class="attribute">display</span>: inline-block</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">0</span></span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">10px</span></span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">4px</span></span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">var</span>(--reward-pop)</span><br><span class="line"></span><br><span class="line">      <span class="selector-pseudo">&amp;:before</span></span><br><span class="line">        <span class="attribute">position</span>: absolute</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="number">10px</span></span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="selector-pseudo">&amp;:after</span></span><br><span class="line">        <span class="attribute">position</span>: absolute</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">2px</span></span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span> auto</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">height</span>: <span class="number">0</span></span><br><span class="line">        <span class="attribute">border-top</span>: <span class="number">13px</span> solid <span class="built_in">var</span>(--reward-pop)</span><br><span class="line">        <span class="attribute">border-right</span>: <span class="number">13px</span> solid transparent</span><br><span class="line">        <span class="attribute">border-left</span>: <span class="number">13px</span> solid transparent</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.reward-item</span></span><br><span class="line">        <span class="attribute">display</span>: inline-block</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">8px</span></span><br><span class="line">        <span class="attribute">list-style-type</span>: none</span><br><span class="line">        <span class="attribute">vertical-align</span>: top</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">img</span></span><br><span class="line">          <span class="attribute">width</span>: <span class="number">110px</span></span><br><span class="line">          <span class="attribute">height</span>: <span class="number">110px</span></span><br><span class="line"></span><br><span class="line">        <span class="selector-class">.post-qr-code-desc</span></span><br><span class="line">          <span class="attribute">width</span>: <span class="number">110px</span></span><br><span class="line">          <span class="attribute">line-height</span>: <span class="number">1</span></span><br><span class="line">          <span class="attribute">font-size</span>: <span class="number">90%</span></span><br><span class="line">          <span class="attribute">color</span>: <span class="variable">$reward</span>-pop-up-color</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/Butterfly/">Butterfly</category>
      
      <category domain="https://gavin-chen.top/tags/node-js/">node.js</category>
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</category>
      
      
      <comments>https://gavin-chen.top/post/1c75834d.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>给友链朋友圈加上收藏栏</title>
      <link>https://gavin-chen.top/post/602922a7.html</link>
      <guid>https://gavin-chen.top/post/602922a7.html</guid>
      <pubDate>Mon, 18 Sep 2023 09:40:15 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;最近逛友链博客，发现 &lt;a href=&quot;https://blog.leonus.cn/&quot;&gt;Leonus&lt;/a&gt; 大佬又搞了不少新活，像“&lt;a</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>最近逛友链博客，发现 <a href="https://blog.leonus.cn/">Leonus</a> 大佬又搞了不少新活，像“<a href="https://blog.leonus.cn/fcircle/">博主收藏</a>”、“<a href="https://blog.leonus.cn/link/">友链查询</a>”等等，还有各种外链卡片，都是很实用的功能，非常奈斯啊。今天我也来整一个类似的文章收藏功能。</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>首先要在原本的朋友圈文章卡片上新增一个收藏按钮，点击目标文章卡片上的按钮即可收藏该文章，然后在朋友圈文章列表的上方增加一条收藏栏，在收藏栏中显示所有的收藏文章列表。其次，一般只有博主本人才有权限增删收藏栏的文章，所以还要添加一个密码验证功能。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181152729.webp" alt="收藏栏"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181154316.webp" alt="密码输入框"></p><p>详细效果请前往 <a href="/fcircle/">订阅</a> 页面查看。</p><p>关于收藏栏的后端部分，这里采用的是<code>Github</code>+<code>Supabase</code>+<code>Vercel</code>的方案，另外配有缓存机制，首次进入页面调用云端数据库的数据，重新进入页面则调用本地缓存，缓存设有 1 天的有效期，过期后会自动拉取云端数据库以更新本地缓存。另外为实现多端同步，在收藏栏右上角设有刷新按钮，可以实现一键同步。收藏栏默认显示两行，多余部分折叠隐藏，可点击右上角按钮展开全部内容。</p><h2 id="朋友圈配置"><a href="#朋友圈配置" class="headerlink" title="朋友圈配置"></a>朋友圈配置</h2><p>这个文章收藏是在友链朋友圈的基础上延伸出来的一个附加功能，所以基础是要先配置好友链朋友圈功能。朋友圈我是按照 <a href="https://fcircle-doc.yyyzyyyz.cn/#/deploy">官方文档</a> 配置的，其中后端部分采用的是<code>Github</code>+<code>Sqlite</code>+<code>Vercel</code>的 <a href="https://fcircle-doc.yyyzyyyz.cn/#/backenddeploy?id=githubsqlite%e9%83%a8%e7%bd%b2">无服务器部署</a> 方式，前端部分采用的是 <a href="https://fcircle-doc.yyyzyyyz.cn/#/frontenddeploy?id=%e6%96%b9%e6%a1%88%ef%bc%9a%e6%9e%97%e6%9c%a8%e6%9c%a8">林木木</a> 的方案。林木木的方案不带管理面板，如果需要更改设置的话，会比较麻烦，但优点是代码量少，简短易读，方便我二次修改。</p><p>林木木的朋友圈方案配有一个顶栏，可以显示“订阅”、“活跃”、“日志”等消息，点击“订阅”可以查看随机一个友链的文章列表，点击“活跃”可以切换私有友链库和公共库两种数据源，点击“日志”可以手动清空本地缓存，重新拉取云端数据库。另外支持“创建日期”和“更新日期”两种排列方式，可以自由手动切换。</p><h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><p>Vercel 的 Integrations Marketplace 上提供有很多种数据库，其中 MongoDB Atlas 之前在部署 twikoo 评论的时候用过，Upstash 在配置个人网盘的时候用过，听群友推荐说 PlanetScale 和 Supabase 也不错。这里采用 Supabase 作为项目云端数据存储。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181410259.webp" alt="Databases in Integrations Marketplace"></p><p>注册 <a href="https://supabase.com/">Supabase</a> 后进入 Dashboard，首先点击 New project 创建一个新的项目，设置项目名称和数据库密码，选择合适的地区，然后确认创建。整个创建过程有点长，需要耐心等待几十秒的时间。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181513346.webp" alt="Create a new project"></p><p>创建完成会自动进入项目，页面左侧有一条纵向菜单栏，点击 Table Editor 可以对数据库进行可视化操作，点击 SQL Editor 可以进行命令行操作，这对于小白来说还是非常方便的。我们进入 Table Editor 点击 New table 创建一个新数据表，设置好表名、描述，最重要的是各列的参数配置，默认的 Column 有 id 和 created_at 两列，点击 Add column 新增几条参数，分别是 index、title、link、author、avatar、time 六个参数，参数类型均设置为 text，点击 save 保存。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181516521.webp" alt="Create a new table"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181545572.webp" alt="Add columns"></p><p>进入数据表，点击 Insert 可以手动插入数据，因为是可视化界面，增删改查都十分直观。当然我们不需要在这里插入数据，而是要能够在外部调用它的增删改查能力。在左侧菜单栏中点击 API Docs 可以查看详细的使用方法，其中，Introduction 栏提供了初始化代码。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createClient &#125; <span class="keyword">from</span> <span class="string">&quot;@supabase/supabase-js&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> supabaseUrl = <span class="string">&quot;https://xxxxxxxxxxxxx.supabase.co&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> supabaseKey = process.<span class="property">env</span>.<span class="property">SUPABASE_KEY</span>;</span><br><span class="line"><span class="keyword">const</span> supabase = <span class="title function_">createClient</span>(supabaseUrl, supabaseKey);</span><br></pre></td></tr></table></figure><p>这里有两个重要参数<code>supabaseUrl</code>和<code>supabaseKey</code>，需要在设置里面查找。点击左侧菜单栏中的 Project Settings，点击 API 栏，其中 Project URL 即为 supabaseUrl，Project API keys 即为 supabaseKey。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181650740.webp" alt="获取supabaseUrl和supabaseKey"></p><p>回到 API Docs，在 Tables and Views 栏找到刚刚新建的表名，进入文档后可以看到详细的增删改查示例代码。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202309181657578.webp" alt="示例代码"></p><h2 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h2><p>Github 新建一个私有仓库，仓库内主要包含 3 个文件，内容如下。</p><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3><p>注意这里 supabaseUrl 做了脱敏处理，要替换成自己的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入所需包和模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).<span class="title function_">config</span>(); <span class="comment">// 导入 dotenv 并加载 .env 文件</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET, POST, PUT, DELETE&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type, Authorization&quot;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 创建 Express 应用程序</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">const</span> savedKey = process.<span class="property">env</span>.<span class="property">KEY</span>;</span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">const</span> &#123; createClient &#125; = <span class="built_in">require</span>(<span class="string">&quot;@supabase/supabase-js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> supabaseUrl = <span class="string">&quot;https://xxxxxxxxxxxxxxxxx.supabase.co&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> supabaseKey = process.<span class="property">env</span>.<span class="property">SUPABASE_KEY</span>;</span><br><span class="line"><span class="keyword">const</span> supabase = <span class="title function_">createClient</span>(supabaseUrl, supabaseKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增收藏</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/subscribe&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = req.<span class="property">query</span>.<span class="property">key</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> index = req.<span class="property">query</span>.<span class="property">index</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> title = req.<span class="property">query</span>.<span class="property">title</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> link = req.<span class="property">query</span>.<span class="property">link</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> author = req.<span class="property">query</span>.<span class="property">author</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> avatar = req.<span class="property">query</span>.<span class="property">avatar</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> time = req.<span class="property">query</span>.<span class="property">time</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (key == savedKey) &#123;</span><br><span class="line">      <span class="comment">// 存入数据库</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: filterData, <span class="attr">error</span>: error1 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&quot;Subscribe&quot;</span>)</span><br><span class="line">        .<span class="title function_">select</span>()</span><br><span class="line">        .<span class="title function_">eq</span>(<span class="string">&quot;index&quot;</span>, index);</span><br><span class="line">      <span class="keyword">if</span> (error1) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error1);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;500&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;查询失败&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!filterData.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; <span class="attr">data</span>: createdData, <span class="attr">error</span>: error2 &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">            .<span class="title function_">from</span>(<span class="string">&quot;Subscribe&quot;</span>)</span><br><span class="line">            .<span class="title function_">insert</span>([</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">index</span>: index,</span><br><span class="line">                <span class="attr">title</span>: title,</span><br><span class="line">                <span class="attr">link</span>: link,</span><br><span class="line">                <span class="attr">author</span>: author,</span><br><span class="line">                <span class="attr">avatar</span>: avatar,</span><br><span class="line">                <span class="attr">time</span>: time,</span><br><span class="line">              &#125;,</span><br><span class="line">            ])</span><br><span class="line">            .<span class="title function_">select</span>();</span><br><span class="line">          <span class="keyword">if</span> (error2) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error2);</span><br><span class="line">            res</span><br><span class="line">              .<span class="title function_">status</span>(<span class="number">500</span>)</span><br><span class="line">              .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;500&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;存储失败&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Data stored successfully:&quot;</span>, createdData[<span class="number">0</span>]);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">              <span class="attr">code</span>: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&quot;存储成功&quot;</span>,</span><br><span class="line">              <span class="attr">content</span>: createdData[<span class="number">0</span>],</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          res</span><br><span class="line">            .<span class="title function_">status</span>(<span class="number">402</span>)</span><br><span class="line">            .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;402&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;文章已存在&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;401&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;密码错误&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Internal Server Error&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章删除</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/delsavedtitles&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = req.<span class="property">query</span>.<span class="property">key</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> index = req.<span class="property">query</span>.<span class="property">index</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (key == savedKey) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&quot;Subscribe&quot;</span>)</span><br><span class="line">        .<span class="title function_">delete</span>()</span><br><span class="line">        .<span class="title function_">eq</span>(<span class="string">&quot;index&quot;</span>, index);</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;500&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;删除失败&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!data.<span class="property">length</span>) &#123;</span><br><span class="line">          res</span><br><span class="line">            .<span class="title function_">status</span>(<span class="number">404</span>)</span><br><span class="line">            .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;404&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;未找到文章&quot;</span>, <span class="attr">content</span>: data &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Data delete completely&quot;</span>);</span><br><span class="line">          res</span><br><span class="line">            .<span class="title function_">status</span>(<span class="number">200</span>)</span><br><span class="line">            .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;删除成功&quot;</span>, <span class="attr">content</span>: data &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;401&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;密码错误&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Internal Server Error&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收藏文章查询</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/getsavedtitles&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mode = req.<span class="property">query</span>.<span class="property">mode</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> column = req.<span class="property">query</span>.<span class="property">column</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> value = req.<span class="property">query</span>.<span class="property">value</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="string">&quot;search&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: filterData, error &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&quot;Subscribe&quot;</span>)</span><br><span class="line">        .<span class="title function_">select</span>()</span><br><span class="line">        .<span class="title function_">eq</span>(column, value);</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;404&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;查询失败&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Data serach completely:&quot;</span>, filterData);</span><br><span class="line">        res</span><br><span class="line">          .<span class="title function_">status</span>(<span class="number">200</span>)</span><br><span class="line">          .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;查询成功&quot;</span>, <span class="attr">content</span>: filterData &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="string">&quot;all&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: filterData, error &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">        .<span class="title function_">from</span>(<span class="string">&quot;Subscribe&quot;</span>)</span><br><span class="line">        .<span class="title function_">select</span>();</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;404&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;查询失败&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="string">&quot;all&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Data serach completely:&quot;</span>, filterData);</span><br><span class="line">        res</span><br><span class="line">          .<span class="title function_">status</span>(<span class="number">200</span>)</span><br><span class="line">          .<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;查询成功&quot;</span>, <span class="attr">content</span>: filterData &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="string">&quot;401&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;参数错误&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Internal Server Error&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line"><span class="keyword">const</span> server = app.<span class="title function_">listen</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> port = server.<span class="title function_">address</span>().<span class="property">port</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;projectname&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Echo \&quot;error: error\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node index.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MIT&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;axios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.27.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.18.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dotenv&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@supabase/supabase-js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="vercel-json"><a href="#vercel-json" class="headerlink" title="vercel.json"></a>vercel.json</h3><p>注意 KEY 和 SUPABASE_KEY 要换成自己的，其中<code>KEY</code>为 SHA256 加密后的前端身份验证密码，<code>SUPABASE_KEY</code>为 Supabase 密钥。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;builds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;use&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@vercel/node&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/(.*)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;SUPABASE_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>仓库建好后，部署到 Vercel 上，在 Storage 栏进入 Integrations Marketplace 找到 Supabase，点击 Add Integration 将其添加进项目。然后就是配置自定义域名，自此后端配置完成。</p><h2 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h2><h3 id="index-md"><a href="#index-md" class="headerlink" title="index.md"></a>index.md</h3><p>打开先前在配置友链朋友圈的时候创建的 /fcircle/index.md，配置如下：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 订阅</span><br><span class="line">descr: 使用 友链朋友圈 订阅友链最新文章</span><br><span class="line">cover: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"><span class="section">date: xxxxxxxxxxxxxxxxxxxxxxx</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;我的收藏&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    我的收藏</span></span><br><span class="line"><span class="code">    &lt;a class=&quot;refresh&quot; onclick=&quot;localStorage.removeItem(&#x27;savedArticles&#x27;);location.reload();&quot;&gt;</span></span><br><span class="line"><span class="code">        &lt;i class=&quot;blogfont icon-refresh&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="code">    &lt;/a&gt;</span></span><br><span class="line"><span class="code">    &lt;a class=&quot;fold&quot; onclick=&quot;foldSavedArticles(event)&quot;&gt;</span></span><br><span class="line"><span class="code">        &lt;i class=&quot;blogfont icon-arrow-down&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="code">    &lt;/a&gt;</span></span><br><span class="line"><span class="code">&lt;/h2&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;cf-saved-post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;最新文章&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    最新文章</span></span><br><span class="line"><span class="code">&lt;/h2&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;div id=&quot;cf-container&quot;&gt;</span></span><br><span class="line"><span class="code">        与主机通讯中……</span></span><br><span class="line"><span class="code">    &lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/div&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inputBoxMain&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fcircleInputBox&quot;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inputBox&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;div class=&quot;content-body&quot;&gt;</span></span><br><span class="line"><span class="code">      &lt;span class=&quot;title&quot;&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="code">      &lt;span class=&quot;tips&quot;&gt;请输入密码以验证您的身份&lt;/span&gt;</span></span><br><span class="line"><span class="code">      &lt;input class=&quot;input-password&quot; type=&quot;password&quot; placeholder=&quot;密码&quot;&gt;</span></span><br><span class="line"><span class="code">    &lt;/div&gt;</span></span><br><span class="line"><span class="code">    &lt;div class=&quot;content-bottom&quot;&gt;</span></span><br><span class="line"><span class="code">      &lt;span class=&quot;btn close&quot; onclick=&quot;switchSecretInput()&quot;&gt;取消&lt;/span&gt;</span></span><br><span class="line"><span class="code">      &lt;span class=&quot;btn&quot; onclick=&quot;sendSubscribeInfo()&quot;&gt;确认&lt;/span&gt;</span></span><br><span class="line"><span class="code">    &lt;/div&gt;</span></span><br><span class="line"><span class="code">  &lt;/div&gt;</span></span><br><span class="line"><span class="code">  &lt;div class=&quot;noteBox hide&quot;&gt;</span></span><br><span class="line"><span class="code">    &lt;a class=&quot;icon&quot;&gt;</span></span><br><span class="line"><span class="code">      &lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="code">    &lt;/a&gt;</span></span><br><span class="line"><span class="code">    &lt;span class=&quot;tips&quot;&gt;请稍候 ...&lt;/span&gt;</span></span><br><span class="line"><span class="code">  &lt;/div&gt;</span></span><br><span class="line"><span class="code">  &lt;div class=&quot;inputBoxMask&quot;&gt;</span></span><br><span class="line"><span class="code">  &lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/div&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    var fdataUser = &#123;</span></span><br><span class="line"><span class="code">      apiurl: &#x27;https://xxx.xxx.top/&#x27;</span></span><br><span class="line"><span class="code">    &#125;;</span></span><br><span class="line"><span class="code">    var article_index = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_title = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_link = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_author = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_avatar = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_time = &#x27;&#x27;,</span></span><br><span class="line"><span class="code">        article_pwd = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">    var savedArticlesIndex = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">    var catchNowTime = Date.now();</span></span><br><span class="line"><span class="code">    var updateTime = localStorage.getItem(&quot;updateTime&quot;);</span></span><br><span class="line"><span class="code">    updateTime == null || catchNowTime - updateTime &lt; 86400000 ? null : localStorage.removeItem(&quot;savedArticles&quot;);//每隔1天刷新一次</span></span><br><span class="line"><span class="code">    var savedArticles = localStorage.getItem(&quot;savedArticles&quot;);</span></span><br><span class="line"><span class="code">    if (savedArticles != null) &#123;</span></span><br><span class="line"><span class="code">        console.log(&quot;内存读取成功&quot;);</span></span><br><span class="line"><span class="code">        var savedArticlesJson = JSON.parse(savedArticles)</span></span><br><span class="line"><span class="code">        addArticleCard(savedArticlesJson);</span></span><br><span class="line"><span class="code">        savedArticlesIndex = savedArticlesJson.map(item =&gt; item.index);</span></span><br><span class="line"><span class="code">    &#125; else &#123;</span></span><br><span class="line"><span class="code">        fetch(&quot;https://xxx.xxx.top/getsavedtitles?mode=all&amp;column=&amp;value=&amp;output=jsonp&quot;)</span></span><br><span class="line"><span class="code">            .then(response =&gt; response.json())</span></span><br><span class="line"><span class="code">            .then(data =&gt; &#123;</span></span><br><span class="line"><span class="code">                if (data.code == 200) &#123;</span></span><br><span class="line"><span class="code">                    console.log(&#x27;获取收藏夹成功&#x27;);</span></span><br><span class="line"><span class="code">                    savedArticles = data.content;</span></span><br><span class="line"><span class="code">                    localStorage.setItem(&quot;updateTime&quot;, catchNowTime);</span></span><br><span class="line"><span class="code">                    localStorage.setItem(&quot;savedArticles&quot;, JSON.stringify(savedArticles));</span></span><br><span class="line"><span class="code">                    console.log(savedArticles);</span></span><br><span class="line"><span class="code">                    addArticleCard(savedArticles);</span></span><br><span class="line"><span class="code">                    savedArticlesIndex = savedArticles.map(item =&gt; item.index);</span></span><br><span class="line"><span class="code">                    console.log(savedArticlesIndex);</span></span><br><span class="line"><span class="code">                    checkStared(savedArticlesIndex);</span></span><br><span class="line"><span class="code">                &#125; else &#123;</span></span><br><span class="line"><span class="code">                    console.log(&#x27;获取收藏夹失败&#x27;)</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">            &#125;)</span></span><br><span class="line"><span class="code">            .catch(error =&gt; &#123;</span></span><br><span class="line"><span class="code">                console.error(&#x27;获取收藏夹失败&#x27;, error);</span></span><br><span class="line"><span class="code">            &#125;)</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    function checkStared(s) &#123;</span></span><br><span class="line"><span class="code">        for (let i = 0; i &lt; s.length; i++) &#123;</span></span><br><span class="line"><span class="code">            var j = document.querySelector(&quot;#cf-container .&quot; + s[i] + &quot; .cf-star&quot;);</span></span><br><span class="line"><span class="code">            if (j) &#123;</span></span><br><span class="line"><span class="code">                j.classList.contains(&quot;saved&quot;) ? null : j.classList.add(&quot;saved&quot;);</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    function addArticleCard(a) &#123;</span></span><br><span class="line"><span class="code">        var container = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">        for (let i=0; i&lt;a.length; i++) &#123;</span></span><br><span class="line"><span class="code">            var item = a[i];</span></span><br><span class="line"><span class="code">            container += `</span></span><br><span class="line"><span class="code">            &lt;div class=&quot;cf-article $&#123;item.index&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">                &lt;a class=&quot;cf-article-title&quot; href=&quot;$&#123;item.link&#125;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; data-title=&quot;$&#123;item.title&#125;&quot;&gt;$&#123;item.title&#125;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                &lt;a class=&quot;cf-star saved&quot; onclick=&quot;switchSecretInput(event)&quot;&gt;&lt;i class=&quot;fa-regular fa-star&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                &lt;div class=&quot;cf-article-avatar no-lightbox flink-item-icon&quot;&gt;</span></span><br><span class="line"><span class="code">                    &lt;img class=&quot;cf-img-avatar avatar&quot; src=&quot;$&#123;item.avatar&#125;&quot; alt=&quot;avatar&quot; onerror=&quot;this.src=&#x27;&#x27;; this.onerror = null;&quot;&gt;</span></span><br><span class="line"><span class="code">                    &lt;a class=&quot;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot;&gt;&lt;span class=&quot;cf-article-author&quot;&gt;$&#123;item.author&#125;&lt;/span&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                &lt;/div&gt;</span></span><br><span class="line"><span class="code">                &lt;span class=&quot;cf-article-time&quot;&gt;</span></span><br><span class="line"><span class="code">                    &lt;span class=&quot;cf-time-created&quot;&gt;$&#123;item.time&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="code">                &lt;/span&gt;</span></span><br><span class="line"><span class="code">            &lt;/div&gt;</span></span><br><span class="line"><span class="code">            `;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        document.getElementById(&quot;cf-saved-post&quot;).insertAdjacentHTML(&#x27;beforeend&#x27;, container);</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    function switchSecretInput(event) &#123;</span></span><br><span class="line"><span class="code">        const a = document.getElementById(&quot;fcircleInputBox&quot;);</span></span><br><span class="line"><span class="code">        const b = a.querySelector(&quot;.input-password&quot;);</span></span><br><span class="line"><span class="code">        const f = a.querySelector(&quot;.content-body .title&quot;);</span></span><br><span class="line"><span class="code">        function c(e) &#123; article_pwd = e.target.value; &#125;</span></span><br><span class="line"><span class="code">        if (a.classList.contains(&quot;open&quot;)) &#123;</span></span><br><span class="line"><span class="code">            a.classList.remove(&quot;open&quot;);</span></span><br><span class="line"><span class="code">            b.removeEventListener(&#x27;input&#x27;, c);</span></span><br><span class="line"><span class="code">            article_index = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            article_title = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            article_link = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            article_author = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            article_avatar = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            article_time = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">        &#125; else &#123;</span></span><br><span class="line"><span class="code">            a.classList.add(&quot;open&quot;);</span></span><br><span class="line"><span class="code">            b.addEventListener(&#x27;input&#x27;, c);</span></span><br><span class="line"><span class="code">            var d = &#x27;&#x27;;</span></span><br><span class="line"><span class="code">            if (event.target.nodeName.toUpperCase() == &quot;A&quot;) &#123;</span></span><br><span class="line"><span class="code">                if (event.target.classList.contains(&quot;saved&quot;)) &#123;</span></span><br><span class="line"><span class="code">                    sendMode = 1;</span></span><br><span class="line"><span class="code">                    f.innerHTML = &quot;移出收藏&quot;;</span></span><br><span class="line"><span class="code">                &#125; else &#123;</span></span><br><span class="line"><span class="code">                    sendMode = 0;</span></span><br><span class="line"><span class="code">                    f.innerHTML = &quot;添加收藏&quot;;</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">                d = event.target.parentElement.querySelector(&quot;.cf-article-title&quot;);</span></span><br><span class="line"><span class="code">                article_author = event.target.parentElement.querySelector(&quot;.cf-article-avatar .cf-article-author&quot;).innerText;</span></span><br><span class="line"><span class="code">                article_avatar = event.target.parentElement.querySelector(&quot;.cf-article-avatar .cf-img-avatar&quot;).src;</span></span><br><span class="line"><span class="code">                article_time = event.target.parentElement.querySelector(&quot;.cf-article-time .cf-time-created&quot;).innerText;</span></span><br><span class="line"><span class="code">            &#125; else if (event.target.nodeName.toUpperCase() == &quot;I&quot;) &#123;</span></span><br><span class="line"><span class="code">                if (event.target.parentElement.classList.contains(&quot;saved&quot;)) &#123;</span></span><br><span class="line"><span class="code">                    sendMode = 1;</span></span><br><span class="line"><span class="code">                    f.innerHTML = &quot;移出收藏&quot;;</span></span><br><span class="line"><span class="code">                &#125; else &#123;</span></span><br><span class="line"><span class="code">                    sendMode = 0;</span></span><br><span class="line"><span class="code">                    f.innerHTML = &quot;添加收藏&quot;;</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">                d = event.target.parentElement.parentElement.querySelector(&quot;.cf-article-title&quot;);</span></span><br><span class="line"><span class="code">                article_author = event.target.parentElement.parentElement.querySelector(&quot;.cf-article-avatar .cf-article-author&quot;).innerText;</span></span><br><span class="line"><span class="code">                article_avatar = event.target.parentElement.parentElement.querySelector(&quot;.cf-article-avatar .cf-img-avatar&quot;).src;</span></span><br><span class="line"><span class="code">                article_time = event.target.parentElement.parentElement.querySelector(&quot;.cf-article-time .cf-time-created&quot;).innerText;</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">            article_title = d.innerText;</span></span><br><span class="line"><span class="code">            article_link = d.getAttribute(&quot;href&quot;);</span></span><br><span class="line"><span class="code">            article_index = &quot;cf-&quot; + CryptoJS.MD5(article_link).toString();</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;,</span></span><br><span class="line"><span class="code">    function sendSubscribeInfo() &#123;</span></span><br><span class="line"><span class="code">        var key = CryptoJS.SHA256(article_pwd);</span></span><br><span class="line"><span class="code">        var url = sendMode == 1</span></span><br><span class="line"><span class="code">            ? &quot;https://xxx.xxx.top/delsavedtitles?key=&quot; + key + &quot;&amp;index=&quot; + article_index</span></span><br><span class="line"><span class="code">            : &quot;https://xxx.xxx.top/subscribe?key=&quot; + key + &quot;&amp;index=&quot; + article_index + &quot;&amp;title=&quot; + article_title + &quot;&amp;link=&quot; + article_link + &quot;&amp;author=&quot; + article_author + &quot;&amp;avatar=&quot; + article_avatar + &quot;&amp;time=&quot; + article_time;</span></span><br><span class="line"><span class="code">        var inputBox = document.querySelector(&quot;#fcircleInputBox .inputBox&quot;);</span></span><br><span class="line"><span class="code">        var noteBox = document.querySelector(&quot;#fcircleInputBox .noteBox&quot;);</span></span><br><span class="line"><span class="code">        inputBox.classList.add(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">        noteBox.classList.remove(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">        fetch(url)</span></span><br><span class="line"><span class="code">            .then(response =&gt; response.json())</span></span><br><span class="line"><span class="code">            .then(data =&gt; &#123;</span></span><br><span class="line"><span class="code">                if (data.code == 200) &#123;</span></span><br><span class="line"><span class="code">                    var a = document.querySelector(&quot;#cf-saved-post .&quot; + article_index);</span></span><br><span class="line"><span class="code">                    if (a) &#123; a.outerHTML = &quot;&quot;; &#125;</span></span><br><span class="line"><span class="code">                    var b = document.querySelector(&quot;.&quot; + article_index + &quot; .cf-star&quot;);</span></span><br><span class="line"><span class="code">                    if (typeof savedArticlesIndex != &#x27;undefined&#x27;) savedArticlesIndex = savedArticlesIndex.filter(element =&gt; element !== article_index);</span></span><br><span class="line"><span class="code">                    if (b) &#123;b.classList.contains(&quot;saved&quot;) ? b.classList.remove(&quot;saved&quot;) : b.classList.add(&quot;saved&quot;);&#125;</span></span><br><span class="line"><span class="code">                    if (sendMode == 0) &#123;</span></span><br><span class="line"><span class="code">                        var container = `</span></span><br><span class="line"><span class="code">                            &lt;div class=&quot;cf-article $&#123;article_index&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">                                &lt;a class=&quot;cf-article-title&quot; href=&quot;$&#123;article_link&#125;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; data-title=&quot;$&#123;article_title&#125;&quot;&gt;$&#123;article_title&#125;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                                &lt;a class=&quot;cf-star saved&quot; onclick=&quot;switchSecretInput(event)&quot;&gt;&lt;i class=&quot;fa-regular fa-star&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                                &lt;div class=&quot;cf-article-avatar no-lightbox flink-item-icon&quot;&gt;</span></span><br><span class="line"><span class="code">                                    &lt;img class=&quot;cf-img-avatar avatar&quot; src=&quot;$&#123;article_avatar&#125;&quot; alt=&quot;avatar&quot; onerror=&quot;this.src=&#x27;&#x27;; this.onerror = null;&quot;&gt;</span></span><br><span class="line"><span class="code">                                    &lt;a class=&quot;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot;&gt;&lt;span class=&quot;cf-article-author&quot;&gt;$&#123;article_author&#125;&lt;/span&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="code">                                &lt;/div&gt;</span></span><br><span class="line"><span class="code">                                &lt;span class=&quot;cf-article-time&quot;&gt;</span></span><br><span class="line"><span class="code">                                    &lt;span class=&quot;cf-time-created&quot;&gt;$&#123;article_time&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="code">                                &lt;/span&gt;</span></span><br><span class="line"><span class="code">                            &lt;/div&gt;</span></span><br><span class="line"><span class="code">                            `;</span></span><br><span class="line"><span class="code">                        document.getElementById(&quot;cf-saved-post&quot;).insertAdjacentHTML(&#x27;beforeend&#x27;, container);</span></span><br><span class="line"><span class="code">                    &#125;</span></span><br><span class="line"><span class="code">                    tools.showMessage(data.message, &quot;success&quot;, 2);</span></span><br><span class="line"><span class="code">                    localStorage.removeItem(&quot;savedArticles&quot;);</span></span><br><span class="line"><span class="code">                    inputBox.classList.remove(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">                    noteBox.classList.add(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">                    document.querySelector(&quot;#fcircleInputBox .btn.close&quot;).click();</span></span><br><span class="line"><span class="code">                &#125; else &#123;</span></span><br><span class="line"><span class="code">                    tools.showMessage(data.message, &quot;error&quot;, 2);</span></span><br><span class="line"><span class="code">                    inputBox.classList.remove(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">                    noteBox.classList.add(&quot;hide&quot;);</span></span><br><span class="line"><span class="code">                    document.querySelector(&quot;#fcircleInputBox .btn.close&quot;).click();</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">            &#125;)</span></span><br><span class="line"><span class="code">            .catch(error =&gt; &#123;</span></span><br><span class="line"><span class="code">                console.error(&#x27;收藏失败:&#x27;, error);</span></span><br><span class="line"><span class="code">            &#125;)</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    function foldSavedArticles(event) &#123;</span></span><br><span class="line"><span class="code">        var a = document.getElementById(&quot;cf-saved-post&quot;)</span></span><br><span class="line"><span class="code">        var b = event.target.parentElement.querySelector(&quot;i&quot;);</span></span><br><span class="line"><span class="code">        if (b.style.transform == &quot;rotate(180deg)&quot;) &#123;</span></span><br><span class="line"><span class="code">            a.style.maxHeight = &quot;240px&quot;</span></span><br><span class="line"><span class="code">            b.style.transform = &quot;&quot;</span></span><br><span class="line"><span class="code">        &#125; else &#123;</span></span><br><span class="line"><span class="code">            a.style.maxHeight = typeof savedArticlesIndex != &#x27;undefined&#x27; ? (savedArticlesIndex.length * 130 - 20) + &quot;px&quot; : &quot;fit-content&quot;</span></span><br><span class="line"><span class="code">            b.style.transform = &quot;rotate(180deg)&quot;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&lt;/script&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/fcircle.css&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/crypto-js/4.1.1/crypto-js.min.js&quot;</span>&gt;</span></span></span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/fcircle.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="fcircle-js"><a href="#fcircle-js" class="headerlink" title="fcircle,js"></a>fcircle,js</h3><p>fcircle.js 的改动不多，主要是卡片 HTML 结构修改。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Last Modified time : 20220326 15:38 by https://immmmm.com</span></span><br><span class="line"><span class="comment">已适配 FriendCircle 公共库和主库</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//默认数据</span></span><br><span class="line"><span class="keyword">var</span> fdata = &#123;</span><br><span class="line">  <span class="attr">jsonurl</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">apiurl</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">apipublieurl</span>: <span class="string">&quot;https://fcircle-pub.rct.cool/&quot;</span>, <span class="comment">//默认公共库</span></span><br><span class="line">  <span class="attr">initnumber</span>: <span class="number">24</span>, <span class="comment">//首次加载文章数</span></span><br><span class="line">  <span class="attr">stepnumber</span>: <span class="number">12</span>, <span class="comment">//更多加载文章数</span></span><br><span class="line">  <span class="attr">article_sort</span>: <span class="string">&quot;created&quot;</span>, <span class="comment">//文章排序 updated or created</span></span><br><span class="line">  <span class="attr">error_img</span>: <span class="string">&quot;https://xxxxxxxxxxxxxx.webp&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//可通过 var fdataUser 替换默认值</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> fdataUser !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> fdataUser) &#123;</span><br><span class="line">    <span class="keyword">if</span> (fdataUser[key]) &#123;</span><br><span class="line">      fdata[key] = fdataUser[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> article_num = <span class="string">&quot;&quot;</span>,</span><br><span class="line">  sortNow = <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="title class_">UrlNow</span> = <span class="string">&quot;&quot;</span>,</span><br><span class="line">  friends_num = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> container =</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-container&quot;</span>) ||</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;fcircleContainer&quot;</span>);</span><br><span class="line"><span class="comment">// 获取本地 排序值、加载apiUrl，实现记忆效果</span></span><br><span class="line"><span class="keyword">var</span> localSortNow = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sortNow&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> localUrlNow = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;urlNow&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (localSortNow &amp;&amp; localUrlNow) &#123;</span><br><span class="line">  sortNow = localSortNow;</span><br><span class="line">  <span class="title class_">UrlNow</span> = localUrlNow;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  sortNow = fdata.<span class="property">article_sort</span>;</span><br><span class="line">  <span class="keyword">if</span> (fdata.<span class="property">jsonurl</span>) &#123;</span><br><span class="line">    <span class="title class_">UrlNow</span> = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;postjson?jsonlink=&quot;</span> + fdata.<span class="property">jsonurl</span> + <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">    <span class="title class_">UrlNow</span> = fdata.<span class="property">apiurl</span> + <span class="string">&quot;all?&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title class_">UrlNow</span> = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;all?&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前模式：&quot;</span> + <span class="title class_">UrlNow</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;urlNow&quot;</span>, <span class="title class_">UrlNow</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sortNow&quot;</span>, sortNow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印基本信息</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadStatistical</span>(<span class="params">sdata</span>) &#123;</span><br><span class="line">  article_num = sdata.<span class="property">article_num</span>;</span><br><span class="line">  friends_num = sdata.<span class="property">friends_num</span>;</span><br><span class="line">  <span class="keyword">var</span> messageBoard = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div id=&quot;cf-state&quot; class=&quot;cf-new-add&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;cf-state-data&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-data-friends&quot; onclick=&quot;openToShow()&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-label&quot;&gt;订阅&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-message&quot;&gt;<span class="subst">$&#123;sdata.friends_num&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-data-active&quot; onclick=&quot;changeEgg()&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-label&quot;&gt;活跃&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-message&quot;&gt;<span class="subst">$&#123;sdata.active_num&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-data-article&quot; onclick=&quot;clearLocal()&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-label&quot;&gt;日志&lt;/span&gt;</span></span><br><span class="line"><span class="string">          &lt;span class=&quot;cf-message&quot;&gt;<span class="subst">$&#123;sdata.article_num&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;cf-change&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;span id=&quot;cf-change-created&quot; data-sort=&quot;created&quot; onclick=&quot;changeSort(event)&quot; class=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            sortNow == <span class="string">&quot;created&quot;</span> ? <span class="string">&quot;cf-change-now&quot;</span> : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          &#125;</span>&quot;&gt;Created&lt;/span&gt; | &lt;span id=&quot;cf-change-updated&quot; data-sort=&quot;updated&quot; onclick=&quot;changeSort(event)&quot; class=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    sortNow == <span class="string">&quot;updated&quot;</span> ? <span class="string">&quot;cf-change-now&quot;</span> : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;</span>&quot; &gt;Updated&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  <span class="keyword">var</span> loadMoreBtn = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;cf-more&quot; class=&quot;cf-new-add&quot; onclick=&quot;loadNextArticle()&quot;&gt;&lt;i class=&quot;fas fa-angle-double-down&quot;&gt;&lt;/i&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;cf-footer&quot; class=&quot;cf-new-add&quot;&gt;</span></span><br><span class="line"><span class="string">       &lt;span id=&quot;cf-version-up&quot; onclick=&quot;checkVersion()&quot;&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">       &lt;span class=&quot;cf-data-lastupdated&quot;&gt;更新于：<span class="subst">$&#123;sdata.last_updated_time&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        Powered by &lt;a target=&quot;_blank&quot; href=&quot;https://github.com/Rock-Candy-Tea/hexo-circle-of-friends&quot; target=&quot;_blank&quot;&gt;FriendCircle&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;br&gt;</span></span><br><span class="line"><span class="string">        Designed by &lt;a target=&quot;_blank&quot; href=&quot;https://immmmm.com&quot; target=&quot;_blank&quot;&gt;林木木&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;br&gt;</span></span><br><span class="line"><span class="string">        Adapted by &lt;a target=&quot;_blank&quot; href=&quot;https://gavin-chen.top&quot; target=&quot;_blank&quot;&gt;南方嘉木&lt;/a&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;cf-overlay&quot; class=&quot;cf-new-add&quot; onclick=&quot;closeShow()&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div id=&quot;cf-overshow&quot; class=&quot;cf-new-add&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  <span class="keyword">if</span> (container) &#123;</span><br><span class="line">    container.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;beforebegin&quot;</span>, messageBoard);</span><br><span class="line">    container.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;afterend&quot;</span>, loadMoreBtn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印文章内容 cf-article          &lt;span class=&quot;cf-article-floor&quot;&gt;$&#123;item.floor&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadArticleItem</span>(<span class="params">datalist, start, end</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> articleItem = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> articleNum = article_num;</span><br><span class="line">  <span class="keyword">var</span> endFor = end;</span><br><span class="line">  <span class="keyword">if</span> (end &gt; articleNum) &#123;</span><br><span class="line">    endFor = articleNum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (start &lt; articleNum) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; endFor; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> item = datalist[i];</span><br><span class="line">      <span class="keyword">var</span> id = <span class="string">&quot;cf-&quot;</span> + <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(item.<span class="property">link</span>).<span class="title function_">toString</span>();</span><br><span class="line">      articleItem += <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-article <span class="subst">$&#123;id&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;cf-article-title&quot; href=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">              item.link</span></span></span><br><span class="line"><span class="subst"><span class="string">            &#125;</span>&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; data-title=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        item.title</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>&quot;&gt;<span class="subst">$&#123;item.title&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;cf-star&quot; onclick=&quot;switchSecretInput(event)&quot;&gt;&lt;i class=&quot;fa-regular fa-star&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;cf-article-avatar no-lightbox flink-item-icon&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;img class=&quot;cf-img-avatar avatar&quot; src=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  item.avatar</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot; alt=&quot;avatar&quot; onerror=&quot;this.src=&#x27;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        fdata.error_img</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>&#x27;; this.onerror = null;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;a onclick=&quot;openMeShow(event)&quot; data-link=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  item.link</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot; class=&quot;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; href=&quot;javascript:;&quot;&gt;&lt;span class=&quot;cf-article-author&quot;&gt;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        item.author</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span>&lt;/span&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;cf-article-time&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;cf-time-created&quot; style=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  sortNow == <span class="string">&quot;created&quot;</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot;&gt;<span class="subst">$&#123;item.created&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;cf-time-updated&quot; style=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  sortNow == <span class="string">&quot;updated&quot;</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot;&gt;<span class="subst">$&#123;item.updated&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    container.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;beforeend&quot;</span>, articleItem);</span><br><span class="line">    <span class="keyword">if</span> (savedArticlesIndex != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">checkStared</span>(savedArticlesIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 预载下一页文章</span></span><br><span class="line">    <span class="title function_">fetchNextArticle</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 文章加载到底</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(</span><br><span class="line">      <span class="string">&quot;cf-more&quot;</span></span><br><span class="line">    ).<span class="property">outerHTML</span> = <span class="string">`&lt;div id=&quot;cf-more&quot; class=&quot;cf-new-add&quot; onclick=&quot;loadNoArticle()&quot;&gt;&lt;small&gt;一切皆有尽头！&lt;/small&gt;&lt;/div&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印个人卡片 cf-overshow</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadFcircleShow</span>(<span class="params">userinfo, articledata</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> showHtml = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-overshow&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;div class=&quot;cf-overshow-head&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;img class=&quot;cf-img-avatar avatar&quot; src=&quot;<span class="subst">$&#123;userinfo.avatar&#125;</span>&quot; alt=&quot;avatar&quot; onerror=&quot;this.src=&#x27;<span class="subst">$&#123;fdata.error_img&#125;</span>&#x27;; this.onerror = null;&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; href=&quot;<span class="subst">$&#123;userinfo.link&#125;</span>&quot;&gt;<span class="subst">$&#123;userinfo.name&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">          &lt;div class=&quot;cf-overshow-content&quot;&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; userinfo.<span class="property">article_num</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = articledata[i];</span><br><span class="line">    showHtml += <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;a class=&quot;cf-article-title&quot;  href=&quot;<span class="subst">$&#123;item.link&#125;</span>&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; data-title=&quot;<span class="subst">$&#123;item.title&#125;</span>&quot;&gt;<span class="subst">$&#123;item.title&#125;</span>&lt;/a&gt;&lt;span&gt;<span class="subst">$&#123;item.created&#125;</span>&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  showHtml += <span class="string">&quot;&lt;/div&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span></span><br><span class="line">    .<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overshow&quot;</span>)</span><br><span class="line">    .<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;beforeend&quot;</span>, showHtml);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overshow&quot;</span>).<span class="property">className</span> = <span class="string">&quot;cf-show-now&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预载下一页文章，存为本地数据 nextArticle</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchNextArticle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> start = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;#cf-container .cf-article&quot;</span>).<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">var</span> end = start + fdata.<span class="property">stepnumber</span>;</span><br><span class="line">  <span class="keyword">var</span> articleNum = article_num;</span><br><span class="line">  <span class="keyword">if</span> (end &gt; articleNum) &#123;</span><br><span class="line">    end = articleNum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (start &lt; articleNum) &#123;</span><br><span class="line">    <span class="title class_">UrlNow</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;urlNow&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> fetchUrl =</span><br><span class="line">      <span class="title class_">UrlNow</span> + <span class="string">&quot;rule=&quot;</span> + sortNow + <span class="string">&quot;&amp;start=&quot;</span> + start + <span class="string">&quot;&amp;end=&quot;</span> + end;</span><br><span class="line">    <span class="comment">//console.log(fetchUrl)</span></span><br><span class="line">    <span class="title function_">fetch</span>(fetchUrl)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> nextArticle = <span class="built_in">eval</span>(json.<span class="property">article_data</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;已预载&quot;</span> + <span class="string">&quot;?rule=&quot;</span> + sortNow + <span class="string">&quot;&amp;start=&quot;</span> + start + <span class="string">&quot;&amp;end=&quot;</span> + end</span><br><span class="line">        );</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;nextArticle&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(nextArticle));</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((start = articleNum)) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(</span><br><span class="line">      <span class="string">&quot;cf-more&quot;</span></span><br><span class="line">    ).<span class="property">outerHTML</span> = <span class="string">`&lt;div id=&quot;cf-more&quot; class=&quot;cf-new-add&quot; onclick=&quot;loadNoArticle()&quot;&gt;&lt;small&gt;一切皆有尽头！&lt;/small&gt;&lt;/div&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 显示下一页文章，从本地缓存 nextArticle 中获取          &lt;span class=&quot;cf-article-floor&quot;&gt;$&#123;item.floor&#125;&lt;/span&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadNextArticle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> nextArticle = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;nextArticle&quot;</span>));</span><br><span class="line">  <span class="keyword">var</span> articleItem = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nextArticle.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> item = nextArticle[i];</span><br><span class="line">    <span class="keyword">var</span> id = <span class="string">&quot;cf-&quot;</span> + <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(item.<span class="property">link</span>).<span class="title function_">toString</span>();</span><br><span class="line">    articleItem += <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;cf-article <span class="subst">$&#123;id&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;cf-article-title&quot; href=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">              item.link</span></span></span><br><span class="line"><span class="subst"><span class="string">            &#125;</span>&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; data-title=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      item.title</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>&quot;&gt;<span class="subst">$&#123;item.title&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;cf-star&quot; onclick=&quot;switchSecretInput(event)&quot;&gt;&lt;i class=&quot;fa-regular fa-star&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;cf-article-avatar no-lightbox flink-item-icon&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;img class=&quot;cf-img-avatar avatar&quot; src=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  item.avatar</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot; alt=&quot;avatar&quot; onerror=&quot;this.src=&#x27;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      fdata.error_img</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>&#x27;; this.onerror = null;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;a onclick=&quot;openMeShow(event)&quot; data-link=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  item.link</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot; class=&quot;&quot; target=&quot;_blank&quot; rel=&quot;noopener nofollow&quot; href=&quot;javascript:;&quot;&gt;&lt;span class=&quot;cf-article-author&quot;&gt;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      item.author</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>&lt;/span&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;span class=&quot;cf-article-time&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;cf-time-created&quot; style=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  sortNow == <span class="string">&quot;created&quot;</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot;&gt;<span class="subst">$&#123;item.created&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;cf-time-updated&quot; style=&quot;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                  sortNow == <span class="string">&quot;updated&quot;</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;display:none&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;</span>&quot;&gt;<span class="subst">$&#123;item.updated&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  container.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;beforeend&quot;</span>, articleItem);</span><br><span class="line">  <span class="keyword">if</span> (savedArticlesIndex != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="title function_">checkStared</span>(savedArticlesIndex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 同时预载下一页文章</span></span><br><span class="line">  <span class="title function_">fetchNextArticle</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 没有更多文章</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadNoArticle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> articleSortData = sortNow + <span class="string">&quot;ArticleData&quot;</span>;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(articleSortData);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;statisticalData&quot;</span>);</span><br><span class="line">  <span class="comment">//localStorage.removeItem(&quot;sortNow&quot;)</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-more&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;cf-state&quot;</span>).<span class="property">offsetTop</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 清空本地数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clearLocal</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;updatedArticleData&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;createdArticleData&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;nextArticle&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;statisticalData&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;sortNow&quot;</span>);</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;urlNow&quot;</span>);</span><br><span class="line">  location.<span class="title function_">reload</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkVersion</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> url = fdata.<span class="property">apiurl</span> + <span class="string">&quot;version&quot;</span>;</span><br><span class="line">  <span class="title function_">fetch</span>(url)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(json);</span><br><span class="line">      <span class="keyword">var</span> nowStatus = json.<span class="property">status</span>,</span><br><span class="line">        nowVersion = json.<span class="property">current_version</span>,</span><br><span class="line">        newVersion = json.<span class="property">latest_version</span>;</span><br><span class="line">      <span class="keyword">var</span> versionID = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-version-up&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (nowStatus == <span class="number">0</span>) &#123;</span><br><span class="line">        versionID.<span class="property">innerHTML</span> = <span class="string">&quot;当前版本：v&quot;</span> + nowVersion;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nowStatus == <span class="number">1</span>) &#123;</span><br><span class="line">        versionID.<span class="property">innerHTML</span> = <span class="string">&quot;发现新版本：v&quot;</span> + nowVersion + <span class="string">&quot; ↦ &quot;</span> + newVersion;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        versionID.<span class="property">innerHTML</span> = <span class="string">&quot;网络错误，检测失败！&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 切换为公共全库</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeEgg</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//有自定义json或api执行切换</span></span><br><span class="line">  <span class="keyword">if</span> (fdata.<span class="property">jsonurl</span> || fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.cf-new-add&quot;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> el.<span class="title function_">remove</span>());</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;updatedArticleData&quot;</span>);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;createdArticleData&quot;</span>);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;nextArticle&quot;</span>);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;statisticalData&quot;</span>);</span><br><span class="line">    container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="title class_">UrlNow</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;urlNow&quot;</span>);</span><br><span class="line">    <span class="comment">//console.log(&quot;新&quot;+UrlNow)</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">UrlNowPublic</span> = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;all?&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">UrlNow</span> !== <span class="title class_">UrlNowPublic</span>) &#123;</span><br><span class="line">      <span class="comment">//非完整默认公开库</span></span><br><span class="line">      changeUrl = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;all?&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (fdata.<span class="property">jsonurl</span>) &#123;</span><br><span class="line">        changeUrl =</span><br><span class="line">          fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;postjson?jsonlink=&quot;</span> + fdata.<span class="property">jsonurl</span> + <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">        changeUrl = fdata.<span class="property">apiurl</span> + <span class="string">&quot;all?&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;urlNow&quot;</span>, changeUrl);</span><br><span class="line">    <span class="title class_">FetchFriendCircle</span>(sortNow, changeUrl);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">clearLocal</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 首次加载文章</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FetchFriendCircle</span>(<span class="params">sortNow, changeUrl</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> end = fdata.<span class="property">initnumber</span>;</span><br><span class="line">  <span class="keyword">var</span> fetchUrl = <span class="title class_">UrlNow</span> + <span class="string">&quot;rule=&quot;</span> + sortNow + <span class="string">&quot;&amp;start=0&amp;end=&quot;</span> + end;</span><br><span class="line">  <span class="keyword">if</span> (changeUrl) &#123;</span><br><span class="line">    fetchUrl = changeUrl + <span class="string">&quot;rule=&quot;</span> + sortNow + <span class="string">&quot;&amp;start=0&amp;end=&quot;</span> + end;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//console.log(fetchUrl)</span></span><br><span class="line">  <span class="title function_">fetch</span>(fetchUrl)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> statisticalData = json.<span class="property">statistical_data</span>;</span><br><span class="line">      <span class="keyword">var</span> articleData = <span class="built_in">eval</span>(json.<span class="property">article_data</span>);</span><br><span class="line">      <span class="keyword">var</span> articleSortData = sortNow + <span class="string">&quot;ArticleData&quot;</span>;</span><br><span class="line">      <span class="title function_">loadStatistical</span>(statisticalData);</span><br><span class="line">      <span class="title function_">loadArticleItem</span>(articleData, <span class="number">0</span>, end);</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;statisticalData&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(statisticalData));</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(articleSortData, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(articleData));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 点击切换排序</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeSort</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  sortNow = event.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">sort</span>;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sortNow&quot;</span>, sortNow);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.cf-new-add&quot;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> el.<span class="title function_">remove</span>());</span><br><span class="line">  container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  changeUrl = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;urlNow&quot;</span>);</span><br><span class="line">  <span class="comment">//console.log(changeUrl)</span></span><br><span class="line">  <span class="title function_">initFriendCircle</span>(sortNow, changeUrl);</span><br><span class="line">  <span class="keyword">if</span> (fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">    <span class="title function_">checkVersion</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//查询个人文章列表</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openMeShow</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="keyword">var</span> parse_url =</span><br><span class="line">    <span class="regexp">/^(?:([A-Za-z]+):)?(\/&#123;0,3&#125;)([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/</span>;</span><br><span class="line">  <span class="keyword">var</span> meLink = event.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">link</span>.<span class="title function_">replace</span>(parse_url, <span class="string">&quot;$1:$2$3&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(meLink);</span><br><span class="line">  <span class="keyword">var</span> fetchUrl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">    fetchUrl = fdata.<span class="property">apiurl</span> + <span class="string">&quot;post?num=5&amp;link=&quot;</span> + meLink;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fetchUrl = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;post?num=5&amp;link=&quot;</span> + meLink;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//console.log(fetchUrl)</span></span><br><span class="line">  <span class="keyword">if</span> (noClick == <span class="string">&quot;ok&quot;</span>) &#123;</span><br><span class="line">    noClick = <span class="string">&quot;no&quot;</span>;</span><br><span class="line">    <span class="title function_">fetchShow</span>(fetchUrl);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭 show</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">closeShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overlay&quot;</span>).<span class="property">className</span> -= <span class="string">&quot;cf-show-now&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overshow&quot;</span>).<span class="property">className</span> -= <span class="string">&quot;cf-show-now&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overshow&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 点击开往</span></span><br><span class="line"><span class="keyword">var</span> noClick = <span class="string">&quot;ok&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">openToShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> fetchUrl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (fdata.<span class="property">apiurl</span>) &#123;</span><br><span class="line">    fetchUrl = fdata.<span class="property">apiurl</span> + <span class="string">&quot;post&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fetchUrl = fdata.<span class="property">apipublieurl</span> + <span class="string">&quot;post&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//console.log(fetchUrl)</span></span><br><span class="line">  <span class="keyword">if</span> (noClick == <span class="string">&quot;ok&quot;</span>) &#123;</span><br><span class="line">    noClick = <span class="string">&quot;no&quot;</span>;</span><br><span class="line">    <span class="title function_">fetchShow</span>(fetchUrl);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 展示个人文章列表</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchShow</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> closeHtml = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;cf-overshow-close&quot; onclick=&quot;closeShow()&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overlay&quot;</span>).<span class="property">className</span> = <span class="string">&quot;cf-show-now&quot;</span>;</span><br><span class="line">  <span class="variable language_">document</span></span><br><span class="line">    .<span class="title function_">getElementById</span>(<span class="string">&quot;cf-overshow&quot;</span>)</span><br><span class="line">    .<span class="title function_">insertAdjacentHTML</span>(<span class="string">&quot;afterbegin&quot;</span>, closeHtml);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开往&quot;</span> + url);</span><br><span class="line">  <span class="title function_">fetch</span>(url)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//console.log(json)</span></span><br><span class="line">      noClick = <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">      <span class="keyword">var</span> statisticalData = json.<span class="property">statistical_data</span>;</span><br><span class="line">      <span class="keyword">var</span> articleData = <span class="built_in">eval</span>(json.<span class="property">article_data</span>);</span><br><span class="line">      <span class="title function_">loadFcircleShow</span>(statisticalData, articleData);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化方法，如有本地数据首先调用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initFriendCircle</span>(<span class="params">sortNow, changeUrl</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> articleSortData = sortNow + <span class="string">&quot;ArticleData&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> localStatisticalData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;statisticalData&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">var</span> localArticleData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(articleSortData));</span><br><span class="line">  container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (localStatisticalData &amp;&amp; localArticleData) &#123;</span><br><span class="line">    <span class="title function_">loadStatistical</span>(localStatisticalData);</span><br><span class="line">    <span class="title function_">loadArticleItem</span>(localArticleData, <span class="number">0</span>, fdata.<span class="property">initnumber</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;本地数据加载成功&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> fetchUrl =</span><br><span class="line">      <span class="title class_">UrlNow</span> + <span class="string">&quot;rule=&quot;</span> + sortNow + <span class="string">&quot;&amp;start=0&amp;end=&quot;</span> + fdata.<span class="property">initnumber</span>;</span><br><span class="line">    <span class="title function_">fetch</span>(fetchUrl)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> statisticalData = json.<span class="property">statistical_data</span>;</span><br><span class="line">        <span class="keyword">var</span> articleData = <span class="built_in">eval</span>(json.<span class="property">article_data</span>);</span><br><span class="line">        <span class="comment">//获取文章总数与第一篇文章标题</span></span><br><span class="line">        <span class="keyword">var</span> localSnum = localStatisticalData.<span class="property">article_num</span>;</span><br><span class="line">        <span class="keyword">var</span> newSnum = statisticalData.<span class="property">article_num</span>;</span><br><span class="line">        <span class="keyword">var</span> localAtile = localArticleData[<span class="number">0</span>].<span class="property">title</span>;</span><br><span class="line">        <span class="keyword">var</span> newAtile = articleData[<span class="number">0</span>].<span class="property">title</span>;</span><br><span class="line">        <span class="comment">//判断文章总数或文章标题是否一致，否则热更新</span></span><br><span class="line">        <span class="keyword">if</span> (localSnum !== newSnum || localAtile !== newAtile) &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-state&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-more&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;cf-footer&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">          container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">          <span class="keyword">var</span> articleSortData = sortNow + <span class="string">&quot;ArticleData&quot;</span>;</span><br><span class="line">          <span class="title function_">loadStatistical</span>(statisticalData);</span><br><span class="line">          <span class="title function_">loadArticleItem</span>(articleData, <span class="number">0</span>, fdata.<span class="property">initnumber</span>);</span><br><span class="line">          <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(</span><br><span class="line">            <span class="string">&quot;statisticalData&quot;</span>,</span><br><span class="line">            <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(statisticalData)</span><br><span class="line">          );</span><br><span class="line">          <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(articleSortData, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(articleData));</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;热更新完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;API数据未更新&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title class_">FetchFriendCircle</span>(sortNow, changeUrl);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;第一次加载完成&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行初始化</span></span><br><span class="line"><span class="title function_">initFriendCircle</span>(sortNow);</span><br></pre></td></tr></table></figure><p>CSS 样式部分比较冗杂，可自行 F12 获取。</p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/Butterfly/">Butterfly</category>
      
      <category domain="https://gavin-chen.top/tags/node-js/">node.js</category>
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</category>
      
      
      <comments>https://gavin-chen.top/post/602922a7.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>关于博客页码模块的设计</title>
      <link>https://gavin-chen.top/post/241391f0.html</link>
      <guid>https://gavin-chen.top/post/241391f0.html</guid>
      <pubDate>Wed, 30 Aug 2023 13:25:51 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;之前看大家都增加了页码跳转功能，觉得很实用，就抄了过来，顺带把页码的样式整个优化了一下。以前的页码样式一直是butterfly默认的，当时文章少，页码就一个，所以也没觉得不适，但如果后面页数多了</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>之前看大家都增加了页码跳转功能，觉得很实用，就抄了过来，顺带把页码的样式整个优化了一下。以前的页码样式一直是butterfly默认的，当时文章少，页码就一个，所以也没觉得不适，但如果后面页数多了，肯定会导致手机端显示错位的问题。就像这样：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308301955073.webp" alt="旧款页码"></p><p>所以重新设计一个页码样式是很有必要的。</p><p>首先看一下别人的优秀设计。第一个是 <a href="https://blog.zhheo.com">@张洪</a> 的博客，洪哥不愧是设计大佬，交互动画和细节处理都是我友链的博客里做的最好的。下图为电脑端的页码样式，该有的功能基本上都有，“上一页”、“下一页”和页码跳转这三个按钮单独设计了优美的交互动画。页码跳转基本结构是一个输入框加一个确认按钮，洪哥将确认按钮覆盖在输入框上方，巧妙的将它们整合成了一个模块，只有当光标移动到模块上方时，输入框才会展开，这样设计既美观又节省了空间。另外，页码跳转功能的逻辑设计考虑的很周全，只支持输入有效范围内的整数，对于超出范围的数会强制转换为最大值，而对于自然数以外的其它字符，则无法输入。输入完页码后，可以通过确认按钮完成跳转，也可以通过回车键完成跳转。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302009407.webp" alt="HEO的页码样式（电脑端）"></p><p>至于手机端的适配，洪哥选择的方案是舍去低频的部件，只保留高频的“上一页”和“下一页”按钮，避免了手机端显示过于臃肿的现象，使得整体效果更加美观。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302034681.webp" alt="HEO的页码样式（手机端）"></p><p>第二个是 <a href="https://www.qcqx.cn">@轻笑</a> 的博客，他的手机端和电脑端样式基本一样，都支持页码跳转，因为取消了“上一页”和“下一页”按钮，且缩小了按钮尺寸，所以也不会出现错位的现象，不失为一种好方案。在页码跳转的逻辑功能方面，只支持通过点击跳转按钮完成跳转，不支持回车键跳转，另外对于超出有效范围的页码也没有进行强制转换（实际逻辑上是强制跳转到最后一页，只是前端显示没有做限制）。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302039884.webp" alt="轻笑的页码样式"></p><p>最后看的是 <a href="https://blog.leonus.cn">@Leonus</a> 的博客，他的整体样式跟洪哥差不多，逻辑功能也一样，但砍掉了“上一页”、“下一页”和页码跳转三个按钮的交互动画，砍掉了页码跳转的确认按钮，只保留了回车键跳转，这样整体看起来简洁很多，也更契合他的主题。移动端的适配也是采取的跟洪哥一样的方案，只保留“上一页”和“下一页”按钮。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302200910.webp" alt="Leonus的页码样式"></p><p>综合考虑下来决定采用 Leonus 的方案，毕竟我的博客主题也是跟他的更契合。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302110040.webp" alt="新版本页码样式（电脑端）"></p><p>电脑端的样式跟 Leonus 的一样，但手机端我还是希望保留页码跳转等功能，所以我在 Leonus 结构的基础上稍微做了下调整，在仅增加一个按钮的情况下，使其既保留了页码跳转的功能，又保留了当前页码显示功能。另外，不仅主页文章列表，分类页、标签页和归档页等页面也做了同样的适配。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308302117244.webp" alt="新版本页码样式（手机端）"></p><p>首先通过<code>order</code>属性将页码输入框移至中间显示，然后通过 js 读取当前页码使其通过页码输入框的<code>placeholder</code>显示出来，这样，就使其同时具备了页码显示和页码跳转的功能。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>首先pagination.pug部分，将页面跳转模块应用到全部，大概在第32行的位置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">else</span><br><span class="line">  nav#pagination</span><br><span class="line">    .pagination</span><br><span class="line">      if is_home()</span><br><span class="line">        - options.format = &#x27;page/%d/#content-inner&#x27;</span><br><span class="line">        //- 如果是一图流，可以把#content-inner删了</span><br><span class="line">      !=paginator(options)</span><br><span class="line">      input.toPageInput(placeholder=&quot;Go&quot; oninput=&quot;value=value.replace(/[^0-9]/g,&#x27;&#x27;)&quot; maxlength=&quot;3&quot;)</span><br></pre></td></tr></table></figure><p>在逻辑代码部分，由于洪哥他们仅支持主页文章列表的页码跳转，并没有对分类页、标签页和归档页的页码做适配，所以这里对原 js 代码做了改进。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctrl = &#123;</span><br><span class="line">    <span class="title function_">toPageJump</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> e = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#pagination input.toPageInput&quot;</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">k</span>(<span class="params">v</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> p = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>, <span class="comment">// 获取当前网页相对路径</span></span><br><span class="line">                i = [],</span><br><span class="line">                c = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> ((c = p.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>, c + <span class="number">1</span>)) !== -<span class="number">1</span>) i.<span class="title function_">push</span>(c) <span class="comment">// i是所有/的索引</span></span><br><span class="line">            <span class="keyword">var</span> l = i.<span class="property">length</span></span><br><span class="line">            <span class="keyword">if</span> (l == <span class="number">1</span> || p.<span class="title function_">substring</span>(<span class="number">1</span>, i[l-<span class="number">2</span>]) == <span class="string">&quot;page&quot;</span>) <span class="keyword">return</span> [<span class="string">&quot;/#content-inner&quot;</span>, <span class="string">`/page/<span class="subst">$&#123;v&#125;</span>/#content-inner`</span>]</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (l &gt;= <span class="number">4</span> &amp;&amp; p.<span class="title function_">substring</span>(i[l-<span class="number">3</span>]+<span class="number">1</span>, i[l-<span class="number">2</span>]) == <span class="string">&quot;page&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> j = p.<span class="title function_">substring</span>(<span class="number">0</span>, i[l-<span class="number">3</span>]+<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> [<span class="string">`<span class="subst">$&#123;j&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;j&#125;</span>page/<span class="subst">$&#123;v&#125;</span>/`</span>]</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">return</span> [<span class="string">`<span class="subst">$&#123;p&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;p&#125;</span>page/<span class="subst">$&#123;v&#125;</span>/`</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        e &amp;&amp; (e.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> t = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.page-number&quot;</span>)</span><br><span class="line">                , n = t[t.<span class="property">length</span> - <span class="number">1</span>].<span class="property">innerHTML</span>;</span><br><span class="line">            <span class="title class_">Number</span>(e.<span class="property">value</span>) &gt; n &amp;&amp; (e.<span class="property">value</span> = n),</span><br><span class="line">                <span class="title class_">Number</span>(e.<span class="property">value</span>) &lt; <span class="number">1</span> &amp;&amp; (e.<span class="property">value</span> = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">            e.<span class="title function_">addEventListener</span>(<span class="string">&quot;keyup&quot;</span>, <span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="string">&quot;Enter&quot;</span> == t.<span class="property">key</span> &amp;&amp; <span class="string">&quot;&quot;</span> != e.<span class="property">value</span> &amp;&amp; <span class="string">&quot;0&quot;</span> != e.<span class="property">value</span> &amp;&amp; pjax.<span class="title function_">loadUrl</span>(<span class="string">&quot;1&quot;</span> == e.<span class="property">value</span> ? <span class="title function_">k</span>(e.<span class="property">value</span>)[<span class="number">0</span>] : <span class="title function_">k</span>(e.<span class="property">value</span>)[<span class="number">1</span>])</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getCurrentPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">innerWidth</span> &lt;= <span class="number">768</span> &amp;&amp; (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#body-wrap.page.home&quot;</span>) || <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;tag&quot;</span>) || <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;category&quot;</span>) || <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;archive&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">var</span> c = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.pagination .page-number.current&quot;</span>).<span class="property">innerHTML</span>;</span><br><span class="line">            <span class="keyword">if</span> (c) &#123;</span><br><span class="line">                <span class="keyword">var</span> t = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.pagination .toPageInput&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (t) &#123;</span><br><span class="line">                    t.<span class="property">placeholder</span> = <span class="string">&quot;第 &quot;</span> + c + <span class="string">&quot; 页&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>常用的<code>window.location</code>属性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>);      <span class="comment">// 获取完整的 URL 地址</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span>);  <span class="comment">// 获取协议部分（如 &quot;http:&quot; 或 &quot;https:&quot;）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span>);      <span class="comment">// 获取主机部分（包括域名和端口号）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hostname</span>);  <span class="comment">// 获取主机名部分（不包括端口号）</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">port</span>);      <span class="comment">// 获取端口号部分</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>);  <span class="comment">// 获取路径部分</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>);    <span class="comment">// 获取查询字符串部分</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>);      <span class="comment">// 获取 URL 锚点部分</span></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/Butterfly/">Butterfly</category>
      
      
      <comments>https://gavin-chen.top/post/241391f0.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>数字电子技术基础（4）——触发器</title>
      <link>https://gavin-chen.top/post/603cec67.html</link>
      <guid>https://gavin-chen.top/post/603cec67.html</guid>
      <pubDate>Fri, 18 Aug 2023 05:46:18 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;数字系统中常用触发器作为存储单元，它是构成时序逻辑电路的基本逻辑器件，根据逻辑功能的不同，触发器可分为 RS 触发器、D 触发器、JK 触发器、T 触发器和</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>数字系统中常用触发器作为存储单元，它是构成时序逻辑电路的基本逻辑器件，根据逻辑功能的不同，触发器可分为 RS 触发器、D 触发器、JK 触发器、T 触发器和 T&#39;触发器等。根据结构形式不同，又可分为基本 RS 触发器、同步触发器、主从触发器和边沿触发器等。</p><h2 id="SR-锁存器"><a href="#SR-锁存器" class="headerlink" title="SR 锁存器"></a>SR 锁存器</h2><p>SR 锁存器，有的教材也叫基本 RS 触发器，有与非门构成的也有或非门构成的。</p><ul><li>或非门构成的 SR 锁存器</li></ul><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181548885.webp" alt="电路结构与图形符号"></p><div class="table-container"><table><thead><tr><th style="text-align:center"><script type="math/tex">S_D</script></th><th style="text-align:center"><script type="math/tex">R_D</script></th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">Q</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">Q=Q&#39;=0</td></tr></tbody></table></div><div class="note primary no-icon flat"><p>[<span class='p blue'>注</span>]: 当<script type="math/tex">S_D</script>和<script type="math/tex">R_D</script>同时由 1 变为 0 ，<script type="math/tex">Q^*</script>状态不定</p></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^*=S+\overline{R}Q \\\overline{S}+\overline{R}=1</script></div><ul><li>与非门构成的 SR 锁存器</li></ul><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181623497.webp" alt="电路结构与图形符号"></p><div class="table-container"><table><thead><tr><th style="text-align:center"><script type="math/tex">S_D'</script></th><th style="text-align:center"><script type="math/tex">R_D'</script></th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">Q</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">Q=Q&#39;=1</td></tr></tbody></table></div><div class="note primary no-icon flat"><p>[<span class='p blue'>注</span>]: 当<script type="math/tex">S_D</script>和<script type="math/tex">R_D</script>同时由 0 变为 1 ，<script type="math/tex">Q^*</script>状态不定</p></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^*=S+\overline{R}Q \\SR=0</script></div><p>状态不定部分的波形图可以用阴影部分代替。</p><h2 id="同步触发器"><a href="#同步触发器" class="headerlink" title="同步触发器"></a>同步触发器</h2><p>SR 锁存器的状态直接受输入信号控制，而一般将有时钟信号控制的锁存器叫做触发器。</p><div class="note primary modern"><p>同步 = 电平触发</p></div><div class="note primary modern"><p>电平触发，即电平为 1 期间，输入信号每次变化都将引起输出变化，发生多次翻转，这种现象也称<code>空翻</code>现象。所以这种器件的抗干扰能力还是比较低。</p></div><h3 id="同步-RS-触发器"><a href="#同步-RS-触发器" class="headerlink" title="同步 RS 触发器"></a>同步 RS 触发器</h3><p>同步触发器即由电平触发的触发器，所以有的教材也称同步 RS 触发器为电平触发 SR 触发器或门控 SR 锁存器。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181720130.webp" alt="同步RS触发器"></p><div class="table-container"><table><thead><tr><th style="text-align:center">S</th><th style="text-align:center">R</th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">Q</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">Q=Q&#39;=1</td></tr></tbody></table></div><div class="note primary no-icon flat"><p>[<span class='p blue'>注</span>]: 当<script type="math/tex">S_D</script>和<script type="math/tex">R_D</script>同时由 1 变为 0 ，<script type="math/tex">Q^*</script>状态不定</p></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^*=S+\overline{R}Q \\RS=0</script></div><p>还有一种具有异步置 1 和置 0 功能的同步 RS 触发器，当有置数信号的时候，无论时钟信号如何，触发器将立即置数，所以有个下标 D，也称直接置数。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181739299.webp" alt="具有异步置1和置0功能的同步 RS 触发器"></p><h3 id="同步-D-触发器"><a href="#同步-D-触发器" class="headerlink" title="同步 D 触发器"></a>同步 D 触发器</h3><p>将同步 RS 触发器的 S 端和 R 端用非门连接在一起，形成新的 D 端，那么这就变成了同步 D 触发器。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181742966.webp" alt="同步D触发器"></p><div class="table-container"><table><thead><tr><th style="text-align:center">D</th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td></tr></tbody></table></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^*=D</script></div><h3 id="同步-JK-触发器"><a href="#同步-JK-触发器" class="headerlink" title="同步 JK 触发器"></a>同步 JK 触发器</h3><p>将同步 RS 触发器的 Q&#39;端接到 S 端与非门的输入，Q 端接到 R 端与非门的输入，原来的 S 端变成 J 端，原来的 R 端变成 K 端，那么这就变成了同步 JK 触发器。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181751534.webp" alt="同步 JK 触发器"></p><div class="table-container"><table><thead><tr><th style="text-align:center">J</th><th style="text-align:center">K</th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">Q</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center"><script type="math/tex">\overline{Q}</script></td></tr></tbody></table></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^*=J\overline{Q}+\overline{K}Q</script></div><h3 id="同步-T-触发器"><a href="#同步-T-触发器" class="headerlink" title="同步 T 触发器"></a>同步 T 触发器</h3><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181813260.webp" alt="同步 T 触发器"></p><div class="table-container"><table><thead><tr><th style="text-align:center">T</th><th style="text-align:center"><script type="math/tex">Q^*</script></th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">Q</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center"><script type="math/tex">\overline{Q}</script></td></tr></tbody></table></div><div class="note info modern"><p>状态方程：</p><script type="math/tex; mode=display">Q^* = T\overline{Q}+\overline{T}Q = T \oplus Q</script></div><h2 id="主从触发器"><a href="#主从触发器" class="headerlink" title="主从触发器"></a>主从触发器</h2><div class="note primary modern"><p>主从 = 脉冲触发</p></div><h3 id="主从-RS-触发器"><a href="#主从-RS-触发器" class="headerlink" title="主从 RS 触发器"></a>主从 RS 触发器</h3><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181949178.webp" alt="主从 RS 触发器"></p><p>主从 RS 触发器的逻辑功能与同步 RS 触发器一致，故功能表、状态方程略。</p><div class="note primary modern"><p>主从 RS 触发器克服了 CP=1 期间触发器输出状态可能多次翻转，即“空翻”的问题。但同时还是受 RS = 0 条件的约束。</p></div><p>在绘制波形图时，注意要先绘制主触发器的输出波形<script type="math/tex">Q_主</script>，然后再绘制最终输出波形Q，一般来说，Q与<script type="math/tex">Q_主</script>相似且比<script type="math/tex">Q_主</script>晚半个时钟周期。例如下图：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182029874.webp" alt=""></p><h3 id="主从-JK-触发器"><a href="#主从-JK-触发器" class="headerlink" title="主从 JK 触发器"></a>主从 JK 触发器</h3><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182012403.webp" alt="主从 JK 触发器"></p><p>主从 JK 触发器也是在主从 RS 触发器的基础上引入 Q 和 Q&#39;两条反馈线转变而来。主从 JK 触发器的逻辑功能与同步 JK 触发器一致，故功能表、状态方程略。</p><div class="note primary modern"><p>与主从 RS 触发器一样，主从 JK 触发器同样可以防止触发器在 CP 作用期间可能发生多次翻转的现象，即不会出现空翻现象。</p><p>但它同时却出现了新的<code>一次翻转</code>现象。即在 CP = 1 期间,无论 J、K 变化多少次,只要其变化引起主触发器翻转了一次，在此 CP = 1 期间就不再变化了。这时，对应于 CP 下降沿的从触发器状态就既不由 CP 下降沿前的 JK 状态决定,也不由 CP 上升沿前的 J、K 状态决定，而是由引起主触发器这次变化的 J、K 状态所决定。因此，在时钟脉冲下降沿到达时，触发器接收这一时刻主触发器的状态，并发生状态转移。状态转移的结果就有可能与 JK 触发器的状态方程描述的转移结果不一致。</p></div><p>在绘制波形图时，一定要注意“一次翻转”特性，可以先（也可以不）绘制主触发器的输出波形<script type="math/tex">Q_主</script>，然后再绘制最终输出波形Q，这里，Q和<script type="math/tex">Q_主</script>就不一定相似了。例如下图：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182029598.webp" alt=""></p><h2 id="边沿触发器"><a href="#边沿触发器" class="headerlink" title="边沿触发器"></a>边沿触发器</h2><p>边沿触发器的输出仅在上升沿或下降沿的时刻发生变化，而在此之前和之后输入状态的变化对触发器的次态没有影响，因此其抗干扰能力比较强。</p><p>边沿触发器的符号特点是在时钟输入端有一个小三角，端口有小圆圈为下降沿触发，否则为上升沿触发。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182045486.webp" alt="下降沿触发的 JK 触发器"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182046429.webp" alt="示例波形图"></p><h2 id="触发器之间的转换"><a href="#触发器之间的转换" class="headerlink" title="触发器之间的转换"></a>触发器之间的转换</h2><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182049657.webp" alt="触发器的转换（1）"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308182050244.webp" alt="触发器的转换（2）"></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%A1%AC%E4%BB%B6%E7%9F%A5%E8%AF%86/">硬件知识</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E7%94%B5/">数电</category>
      
      
      <comments>https://gavin-chen.top/post/603cec67.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>数字电子技术基础（3）——组合逻辑电路</title>
      <link>https://gavin-chen.top/post/d625d0a6.html</link>
      <guid>https://gavin-chen.top/post/d625d0a6.html</guid>
      <pubDate>Sat, 05 Aug 2023 08:21:24 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ol><li><p>什么是组合逻辑电路？<br>在任何时刻，电路的输出仅取决于该时刻的输入信号，而与电路原来的状态无关，这种电路称为组合逻辑电路。</p></li><li><p>组合逻辑电路的特点<br>结构特点：电路只有从输入到输出的通路，没有从输出到输入的反馈回路。电路中不存在含有记忆功能的存储器件。<br>逻辑特点：只要输入量确定，那么各级的输出量皆可确定。</p></li></ol><h2 id="组合逻辑电路的分析与设计"><a href="#组合逻辑电路的分析与设计" class="headerlink" title="组合逻辑电路的分析与设计"></a>组合逻辑电路的分析与设计</h2><p>组合逻辑电路的分析方法：</p><ol><li>根据逻辑电路图，确定输入变量、输出变量、中间变量；</li><li>逐级推导出各输出端的逻辑函数表达式；</li><li>化简输出表达式，列出真值表；</li><li>根据输出表达式和真值表，概括逻辑功能。</li></ol><p>组合逻辑电路的设计方法：</p><ol><li>对问题进行逻辑抽象，列出真值表；</li><li>写出逻辑表达式；</li><li>化简逻辑表达式，并根据所需器件进行变换；</li><li>绘制逻辑电路图。</li></ol><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308052320978.webp" alt="组合电路设计流程"></p><p>对于最简 <strong>与或</strong> 式，若需采用 <strong>与非</strong> 门实现，可以对该式<code>两次取反</code>，变换成 <strong>与非-与非</strong> 表达式；若需采用 <strong>或非</strong> 门实现，可以先转换成 <strong>或与</strong> 式（或者直接在卡诺图上圈0得到最简或与式），再<code>两次取反</code>，变换成 <strong>或非-或非</strong> 表达式。</p><p>当题目中有两组输出，且输入端共享，可以合理利用公共乘积项，以此优化电路设计。<br>例如：</p><script type="math/tex; mode=display">F_1 = C + A\bar{B} = \overline{\bar{C}\overline{A\bar{B}}} \\F_2 = BC + A\bar{B}\bar{C} = \overline{\overline{BC}\overline{A\bar{B}\bar{C}}}</script><p>可以利用公共乘积项<script type="math/tex">A\bar{B}\bar{C}</script>，简化电路结构。</p><script type="math/tex; mode=display">F_1 = C + A\bar{B} = C + A\bar{B}\bar{C} = \overline{\bar{C}\overline{A\bar{B}\bar{C}}} \\F_2 = BC + A\bar{B}\bar{C} = \overline{\overline{BC}\overline{A\bar{B}\bar{C}}}</script><p>简化前（左/上）与简化后（右/下）电路结构对比：</p><center><img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308161826797.webp" style="height:200px;"/> ⇨ <img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308161826151.webp" style="height:200px;"/></center><p>如果选用 MSI 组合逻辑器件设计电路时，对于多输出函数来说，通常选用 <strong>译码器</strong> 实现电路较方便。对于单输出函数来说，选用 <strong>数据选择器</strong> 实现电路较方便。</p><div class="note primary modern"><p>常用中规模组合逻辑器件（MSI）包括<strong>加法器</strong>、<strong>编码器</strong>、<strong>译码器</strong>、<strong>数据选择器</strong>、<strong>数值比较器</strong>等，除了基本功能外，还要掌握这些器件的扩展和应用。</p></div><h2 id="加法器"><a href="#加法器" class="headerlink" title="加法器"></a>加法器</h2><p>加法器是构成算术运算器的基本单元，两个二进制数之间所进行的算术运算加、减、乘、除等，在计算机中都是化作若干步加法运算进行的。实现1位加法运算的模块有半加器和全加器，实现多位加法运算的模块有串行进位加法器和超前进位加法器。</p><h3 id="半加器"><a href="#半加器" class="headerlink" title="半加器"></a>半加器</h3><p>如果不考虑有来自低位的进位，将两个1位二进制数相加称为半加。半加器公式：</p><script type="math/tex; mode=display">S = \bar{A}B + A\bar{B} = A \oplus B \\CO = AB</script><p>其中，A为被加数、B为加数，S为本位之和，CO为本位向高位的进位。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308162239749.png" alt="半加器逻辑图与符号"></p><h3 id="全加器"><a href="#全加器" class="headerlink" title="全加器"></a>全加器</h3><p>能对两个1位二进制数进行相加，并考虑低位来的进位，即相当于3个1位二进制数相加，求得和及进位的逻辑电路称为全加器。全加器公式：</p><script type="math/tex; mode=display">S = A \oplus B \oplus CI \\CO = (A \oplus B)CI + AB</script><p>其中，A、B为两个1位二进制加数，CI为低位来的进位，S为本位的和，CO为本位向高位的进位。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308162254327.png" alt="全加器符号"></p><h3 id="多位加法器"><a href="#多位加法器" class="headerlink" title="多位加法器"></a>多位加法器</h3><p>一般有串行进位加法器和超前进位加法器两种。</p><ol><li><p>串行进位加法器<br> 将N位全加器串联起来，低位全加器的进位输出连接到相邻的高位全加器的进位输人，这种进位方式称为串行进位。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308162312111.png" alt="4位串行进位加法器"></p><p>由于串行进位加法器的进位信号采用逐级传输方式，每一位的加法运算必须在低一位的加法运算完成之后才能进行，故其运算速度慢，只能用于低速数字设备中。但这种电路的结构简单，实现加法的位数扩展方便。</p></li><li><p>超前进位加法器<br> 超前进位又称并行进位，就是让各级进位信号同时产生，每位的进位只由加数和被加数决定，而不必等低位的进位，即实行了提前进位，因而提高了运算速度。但同时不可避免地，其电路复杂度会随着位数增加而急剧上升。我们日常使用的加法器模块多为超前进位的工作方式，如双全加器<code>74**183</code>、4位超前进位加法器<code>74**283</code>等。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308162318194.png" alt="4位超前进位加法器74HC283"></p></li></ol><h3 id="加法器的应用"><a href="#加法器的应用" class="headerlink" title="加法器的应用"></a>加法器的应用</h3><ol><li><p>构成加减乘除运算器<br>  若需求减法运算，只需把减数转成补码，即可把两数相减变换成两数相加的加法运算。至于乘法运算，可以先计算出每一位的本位和以及进位的表达式，再按照表达式画出逻辑图。</p>  <div class="note info no-icon flat"><p>例：用全加器实现一个2位二进制乘法运算电路。</p></div><p>  假设两个2位二进制数<script type="math/tex">A_1A0</script>和<script type="math/tex">B_1B_0</script>，两者相乘最高为4位，设为<script type="math/tex">Y_3Y_2Y_1Y_0</script>，列竖式计算</p><p>  <img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308171552003.png" alt=""></p><p>  具体电路实现方式：利用与门实现<script type="math/tex">A_0B_0</script>、<script type="math/tex">A_1B_0</script>、<script type="math/tex">A_0B_1</script>、<script type="math/tex">A_1B_1</script>（当然，如果题目中不允许使用门器件，也可以使用全加器实现<sup><span class='p blue'>*</span></sup>），然后利用一个全加器实现<script type="math/tex">Y_1=A_1B_0+A_0B_1</script>，产生的和就是<script type="math/tex">Y_1</script>，产生的进位<script type="math/tex">CO_1</script>供给高位计算产生<script type="math/tex">Y_2</script>；再利用一个全加器实现<script type="math/tex">Y_2=A_1B_1+CO_1</script>，产生的和是<script type="math/tex">Y_2</script>，产生的进位<script type="math/tex">CO_2</script>就是<script type="math/tex">Y_3</script>。逻辑电路图如下：</p><p>  <img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308171959587.webp" alt="乘法器逻辑图"></p>  <div class="note primary no-icon flat"><p>[<span class='p blue'>*</span>]: 将全加器的CI端接地，则输出CO即为AB。输出S为<script type="math/tex">A\oplus B</script></p></div></li><li><p>构成代码转换器<br>  比如常用的8421BCD码和余3码，它们之间的差值固定，因此通过加减这个差值，可以实现这两种编码的转换。</p></li><li><p>构成二-十进制码加法器</p>  <div class="note info no-icon flat"><p>例：用4位二进制加法器构成1位8421BCD码十进制加法器。</p></div><p>  首先举例分析十进制数的加法和8421BCD4位二进制码加法的差异。</p><p>  <img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308171525504.png" alt=""></p><p>  所以电路应由3个部分组成：第一部分进行加数和被加数相加；第二部分产生修正控制信号；第三部分完成加6修正。第一部分和第三部分均由4位加法器实现。第二部分判别信号F，应在4位8421BCD码相加有进位信号CO产生时或者和数在10~15的情况下产生，所以F应为</p><script type="math/tex; mode=display">  F=CO+F_3F_2F_1F_0+F_3F_2F_1F_0'+F_3F_2F_1'F_0+F_3F_2F_1'F_0'+F_3F_2'F_1F_0+F_3F_2'F_1F_0'</script><p>  化简变换为</p><script type="math/tex; mode=display">  F=CO+F_3F_2+F_3F_1=\overline{\overline{CO}\bullet\overline{F_3F_2}\bullet\overline{F_3F_1}}</script><p>  根据表达式可绘制出逻辑电路图如下</p><p>  <img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308171541727.png" alt="8421BCD码十进制加法器逻辑图"></p></li></ol><h2 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h2><p>编码器一般有普通编码器和优先编码器两种。</p><h3 id="普通编码器"><a href="#普通编码器" class="headerlink" title="普通编码器"></a>普通编码器</h3><p>在普通编码器中，任何时刻只允许输入一个编码有效信号，否则输出将发生混乱。常见的3位二进制编码器又称8线-3线编码器，4位二进制编码器又称16线-4线编码器。此外还有8421BCD码编码器，这是一种二-十进制编码器。不同的编码器要注意其输入端和输出端的引脚是否有小圆圈，输入端有小圆圈代表低电平有效，否则高电平有效，输出端有小圆圈代表输出为反码，否则输出原码。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172027963.webp" alt="3位二进制编码器真值表"></p><h3 id="优先编码器"><a href="#优先编码器" class="headerlink" title="优先编码器"></a>优先编码器</h3><p>在优先编码器电路中，允许同时输人两个以上的编码信号。不过在设计优先编码器时已经将所有的输入信号按优先顺序排了队，当几个输入信号同时出现时，只对其中优先权最高的一个进行编码。</p><p>我们常用的有 <strong>8线-3线优先编码器</strong><code>74**148</code>，还有 <strong>二-十进制优先编码器</strong><code>74**147</code>（输入低电平有效，输出为8421BCD码的反码）。</p><center><img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172043150.webp" style="height:200px;"/><img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172044777.webp" style="height:200px;"/></center><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172039257.webp" alt="74HC148功能表"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172040256.webp" alt="74HC147功能表"></p><h3 id="编码器扩展"><a href="#编码器扩展" class="headerlink" title="编码器扩展"></a>编码器扩展</h3><div class="note info no-icon flat"><p>例：用8线-3线优先编码器74HC148扩展成16线-4线优先编码器。</p></div><p>显然需要2片74HC148。我们知道74HC148的输出范围为 000 ~ 111，而需要得到的输出为 0000 ~ 1111，不难发现，0000 ~ 1111 可以拆成 0000 ~ 0111 和 1000 ~ 1111 两部分，这两部分的低三位都是 000 ~ 111，不同的只有最高位。我们可以利用使能端<script type="math/tex">S'</script>和使能输出端<script type="math/tex">Y_s'</script>，控制其中一片编码器工作，而另一片编码器不工作，而扩展输出端<script type="math/tex">Y_{EX}'</script>作为输出的最高位。注意，由于74HC148输出为反码，所以低三位输出端用与非门相接。逻辑电路图如下。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172222003.webp" alt="16线-4线优先编码器电路"></p><h2 id="译码器"><a href="#译码器" class="headerlink" title="译码器"></a>译码器</h2><p>译码是编码的逆过程。译码器的种类很多，根据所完成的逻辑功能可分为变量译码器、码制译码器和显示译码器3种。</p><h3 id="变量译码器"><a href="#变量译码器" class="headerlink" title="变量译码器"></a>变量译码器</h3><p>常见的变量译码器有 <strong>双2线-4线译码器</strong><code>74**139</code>、<strong>3线-8线译码器</strong><code>74**138</code>、<strong>4线-16线译码器</strong><code>74**154</code>等。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172249511.webp" alt="74HC138逻辑框图"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172250467.webp" alt="74HC138功能表"></p><p>从功能表可以看出，74HC138的输出<script type="math/tex">Y_t'=m_t'</script>，所以这种译码器也称最小项译码器。根据这个特性，我们可以用它来输出特定的逻辑函数表达式。</p><div class="note info no-icon flat"><p>例：用74HC138输出</p><script type="math/tex; mode=display">F_1=AB'+B'C+AC \\F_2=A'B'+BC'+ABC \\F_3=A'C+BC+AC'</script></div><p>先将<script type="math/tex">F_1、F_2、F_3</script>变换成最小项之和的形式，并变换成与非式。</p><script type="math/tex; mode=display">F_1 = \overline{m_1'm_4'm_5'm_7'} = \overline{Y_1'Y_4'Y_5'Y_7'} \\F_2 = \overline{m_0'm_1'm_2'm_6'm_7'} = \overline{Y_0'Y_1'Y_2'Y_6'Y_7'} \\F_3 = \overline{m_1'm_3'm_4'm_6'm_7'} = \overline{Y_1'Y_3'Y_4'Y_6'Y_7'}</script><p>逻辑电路图如下：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172308027.png" alt=""></p><h3 id="码制译码器"><a href="#码制译码器" class="headerlink" title="码制译码器"></a>码制译码器</h3><p>最常用的是8421BCD码译码器，即 <strong>二-十进制译码器</strong><code>74**42</code>。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172316610.webp" alt="74HC42逻辑框图"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172316898.webp" alt="74HC42真值表"></p><p>根据真值表可见，若将<script type="math/tex">A_3</script>接地，弃用<script type="math/tex">Y_8、Y_9</script>，此时74HC42就可作为一片3线-8线译码器使用。</p><h3 id="显示译码器"><a href="#显示译码器" class="headerlink" title="显示译码器"></a>显示译码器</h3><p>常用的主要是<code>74**48</code>。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172346030.webp" alt="74LS48逻辑框图"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172347161.webp" alt="74LS48功能表"></p><p>其中，LT&#39; 为灯测试输入，令 LT&#39; = 0 可将所有数码管点亮，已检查发光是否正常。平时应置 LT&#39; 为1。</p><p>RBI&#39; 为灭零输入，其功能是把冗余的0熄灭，比如“00013.700”变成“13.7”。</p><p>BI&#39;/RBO&#39;为灭灯输入/灭零输出，当作输入端使用时，称灭灯输入控制端，令 BI&#39; = 0 即可熄灭所有数码管；当作为输出端使用时，称灭零输出端，只有当输入 A 全为 0，且 RBI&#39; = 0 时，才有输出 RBO&#39; = 0，表明已经将本来应该显示的零熄灭了。</p><p>将 BI&#39;/RBO&#39; 与 RBI&#39; 配合使用，很容易实现多位数码显示的灭零控制。将多谐振荡器与 BI&#39;/RBO&#39; 相连接，还可以实现亮度调节（PWM控制间歇显示）。</p><h3 id="译码器扩展"><a href="#译码器扩展" class="headerlink" title="译码器扩展"></a>译码器扩展</h3><div class="note info no-icon flat"><p>例：用3线-8线译码器74HC138扩展成4线-16线译码器。</p></div><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172330286.webp" alt="4线-16线译码器电路"></p><div class="note info no-icon flat"><p>例：用2线-4线译码器74LS139和4线-10线译码器74LS42扩展成5线-32线译码器。</p></div><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308172335270.webp" alt="5线-32线译码器电路"></p><h2 id="数据选择器"><a href="#数据选择器" class="headerlink" title="数据选择器"></a>数据选择器</h2><p>数据选择器输出通用表达式：</p><script type="math/tex; mode=display">Y = \sum_{i=0}^{2^n-1} D_im_i</script><p>常见的有 <strong>双4选1数据选择器</strong><code>74**153</code>，<strong>8选1数据选择器</strong><code>74**151</code>。其中S为选通端，A为地址端。芯片画法不固定，一般标注“MUX”的也是数据选择器。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180821395.webp" alt="74HC153逻辑框图"></p><h3 id="数据选择器扩展"><a href="#数据选择器扩展" class="headerlink" title="数据选择器扩展"></a>数据选择器扩展</h3><div class="note info no-icon flat"><p>例：用8选1和4选1数据选择器扩展成32选1数据选择器。</p></div><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180823418.webp" alt="32选1数据选择器电路"></p><h3 id="数据选择器生成函数"><a href="#数据选择器生成函数" class="headerlink" title="数据选择器生成函数"></a>数据选择器生成函数</h3><ol><li><p>用具有N个地址端的数据选择器实现M变量逻辑函数（M ≤ N）</p><ul><li>当 M = N 时，只需将选择器的输入端按照卡诺图中对应的 0 和 1 填写。</li></ul><div class="note info no-icon flat"><p>例：用8选1数据选择器实现3变量逻辑函数：</p><script type="math/tex; mode=display">  F=A'B+AB'+C</script></div><p>显然，<script type="math/tex">F(A,B,C)=\sum m(1,2,3,4,5,7)</script>，故将<script type="math/tex">D_1、D_2、D_3、D_4、D_5、D_7</script>接1，而<script type="math/tex">D_0、D_6</script>则接0。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180902535.webp" alt=""></p><ul><li>当 M &lt; N 时，只需要将高位地址端和相应输入端接地（接0）即可。</li></ul><div class="note info no-icon flat"><p>例：用8选1数据选择器实现2变量逻辑函数：</p><script type="math/tex; mode=display">  F=A'B+AB'</script></div><p>显然，<script type="math/tex">F(A,B)=\sum m(1,2)</script>，故将<script type="math/tex">D_1、D_2</script>接1，而<script type="math/tex">D_0、D_3、D_4、D_5、D_6、D_7</script>则接0，至于地址端，高位<script type="math/tex">A_2</script>接0，剩余<script type="math/tex">A_1=A，A_0=B</script>。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180902553.webp" alt=""></p></li><li><p>用具有N个地址端的数据选择器实现M变量逻辑函数（M &gt; N）</p><ul><li>一种方法是扩展法，一般将最高位作为片选信号。</li></ul><div class="note info no-icon flat"><p>例：用8选1数据选择器实现4变量逻辑函数：</p><script type="math/tex; mode=display">  F(A,B,C,D)=\sum m(0,3,6,7,10,11,13,14)</script></div><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180902255.webp" alt=""></p><ul><li>另一种方法是降维图法。</li></ul><p>降维的方法是：如果记图变量为<script type="math/tex">X</script>，对于原卡诺图（或降维图）中，当 <script type="math/tex">X = 0</script> 时，原图单元值为 <script type="math/tex">f</script>；<script type="math/tex">X = 1</script> 时，原图单元值为 <script type="math/tex">g</script>，则在新的降维图中，对应的降维图单元填入子函数 <script type="math/tex">\overline{X} \bullet f + X \bullet g</script>。其中 <script type="math/tex">f</script> 和 <script type="math/tex">g</script> 可以为0，可以为1，可以为某一变量，也可以为某一函数。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180921611.webp" alt="降维示例"></p><div class="note info no-icon flat"><p>例：用8选1数据选择器实现4变量逻辑函数：</p><script type="math/tex; mode=display">  F(A,B,C,D)=\sum m(1,5,6,7,9,11,12,13,14)</script></div><p>降维可得：<script type="math/tex">D_0=D，D_1=0，D_2=D，D_3=1，D_4=D，D_5=D，D_6=1，D_7=\overline{D}</script>。绘制出逻辑电路图如下：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308180928995.webp" alt=""></p></li></ol><h2 id="数值比较器"><a href="#数值比较器" class="headerlink" title="数值比较器"></a>数值比较器</h2><p>数值比较器的输入为要进行比较的两个二进制数，输出为比较的三个结果：大于、小于和等于。<br>对于1位数值比较器，其逻辑表达式为</p><script type="math/tex; mode=display">F_{A>B}=A\overline{B} \\F_{A<B}=\overline{A}B \\F_{A=B}=A\odot B</script><p>在比较两个多位数的大小时，必须自高而低地逐位比较，而且只有在高位相等时，才需要比较低位。常用的集成模块有 <strong>4位数值比较器</strong><code>74**85</code>。</p><p>数值比较器有串联和并联2种扩展方式，当位数较少且要求速度不高时，常采用串联方式；当位数较多且要满足一定速度要求时，应采用并联方式。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181007053.webp" alt="两片74HC85扩展为8位数值比较器电路（串联扩展）"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181003321.webp" alt="用74LS85组成16位数值比较器电路（并联扩展）"></p><h2 id="竞争与冒险"><a href="#竞争与冒险" class="headerlink" title="竞争与冒险"></a>竞争与冒险</h2><p>理想情况下，在组合逻辑电路的设计中，假设电路的连线和集成门电路都没有延迟，电路中的多个输入信号发生变化时，都是同时瞬间完成的。实际上，信号通过连线及集成门都有一定的延迟时间，输入信号变化也需要一个过渡时间，多个输入信号发生变化时，也可能有先后快慢的差异。因此，在理想情况下设计的组合逻辑电路，受到上述因素的影响后，可能在输入信号发生变化的瞬间，在输出端出现一些不正确的尖峰信号。这些尖峰信号又称毛刺信号，主要是由信号经不同的路径或控制，到达同一点的时间不同而产生的竞争引起的，故称为竞争冒险现象，简称竞争冒险或冒险。它分为静态冒险和动态冒险两大类。静态冒险分为静态1冒险和静态0冒险两类。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181017227.webp" alt="静态1冒险"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181017136.webp" alt="静态0冒险"></p><h3 id="竞争冒险的判断"><a href="#竞争冒险的判断" class="headerlink" title="竞争冒险的判断"></a>竞争冒险的判断</h3><ol><li><p>代数法<br> 若输出函数在一定条件下可以简化为某原变量与反变量之和或之积，则电路存在竞争冒险现象。<br> 例如F=AB+A&#39;C，当B=C=1时，F=A+A&#39;，所以该电路存在竞争冒险现象。</p></li><li><p>卡诺图法<br> 若输出函数的卡诺图上，存在包围圈相邻的情况，则有竞争冒险现象；包围圈相交或不相邻，则无竞争冒险。</p></li></ol><h3 id="竞争冒险的消除"><a href="#竞争冒险的消除" class="headerlink" title="竞争冒险的消除"></a>竞争冒险的消除</h3><ol><li><p>修改逻辑设计<br> 可以通过对输出函数增加冗余项，修改逻辑设计。<br> 例如 F=AB+A&#39;C 添加冗余项 BC 变成 F=AB+A&#39;C+BC。</p> <center> <img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181032192.webp" style="height:200px;"/> ⇨  <img no-lazy class="inline" src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308181032140.webp" style="height:200px;"/> </center></li><li><p>引入选通脉冲</p></li><li><p>加输出滤波电容</p></li></ol>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%A1%AC%E4%BB%B6%E7%9F%A5%E8%AF%86/">硬件知识</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E7%94%B5/">数电</category>
      
      
      <comments>https://gavin-chen.top/post/d625d0a6.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>歌词淡入淡出效果的实现</title>
      <link>https://gavin-chen.top/post/fbfe8234.html</link>
      <guid>https://gavin-chen.top/post/fbfe8234.html</guid>
      <pubDate>Thu, 27 Jul 2023 07:30:27 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;歌词淡入淡出&quot;&gt;&lt;a href=&quot;#歌词淡入淡出&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="歌词淡入淡出"><a href="#歌词淡入淡出" class="headerlink" title="歌词淡入淡出"></a>歌词淡入淡出</h2><p>利用<code>mask-image</code>和<code>linear-gradient</code>可制作一个渐变的遮罩，应用在文本上就能实现淡入淡出的效果了。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307271624260.webp" alt="无渐变效果歌词"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307271624072.webp" alt="淡入淡出歌词"></p><p>mask-image 属性可以创建自定义的、具有不同形状的遮罩效果，它接受一个URL值，表示要用作遮罩的图像的路径，该图像具有透明和非透明区域，其中非透明部分定义了遮罩的形状。linear-gradient 属性用于创建线性渐变效果，它的参数主要为渐变方向、颜色断点和范围。渐变方向可以是角度，如“45deg”、“90deg”等；也可以是方向词，如“to left”、“to bottom”等等。<br>mask-image 之前在<a href="/post/7c589660.html">超级圆角</a>上用过，linear-gradient 也在<a href="/post/a5c582fd.html#滚动条样式">滚动条</a>上用过，现在用在文本上也是很棒的组合。</p><ul><li><p>上下淡入淡出</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.div</span>&#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">100px</span>,</span><br><span class="line">        <span class="number">#fff</span> <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">100px</span>),</span><br><span class="line">        transparent</span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">100px</span>,</span><br><span class="line">        <span class="number">#fff</span> <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">100px</span>),</span><br><span class="line">        transparent</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>仅淡出</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.div</span>&#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">200px</span></span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">0deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">200px</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>仅淡入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.div</span>&#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">180deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">200px</span></span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">180deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">200px</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>左右淡入淡出</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.div</span>&#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">90deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">100px</span>,</span><br><span class="line">        <span class="number">#fff</span> <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">100px</span>),</span><br><span class="line">        transparent</span><br><span class="line">    );</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">        <span class="number">90deg</span>,</span><br><span class="line">        transparent,</span><br><span class="line">        <span class="number">#fff</span> <span class="number">100px</span>,</span><br><span class="line">        <span class="number">#fff</span> <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">100px</span>),</span><br><span class="line">        transparent</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="/post/de0459c0.html">长文本滚动</a>加上这个左右淡入淡出，结合使用效果会更好。</p><h2 id="歌词进度颜色填充"><a href="#歌词进度颜色填充" class="headerlink" title="歌词进度颜色填充"></a>歌词进度颜色填充</h2><p>以下Demo可以实现一个简易的效果。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308091820078.gif" alt="文本进度颜色填充"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;lyrics&quot;</span>&gt;</span>我想要怒放的生命！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#lyrics</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: fit-content;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">36px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">900</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to right,<span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="number">0%</span>, <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>) <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>) <span class="number">100%</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">200%</span> <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">    -webkit-<span class="attribute">background-clip</span>: text;</span><br><span class="line">    -webkit-text-fill-<span class="attribute">color</span>: transparent;</span><br><span class="line">    <span class="attribute">animation</span>: progress <span class="number">3s</span> infinite linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> progress &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>想要应用在播放器中，只需根据歌词的时长实时更改<code>animationDuration</code>控制动画的时长，再结合播控模块控制动画的开关，即可实现歌词进度颜色填充效果。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308091918155.gif" alt="歌词应用效果"></p><p>但是，这也只是一种简易的实现效果。实际上，歌手的语调是非线性的，歌词的进度需要尽可能地与歌手的语调同步，所以也必须是非线性的动画，而这在一般的歌词文件中是无法体现的，或许需要结合更加复杂的自然语义识别，或者结合对应的曲谱才能实现。</p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%89%8D%E7%AB%AF%E5%90%8E%E7%AB%AF/">前端后端</category>
      
      
      <category domain="https://gavin-chen.top/tags/CSS/">CSS</category>
      
      
      <comments>https://gavin-chen.top/post/fbfe8234.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>关于mathjax公式的一些bug</title>
      <link>https://gavin-chen.top/post/a6751e89.html</link>
      <guid>https://gavin-chen.top/post/a6751e89.html</guid>
      <pubDate>Tue, 25 Jul 2023 03:52:42 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;很多时候，在 Typora 上展现出来是一种样式，在 hexo 博客上又是另一种样式。&lt;br&gt;这次遇到了 mathjax 公式的一些问题。&lt;/p&gt;
&lt;h2 id=&quot;无法换行问题&quot;&gt;&lt;a</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>很多时候，在 Typora 上展现出来是一种样式，在 hexo 博客上又是另一种样式。<br>这次遇到了 mathjax 公式的一些问题。</p><h2 id="无法换行问题"><a href="#无法换行问题" class="headerlink" title="无法换行问题"></a>无法换行问题</h2><p>通常，在 LaTeX 语法中，用“\\”可以实现换行显示。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">A \odot 1 = A \\</span><br><span class="line">A \odot 0 = \bar&#123;A&#125; \\</span><br><span class="line">A \odot \bar&#123;A&#125; = 0 \\</span><br><span class="line">A \odot A = 1</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>但实际渲染出来是这种效果：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307251248240.png" alt="错误效果"></p><p>通过 F12 查看 HTML 结构，发现“\\”被渲染成了一个空的 mjx-mspace 标签，而这个 mjx-mspace 标签的 display 属性默认为 inline-block，长宽皆为 0，所以就没有换行显示。那么只需在 CSS 文件里加一句 “mjx-mspace{display:block;}” 就可以了。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307251248267.png" alt="HTML结构"></p><p>修改后公式的换行就正常了。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307251252710.png" alt="正确效果"></p><h2 id="强制中文引号问题"><a href="#强制中文引号问题" class="headerlink" title="强制中文引号问题"></a>强制中文引号问题</h2><p>在markdown中输入的是英文引号，编译后就自动渲染成了中文引号。</p><p>这个问题跟hexo-render-kramed插件的配置有关，我在Github上找到了类似问题的解答。</p><div class="tag link"><a class="link-card" title="关于英文的引号会被渲染为中文的引号的问题" href="https://github.com/theme-next/hexo-theme-next/issues/462"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/Github.webp"/></div><div class="right"><p class="text">关于英文的引号会被渲染为中文的引号的问题</p><p class="url">https://github.com/theme-next/hexo-theme-next/issues/462</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— Github</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div><p>我用的mathjax，所以用的hexo-render-kramed编译插件，对应的修正方法就是在<code>_config.yml</code>中修改以下配置项。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kramed:</span><br><span class="line">  gfm: true</span><br><span class="line">  pedantic: false</span><br><span class="line">  sanitize: false</span><br><span class="line">  tables: true</span><br><span class="line">  breaks: true</span><br><span class="line">  smartLists: true</span><br><span class="line"><span class="deletion">-  smartypants: true</span></span><br><span class="line"><span class="addition">+  smartypants: false</span></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/Markdown/">Markdown</category>
      
      
      <comments>https://gavin-chen.top/post/a6751e89.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>数字电子技术基础（2）——逻辑代数基础</title>
      <link>https://gavin-chen.top/post/8eb385ff.html</link>
      <guid>https://gavin-chen.top/post/8eb385ff.html</guid>
      <pubDate>Tue, 25 Jul 2023 01:46:44 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;逻辑运算&quot;&gt;&lt;a href=&quot;#逻辑运算&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h2><p>基本的逻辑运算包括与、或、非三项，常用的复合逻辑运算有与非、或非、与或非、异或、同或等。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/%E5%9F%BA%E6%9C%AC%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%E5%8F%B7.webp" alt="基本逻辑运算符号"></p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/%E5%A4%8D%E5%90%88%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%E5%8F%B7.webp" alt="复合逻辑运算符号"></p><ol><li><p>异或</p><script type="math/tex; mode=display">F = A \oplus B = A\bar{B}+\bar{A}B</script><p>性质：</p><script type="math/tex; mode=display">A \oplus 1 = \bar{A} \\A \oplus 0 = A \\A \oplus \bar{A} = 1 \\A \oplus A = 0</script></li><li><p>同或</p><script type="math/tex; mode=display">F = A \odot B = \bar{A}\bar{B}+AB</script><p>性质：</p><script type="math/tex; mode=display">A \odot 1 = A \\A \odot 0 = \bar{A} \\A \odot \bar{A} = 0 \\A \odot A = 1</script></li><li><p>异或和同或的关系</p><script type="math/tex; mode=display">A \oplus B = \overline{A \odot B} = \bar{A} \oplus \bar{B} \\A \odot B = \overline{A \oplus B} = \bar{A} \odot \bar{B}</script></li></ol><h2 id="逻辑函数"><a href="#逻辑函数" class="headerlink" title="逻辑函数"></a>逻辑函数</h2><p>逻辑函数的表示方法有：1.逻辑函数式；2.逻辑真值表；3.逻辑（电路）图；4.（方波）波形图；5.卡诺图等；</p><h3 id="常用公式"><a href="#常用公式" class="headerlink" title="常用公式"></a>常用公式</h3><script type="math/tex; mode=display">A + AB = A \\A + \bar{A}B = A + B \\AB + A\bar{B} = A \\A(A+B) = A \\AB + \bar{A}C + BC = AB + \bar{A}C \\AB + \bar{A}C + BCD = AB + \bar{A}C \\A\bullet\overline{AB} = A\bar{B} \\\bar{A}\bullet\overline{AB} = \bar{A}</script><p>德摩根律：</p><script type="math/tex; mode=display">\overline{AB} = \bar{A} + \bar{B} \\\overline{A+B} = \bar{A}\bar{B}</script><h3 id="基本定理"><a href="#基本定理" class="headerlink" title="基本定理"></a>基本定理</h3><ol><li><p>反演定理</p><p> 对于任意一个逻辑式 Y，将所有的与换成或，或换成与，0换成1，1换成0，原变量换成反变量，反变量换成原变量，所得结果即为 Y&#39;。（Y&#39;也作<script type="math/tex">\bar{Y}</script>）<br> 简单的说，就是所有元素都取反。<br> 使用反演定理时，需要注意保持原式中的优先顺序不变。</p></li><li><p>对偶定理</p><p> 若两式相等，则它们的对偶式也相等。<br> 对偶式：对于任意一个逻辑式 Y，将所有的与换成或，或换成与，0换成1，1换成0，所得结果即为 Y 的对偶式 Y*。（有的书也作<script type="math/tex">Y^D</script>）<br> 简单的说，就是除了变量外元素都取反。</p></li><li><p>Y、Y&#39;、Y*的关系</p><p> 若<script type="math/tex">Y = \sum m(0,1,4,6,7)</script>，则<script type="math/tex">Y' = \sum m(2,3,5)</script>，而<script type="math/tex">Y^* = \sum m(2,4,5)</script>。<br> 可以发现，Y 与 Y&#39; 是互补的，两者合集即为全集。而 Y&#39; 和 Y* 对应元素之和为固定值，即元素总数-1。</p></li></ol><h3 id="标准表达式"><a href="#标准表达式" class="headerlink" title="标准表达式"></a>标准表达式</h3><p>一般表达式分为与或式和或与式，例如 AB+CD 是与或式，(A+B)(C+D) 是或与式。<br>标准表达式也分两种，标准与或式和标准或与式。</p><ol><li><p>最小项</p><p> 在与或式中，函数展开式的每一项都是由全部变量组成的与项，每个变量以原变量或反变量形式出现，仅出现一次。这种与项，称为<code>最小项</code>。<br> 标准与或式，就是全部由最小项之和组成，也称最小项表达式。</p><script type="math/tex; mode=display"> F(A,B,C) = AB + AC + BC \\          =\bar{A}BC + A\bar{B}C + AB\bar{C} + ABC \\          =m_3 + m_5 + m_6 + m_7 \\          =\sum m(3,5,6,7)</script><p> 性质：</p><ul><li>对于任意最小项，只有一组取值使其为 1；</li><li>任意不同最小项之积为 0；</li><li>所有最小项之和为 1。</li></ul></li><li><p>最大项</p><p> 在或与式中，函数展开式的每一项都是由全部变量组成的或项，每个变量以原变量或反变量形式出现，仅出现一次。这种或项，称为<code>最大项</code>。<br> 标准或与式，就是全部由最大项之积组成，也称最大项表达式。</p><script type="math/tex; mode=display"> F(A,B,C) = AB + AC + BC \\          =(\bar{A}+B+C)(A+\bar{B}+C)(A+B+\bar{C})(A+B+C) \\          =M_3 M_5 M_6 M_7 \\          =\prod M(3,5,6,7)</script><p> 性质：</p><ul><li>对于任意最大项，只有一组取值使其为 0；</li><li>任意不同最大项之和为 1；</li><li>所有最大项之积为 0。</li></ul></li><li><p>最小项与最大项互为反函数，<script type="math/tex">\overline{m_i} = M_i, \overline{M_i} = m_i</script>。</p></li></ol><h3 id="卡诺图"><a href="#卡诺图" class="headerlink" title="卡诺图"></a>卡诺图</h3><p>逻辑函数化简的标准：</p><ol><li>项数少（与、或符号少），使用门电路器件就少；</li><li>各项变量少，其输入端数就少；</li><li>输入到输出的级数少，电路延迟就低；</li><li>可靠性要强。</li></ol><p>卡诺图画圈的过程中，主要项是指圈到最大的圈，必要项（属于主要项）是指不可缺少的圈，多余项（属于主要项）是画重复了的圈。</p><p>利用卡诺图化简有两种方法，一种是合并最小项，即圈 1 的方法，也是最常用的方法；另一种是合并最大项，即圈 0 的方法。<br>在做题的时候，可以根据实际情况，采用合适的方法。有的时候圈 0 会更简单！<br>包含任意项（约束项）的时候，要争取画的圈最大。</p><p>关于5变量卡诺图：</p><div class="table-container"><table><thead><tr><th style="text-align:center">AB\CDE</th><th style="text-align:center">000</th><th style="text-align:center">001</th><th style="text-align:center">011</th><th style="text-align:center">010</th><th style="text-align:center">110</th><th style="text-align:center">111</th><th style="text-align:center">101</th><th style="text-align:center">100</th></tr></thead><tbody><tr><td style="text-align:center">00</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">3</td><td style="text-align:center">2</td><td style="text-align:center">6</td><td style="text-align:center">7</td><td style="text-align:center">5</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">01</td><td style="text-align:center">8</td><td style="text-align:center">9</td><td style="text-align:center">11</td><td style="text-align:center">10</td><td style="text-align:center">14</td><td style="text-align:center">15</td><td style="text-align:center">13</td><td style="text-align:center">12</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">24</td><td style="text-align:center">25</td><td style="text-align:center">27</td><td style="text-align:center">26</td><td style="text-align:center">30</td><td style="text-align:center">31</td><td style="text-align:center">29</td><td style="text-align:center">28</td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">16</td><td style="text-align:center">17</td><td style="text-align:center">19</td><td style="text-align:center">18</td><td style="text-align:center">22</td><td style="text-align:center">23</td><td style="text-align:center">21</td><td style="text-align:center">20</td></tr></tbody></table></div><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307251811869.webp" alt="五变量卡诺图"></p><h3 id="逻辑图"><a href="#逻辑图" class="headerlink" title="逻辑图"></a>逻辑图</h3><p>逻辑图一般画法：</p><script type="math/tex; mode=display">Y_1(A,B,C,D)=B+AC+\bar{A}\bar{C}D \\Y_2(A,B,C,D)=\bar{A}D+B\bar{D} \\Y_3(A,B,C,D)=\bar{A}CD+A\bar{B}C</script><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202307251657145.webp" alt="逻辑图"></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%A1%AC%E4%BB%B6%E7%9F%A5%E8%AF%86/">硬件知识</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E7%94%B5/">数电</category>
      
      
      <comments>https://gavin-chen.top/post/8eb385ff.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>数字电子技术基础（1）——数制与码制</title>
      <link>https://gavin-chen.top/post/ca0077c.html</link>
      <guid>https://gavin-chen.top/post/ca0077c.html</guid>
      <pubDate>Mon, 24 Jul 2023 14:37:07 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;数字电路&quot;&gt;&lt;a href=&quot;#数字电路&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="数字电路"><a href="#数字电路" class="headerlink" title="数字电路"></a>数字电路</h2><p>工作在数字信号下的电子电路称为数字电路。与模拟电路相比，数字电路的优点有：</p><ol><li>稳定性好，抗干扰能力强；</li><li>容易设计，便于构成大规模集成电路，所以成本低廉，使用方便；</li><li>信息处理能力强；</li><li>精度高且容易保持；</li><li>便于存储；</li><li>静态功耗小。</li></ol><h2 id="数制"><a href="#数制" class="headerlink" title="数制"></a>数制</h2><p>常用的有十进制（D）、二进制（B）、十六进制（H）、八进制（O）。</p><script type="math/tex; mode=display">(1961)_{10}=1×10^3+9×10^2+6×10^1+1×10^0</script><p>其中，10 为<code>基数</code>，<script type="math/tex">10^0</script>、<script type="math/tex">10^1</script>、<script type="math/tex">10^2</script>、<script type="math/tex">10^3</script>为各位数的<code>权</code>。<br>对于任意一个 R 进制数，可以表示为：</p><script type="math/tex; mode=display">(N)_R=\sum_{i=-m}^{n-1} a_i×R^i</script><h3 id="B-gt-H"><a href="#B-gt-H" class="headerlink" title="B -&gt; H"></a>B -&gt; H</h3><p>4 位二进制数对应 1 位十六进制数，所以当二进制转换十六进制时，整数部分和小数部分都需要按 4 位一组划分，不足则补 0。</p><script type="math/tex; mode=display">(1101100.11)_B = 0110 1100 . 1100 = (6C.C)_H</script><h3 id="D-gt-B、D-gt-H"><a href="#D-gt-B、D-gt-H" class="headerlink" title="D -&gt; B、D -&gt; H"></a>D -&gt; B、D -&gt; H</h3><p>十进制转二进制和十六进制，需要分别对整数部分和小数部分进行转换，最后合并。</p><ol><li><p>整数部分</p><p>整数部分采用“除基取余”法，即不断除以基数，取余数，直至商为 0。<br>以 (208)₁₀ 转换成十六进制为例，基数是 16，所以逐次除以 16 取余数，得到结果为 (D0)₁₆。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">16 │  2  0  8     余0      ↑ 低位</span><br><span class="line">   │___________            │</span><br><span class="line">  16  │  1  3     余13     │</span><br><span class="line">      │________            │</span><br><span class="line">            0              │ 高位</span><br></pre></td></tr></table></figure></li><li><p>小数部分</p><p>小数部分采用“乘基取整”法，即不断将小数部分乘以基数，取积的整数部分，再对积的小数部分乘以基数，如此循环直至小数部分为 0。<br>以 (0.625)₁₀ 转化为十六进制为例，正好乘一次小数部分就为 0 了，结果为 (0.A)₁₆。</p><script type="math/tex; mode=display">0.625×16=10.0</script><p>所以 (208.625)₁₀ = (D0.A)₁₆。</p></li></ol><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>二-十进制代码（Binary Coded Decimal，BCD 码）是用 4 位二进制数表示 1 位十进制数码。常见的有 8421BCD 码、2421BCD 码、5211BCD 码，这些都是<code>恒权码</code>。另外还有余三码、格雷码，属于<code>无权码</code>。<br>余三码是由 8421BCD 码加 3 得到的，它有一个特点，从表中可以看出 0/9、1/8、2/7、3/6、4/5 互为反码。2421BCD 码也存在同样的特点。</p><div class="table-container"><table><thead><tr><th style="text-align:center">十进制数码</th><th style="text-align:center">8421BCD</th><th style="text-align:center">2421BCD</th><th style="text-align:center">余 3 码</th><th style="text-align:center">5211BCD</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0000</td><td style="text-align:center">0000</td><td style="text-align:center">0011</td><td style="text-align:center">0000</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0001</td><td style="text-align:center">0001</td><td style="text-align:center">0100</td><td style="text-align:center">0001</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0010</td><td style="text-align:center">0010</td><td style="text-align:center">0101</td><td style="text-align:center">0100</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">0011</td><td style="text-align:center">0011</td><td style="text-align:center">0110</td><td style="text-align:center">0101</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">0100</td><td style="text-align:center">0100</td><td style="text-align:center">0111</td><td style="text-align:center">0111</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">0101</td><td style="text-align:center">1011</td><td style="text-align:center">1000</td><td style="text-align:center">1000</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">0110</td><td style="text-align:center">1100</td><td style="text-align:center">1001</td><td style="text-align:center">1001</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">0111</td><td style="text-align:center">1101</td><td style="text-align:center">1010</td><td style="text-align:center">1100</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">1000</td><td style="text-align:center">1110</td><td style="text-align:center">1011</td><td style="text-align:center">1101</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">1001</td><td style="text-align:center">1111</td><td style="text-align:center">1100</td><td style="text-align:center">1111</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1010</td><td style="text-align:center">0101</td><td style="text-align:center">0000</td><td style="text-align:center">0010</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1011</td><td style="text-align:center">0110</td><td style="text-align:center">0001</td><td style="text-align:center">0011</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1100</td><td style="text-align:center">0111</td><td style="text-align:center">0010</td><td style="text-align:center">0110</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1101</td><td style="text-align:center">1000</td><td style="text-align:center">1101</td><td style="text-align:center">1010</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1110</td><td style="text-align:center">1001</td><td style="text-align:center">1110</td><td style="text-align:center">1011</td></tr><tr><td style="text-align:center">x</td><td style="text-align:center">1111</td><td style="text-align:center">1010</td><td style="text-align:center">1111</td><td style="text-align:center">1110</td></tr></tbody></table></div><p>格雷码又叫循环码，它的优点是，相邻的代码之间只有一位发生变化。因此，格雷码有助于提高系统的抗干扰性能和可靠性，能够提高系统工作速度。</p><div class="table-container"><table><thead><tr><th style="text-align:center">十进制数码</th><th style="text-align:center">二进制代码</th><th style="text-align:center">格雷码</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0000</td><td style="text-align:center">0000</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0001</td><td style="text-align:center">0001</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">0010</td><td style="text-align:center">0011</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">0011</td><td style="text-align:center">0010</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">0100</td><td style="text-align:center">0110</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">0101</td><td style="text-align:center">0111</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">0110</td><td style="text-align:center">0101</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">0111</td><td style="text-align:center">0100</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">1000</td><td style="text-align:center">1100</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">1001</td><td style="text-align:center">1101</td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">1010</td><td style="text-align:center">1111</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">1011</td><td style="text-align:center">1110</td></tr><tr><td style="text-align:center">12</td><td style="text-align:center">1100</td><td style="text-align:center">1010</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">1101</td><td style="text-align:center">1011</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">1110</td><td style="text-align:center">1001</td></tr><tr><td style="text-align:center">15</td><td style="text-align:center">1111</td><td style="text-align:center">1000</td></tr></tbody></table></div><h2 id="原码、反码、补码"><a href="#原码、反码、补码" class="headerlink" title="原码、反码、补码"></a>原码、反码、补码</h2><p>二进制数以 0 表示正数“+”，1 表示负数“-”。原码即在二进制数绝对值左侧加上符号位。<br>对于正数，它的反码、补码与原码相同。<br>对于负数，保持符号位不变，数值部分按位求反，即为反码；在反码的基础上，保持符号位不变，数值部分再加 1，即为补码。<br>已知反码，对其求反码即为原码；已知补码，对其求补码即为原码。</p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%A1%AC%E4%BB%B6%E7%9F%A5%E8%AF%86/">硬件知识</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E7%94%B5/">数电</category>
      
      
      <comments>https://gavin-chen.top/post/ca0077c.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>音乐工具相关分享</title>
      <link>https://gavin-chen.top/post/efb0b0af.html</link>
      <guid>https://gavin-chen.top/post/efb0b0af.html</guid>
      <pubDate>Mon, 17 Jul 2023 05:02:38 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;YesPlayMusic&quot;&gt;&lt;a href=&quot;#YesPlayMusic&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="YesPlayMusic"><a href="#YesPlayMusic" class="headerlink" title="YesPlayMusic"></a>YesPlayMusic</h2><p>我在逛朋友的博客的时候，发现很多人都用过一个叫 <a href="https://github.com/qier222/YesPlayMusic">YesPlayMusic</a> 的开源的音乐播放器，界面优雅美观，觉得很不错。于是就去 github 找到了该项目的仓库，fork 了一份打算也放到我的网站里。但是试着听了几首歌之后发现有些无音源或者 VIP 的曲目还是无法播放，又仔细看了一下文档才知道，原来网页版不支持 <a href="https://github.com/UnblockNeteaseMusic/server#%E9%9F%B3%E6%BA%90%E6%B8%85%E5%8D%95">UnblockNeteaseMusic</a> 自动音源替换。<br>好在随手百度的时候看到了 B 站一个 UP 主 <a href="https://space.bilibili.com/11363292">ROGINX</a> 发的视频，他基于 YesPlayMusic 做了一些优化，使得网页版也支持了 UnblockNeteaseMusic 的音源替换功能，而且还做了手机端的 UI 适配（原版不支持）。这款 <a href="https://github.com/janxland/YesPlayMusic">改进版YesPlayMusic</a> 虽然不如原版稳定，存在一点点小 bug，但功能性上远胜原版。当然了，YesPlayMusic 是支持网易云账户登录的，如果本身有网易云黑胶会员，它也能识别出来，基本上就是不需要音乐解灰的，那用原版其实就可以了。<br><div class="tag link"><a class="link-card" title="YesPlayMusic+unblock——打造属于自己的高颜值音乐播放器" href="https://www.bilibili.com/video/BV1Fc411j7vR/?share_source=copy_web&vd_source=712717e9ea794f4f9612082ec2a80f7c"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OhHkyt.webp"/></div><div class="right"><p class="text">YesPlayMusic+unblock——打造属于自己的高颜值音乐播放器</p><p class="url">https://www.bilibili.com/video/BV1Fc411j7vR/?share_source=copy_web&vd_source=712717e9ea794f4f9612082ec2a80f7c</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— ROGINX</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div><br>在修正了一些界面显示上的小瑕疵后，我把它部署到了 vercel 上，成为了网站的一部分，现在可以进入 <a href="https://music.cansin.top">司音堂</a> 预览效果。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OhH7hv.webp" alt="首页界面"><br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OhHxsx.webp" alt="播放界面"><br>对于作者来说，该项目更多的应用还是在客户端，支持 Linux、Mac、Windows 三端应用。另外，该项目的 v2.0.0Alpha 版已经发布，相对于 v0.4.7 正式版，这款 Alpha 版界面进行了全面的替换升级，还改了个新的名字 R3PLAY，已经完全不是一个东西了。当然，毕竟是 Alpha 版，bug 还是不少的，等正式版出来再搞一搞。</p><h2 id="黑胶侠"><a href="#黑胶侠" class="headerlink" title="黑胶侠"></a>黑胶侠</h2><p>其实我本身是个 QQ 音乐用户，所以没有特意去充这个网易云的黑胶会员，但偶尔也会来网易云听一听，就会有这么个短期的黑胶的需求。有一天无意就发现了一个叫“黑胶侠”的公众号，它里面有免费的黑胶会员周卡，我试着用了一次，确实可以。只可惜这个周卡仅限非会员兑换，而且一个月只能兑换一次。后来加了他们的粉丝群，想不到里面福利更多，他们有一个积分系统，时不时完成个任务就有几十个积分，然后你可以用 80 个积分兑换一张周卡，310 个积分兑换一张月卡，而且这个卡是可以叠加的，无门槛。因为我不怎么听网易云，所以一般不兑月卡，想听的时候就兑一张周卡，这样比较划算。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308271903077.webp" alt="黑胶周卡"></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/">生活日常</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E5%88%86%E4%BA%AB/">分享</category>
      
      
      <comments>https://gavin-chen.top/post/efb0b0af.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>利用vercel部署一个简单的后端程序</title>
      <link>https://gavin-chen.top/post/27d667eb.html</link>
      <guid>https://gavin-chen.top/post/27d667eb.html</guid>
      <pubDate>Fri, 14 Jul 2023 05:09:17 GMT</pubDate>
      
      <description>小白文</description>
      
      
      
      <content:encoded><![CDATA[<p>有些 API 请求需要用到密钥，直接将密钥暴露在前端存在一定的风险，那么可以尝试把该部分程序放在服务器端执行，直接把结果返回给前端。<br>听起来很有道理，可惜我不会。不会就去现学，在 ChatGPT 这个不靠谱的老师教导下，摸索半天终于搞出了点效果。<br>这里整理记录一下，也不知道对不对。</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>这里以和风天气为例，做个获取当前城市天气信息的 API。和风天气有现成的插件，但是样式是固定的，只能添加一个插件，而且密钥是暴露在前端的。所以我打算用和风天气 API 获取天气数据。和风天气 API 请求 URL 结构如下：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://devapi.qweather.com/v7/weather/now?location=xxx&amp;key=xxx</span><br><span class="line">\___/   \_________________/\______________/\__________________/</span><br><span class="line">scheme           host   (port)   path        query parameters</span><br></pre></td></tr></table></figure><blockquote><p>其中重要参数：</p><ul><li>location: 城市代码；</li><li>key: 和风 KEY。</li></ul></blockquote><p>参考文档：<br><div class="tag link"><a class="link-card" title="实时天气" href="https://dev.qweather.com/docs/api/weather/weather-now"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/和风天气.webp"/></div><div class="right"><p class="text">实时天气</p><p class="url">https://dev.qweather.com/docs/api/weather/weather-now</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— 和风天气</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div></p><p>和风 KEY 在控制台可以找到，城市代码则需要由和风天气 GeoAPI 城市搜索功能获取。GeoAPI 城市搜索请求 URL 结构如下：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://geoapi.qweather.com/v2/city/lookup?location=xxx&amp;adm=xxx&amp;key=xxx</span><br><span class="line">\___/   \_________________/\______________/\__________________________/</span><br><span class="line">scheme          host    (port)   path            query parameters</span><br></pre></td></tr></table></figure><blockquote><p>其中重要参数：</p><ul><li>location: 必选，城市名称；</li><li>adm: 可选，所属上一级行政区域；</li><li>key: 必选，和风 KEY；</li><li>另外还有 range、number、lang 等可选参数，这里暂不需要。</li></ul></blockquote><p>参考文档：<br><div class="tag link"><a class="link-card" title="GeoAPI - 城市搜索" href="https://dev.qweather.com/docs/api/geoapi/city-lookup/"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/和风天气.webp"/></div><div class="right"><p class="text">GeoAPI - 城市搜索</p><p class="url">https://dev.qweather.com/docs/api/geoapi/city-lookup/</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— 和风天气</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div></p><p>这里城市名称需要用到 <a href="https://lbs.qq.com/dev/console/application/mine">腾讯位置服务</a> 的 IP 定位功能。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://apis.map.qq.com/ws/location/v1/ip?ip=xxx&amp;key=xxx</span><br><span class="line">\___/   \_____________/\_________________/\____________/</span><br><span class="line">scheme        host  (port)    path       query parameters</span><br></pre></td></tr></table></figure><blockquote><p>其中重要参数：</p><ul><li>ip: 客户端 IP 地址；</li><li>key: 腾讯 KEY。</li></ul></blockquote><p>参考文档：<br><div class="tag link"><a class="link-card" title="WebService API - 开发指南 - IP定位" href="https://lbs.qq.com/service/webService/webServiceGuide/webServiceIp"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/腾讯位置服务.webp"/></div><div class="right"><p class="text">WebService API - 开发指南 - IP定位</p><p class="url">https://lbs.qq.com/service/webService/webServiceGuide/webServiceIp</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— 腾讯位置服务</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div></p><p>客户端 IP 地址由前端获取并传入，这里采用的由 <a href="https://www.ipify.org/">Paul Seelman</a> 提供的 IP 定位服务，无需参数，自动获取当前网络 IP。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.ipify.org?format=json&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ipAddress = data.<span class="property">ip</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IP 地址：&quot;</span> + ipAddress);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取 IP 地址失败:&#x27;</span>, error);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>整体流程如下：</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OzpslD.webp" alt="流程图"></p><h2 id="新建-github-仓库"><a href="#新建-github-仓库" class="headerlink" title="新建 github 仓库"></a>新建 github 仓库</h2><p>首先，我们在 github 新建一个 <code>私有的</code> 仓库，并上传几个文件。</p><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3><p>这里包含了服务器端处理的程序，注意文件名一定要是 <strong>index</strong> ，包括后面的文件里也要保持一致。另外为解决跨域问题，需要引入 cors 模块，将你的域名填入白名单。</p><blockquote><p>这里按理说使用通配符“*”就可以，但是不知道为什么没有效果，就老老实实写全域名了。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入所需包和模块</span></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>(); <span class="comment">// 导入 dotenv 并加载 .env 文件</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>(&#123;</span><br><span class="line">  <span class="attr">origin</span>: [<span class="string">&#x27;https://cansin.top&#x27;</span>, <span class="string">&#x27;https://blog.cansin.top&#x27;</span>, <span class="string">&#x27;https://gavin-chen.top&#x27;</span>, <span class="string">&#x27;https://*.gavin-chen.top&#x27;</span>] <span class="comment">// 指定允许跨域访问的域名</span></span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// 创建 Express 应用程序</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"><span class="comment">// 路由和处理程序</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/weather&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ip = req.<span class="property">query</span>.<span class="property">ip</span>; <span class="comment">// 请求后面带ip的值，格式：domain/weather?ip=xxx</span></span><br><span class="line">    <span class="keyword">const</span> weatherKey = process.<span class="property">env</span>.<span class="property">WEATHER_API_KEY</span>; <span class="comment">// 从环境变量中获取 API 密钥</span></span><br><span class="line">    <span class="keyword">const</span> locationKey = process.<span class="property">env</span>.<span class="property">LOCATION_API_KEY</span>; <span class="comment">// 从环境变量中获取 API 密钥</span></span><br><span class="line">    <span class="keyword">var</span> weatherNowJson = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> weatherJson = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> locationJson = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> response1 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://apis.map.qq.com/ws/location/v1/ip?ip=<span class="subst">$&#123;ip&#125;</span>&amp;key=<span class="subst">$&#123;locationKey&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> data1 = <span class="keyword">await</span> response1.<span class="title function_">json</span>();</span><br><span class="line">    locationJson = data1;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> province = data1.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">province</span>;</span><br><span class="line">      <span class="keyword">var</span> city = data1.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">city</span>;</span><br><span class="line">      <span class="keyword">var</span> district = data1.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">district</span>;</span><br><span class="line">      <span class="keyword">var</span> place = district == <span class="string">&#x27;&#x27;</span> ? city : district;</span><br><span class="line">      <span class="keyword">var</span> adm = district == <span class="string">&#x27;&#x27;</span> ? province : city;</span><br><span class="line">      <span class="keyword">const</span> response2 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://geoapi.qweather.com/v2/city/lookup?location=<span class="subst">$&#123;place&#125;</span>&amp;adm=<span class="subst">$&#123;adm&#125;</span>&amp;key=<span class="subst">$&#123;weatherKey&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">const</span> data2 = <span class="keyword">await</span> response2.<span class="title function_">json</span>();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> cityId = data2.<span class="property">location</span>[<span class="number">0</span>].<span class="property">id</span>;</span><br><span class="line">        <span class="keyword">const</span> response3 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://devapi.qweather.com/v7/weather/now?location=<span class="subst">$&#123;cityId&#125;</span>&amp;key=<span class="subst">$&#123;weatherKey&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> data3 = <span class="keyword">await</span> response3.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">const</span> response4 = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://devapi.qweather.com/v7/weather/24h?location=<span class="subst">$&#123;cityId&#125;</span>&amp;key=<span class="subst">$&#123;weatherKey&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> data4 = <span class="keyword">await</span> response4.<span class="title function_">json</span>();</span><br><span class="line">        weatherNowJson = data3;</span><br><span class="line">        weatherJson = data4;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; weatherNowJson, weatherJson, locationJson &#125;); <span class="comment">// 将 JSON 数据返回给前端</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Internal Server Error3&#x27;</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Internal Server Error2&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;Internal Server Error1&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line"><span class="keyword">const</span> server = app.<span class="title function_">listen</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> port = server.<span class="title function_">address</span>().<span class="property">port</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>这里注意文件名 index.js ，还有 dependencies 中列出所有需要的包。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;projectname&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node index.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gavin&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MIT&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;axios&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.27.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.18.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dotenv&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;node-fetch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cors&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.8.5&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="vercel-json"><a href="#vercel-json" class="headerlink" title="vercel.json"></a>vercel.json</h3><p>这里在环境变量里填入密钥。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;builds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;use&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@vercel/node&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/(.*)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;WEATHER_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;LOCATION_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="导入-vercel"><a href="#导入-vercel" class="headerlink" title="导入 vercel"></a>导入 vercel</h2><p>接下来就是在 vercel 导入该仓库，并绑定自己的域名，比如 <a href="https://api.domain.com">https://api.domain.com</a> ，此时在浏览器输入 <a href="https://api.domain.com/weather?ip=xxx.xxx.xxx.xxx">https://api.domain.com/weather?ip=xxx.xxx.xxx.xxx</a> ，即可返回一串包含了天气信息的 json 数据。</p><h2 id="前端处理"><a href="#前端处理" class="headerlink" title="前端处理"></a>前端处理</h2><p>注意 url 后加上 <strong>&#39;&amp;output=jsonp&#39;</strong> ，防止跨域问题。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.ipify.org?format=json&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ipAddress = data.<span class="property">ip</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IP 地址：&quot;</span> + ipAddress);</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://apis.cansin.top/weather?ip=&#x27;</span>+ipAddress+<span class="string">&#x27;&amp;output=jsonp&#x27;</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">                <span class="comment">// 此处填写json数据读取与处理程序</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取天气信息失败:&#x27;</span>, error);</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取 IP 地址失败:&#x27;</span>, error);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>目前来看，利用ChatGPT学习还是不太方便的，首先是对提问的句式有很高的要求，其次给出的答案经常不是最优解，甚至常常给出错误答案（比如代码方面），我需要不停的发现问题，纠正它的错误——这其实还不如一篇CSDN的经验贴。因此，作为初学者，还是老老实实看一些系统性的课程或者专业的书籍，而ChatGPT可以作为一本辞典来使用。<br>上面的代码很多地方还没琢磨明白，有空还是得翻翻文档仔细研究研究。<br>最后要感谢Wei Wei视频的讲解，照着现成的项目摸索简直是事半功倍，希望这种小白类的视频可以多一点。<br><div class="tag link"><a class="link-card" title="使用 Vercel 部署前端与后端项目（React，NodeJS API Service）" href="https://www.youtube.com/watch?v=fz77TeUTkPE"><div class="main"><div class="left"><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/202308271835006.webp"/></div><div class="right"><p class="text">使用 Vercel 部署前端与后端项目（React，NodeJS API Service）</p><p class="url">https://www.youtube.com/watch?v=fz77TeUTkPE</p></div><i class="fa fa-chevron-right"></i></div><div class="end"><p>From —— Wei Wei</p><p>引自外站地址，不确保可用性和安全性</p></div></a></div></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%89%8D%E7%AB%AF%E5%90%8E%E7%AB%AF/">前端后端</category>
      
      
      <category domain="https://gavin-chen.top/tags/node-js/">node.js</category>
      
      
      <comments>https://gavin-chen.top/post/27d667eb.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>长文本滚动动效</title>
      <link>https://gavin-chen.top/post/de0459c0.html</link>
      <guid>https://gavin-chen.top/post/de0459c0.html</guid>
      <pubDate>Wed, 12 Jul 2023 03:01:33 GMT</pubDate>
      
      <description>文本溢出视窗时，自动开启滚动显示动效</description>
      
      
      
      <content:encoded><![CDATA[<p>有些地方需要显示完整的文本，但容器的宽度是固定死的，所以就需要滚动显示的功能。由于文本内容长短不一，只有溢出容器宽度的文本需要滚动显示，而短文本则保持静态显示。</p><p>具体框架需要两层结构，一个外层固定视窗，一个内层滚动文本。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;A&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;B&quot;</span>&gt;</span>长长长长长长长长长长长长长长长文本<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>首先确定滚动的路径，要想使得滚动动效无缝衔接，那么就让B从A的右端点出发，向左滚动，直到B的右端点到达A的左端点。通过@keyframes来创建动画的关键帧规则，一般以视窗A的左端点为O点，那么起点位置为A的右端点横坐标A.offsetWidth（实测为200px），终点位置为终止时B的左端点横坐标-B.offsetWidth（即-100%，此处%是相对于B来说）。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/Ozz4Px.jpg" alt="位移轨迹"><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> marquee &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">200px</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#A</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap; <span class="comment">/* 不换行 */</span></span><br><span class="line">    <span class="attribute">overflow</span>: hidden; <span class="comment">/* 溢出部分隐藏 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过js判断是否为长文本，长文本则开启滚动显示。这里设置为无限滚动，每次滚动10s。可根据需要控制总滚动时长，也可以替换成注释部分，则为匀速滚动。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> marqueeContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> marqueeContent = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">marquee</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (marqueeContent.<span class="property">offsetWidth</span> &gt; marqueeContainer.<span class="property">offsetWidth</span>) &#123;</span><br><span class="line">        <span class="comment">// var speed = marqueeContent.offsetWidth / marqueeContainer.offsetWidth * 5</span></span><br><span class="line">        <span class="comment">// marqueeContent.style.animation = &#x27;marquee &#x27; + speed + &#x27;s linear infinite&#x27;</span></span><br><span class="line">        marqueeContent.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">&#x27;marquee 10s linear infinite&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        marqueeContent.<span class="property">style</span>.<span class="property">animation</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>最终效果如下：<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OziZT1.gif" alt=""></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%89%8D%E7%AB%AF%E5%90%8E%E7%AB%AF/">前端后端</category>
      
      
      <category domain="https://gavin-chen.top/tags/CSS/">CSS</category>
      
      <category domain="https://gavin-chen.top/tags/JavaScript/">JavaScript</category>
      
      
      <comments>https://gavin-chen.top/post/de0459c0.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>罗技MX Master 2S鼠标指针失灵问题修复</title>
      <link>https://gavin-chen.top/post/2a10698b.html</link>
      <guid>https://gavin-chen.top/post/2a10698b.html</guid>
      <pubDate>Mon, 10 Jul 2023 15:17:14 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;这款罗技的MX Master 2S鼠标是我2020年买的，到现在用了快3年了。它有很多特色的功能，比如按键功能自定义、Logi</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>这款罗技的MX Master 2S鼠标是我2020年买的，到现在用了快3年了。它有很多特色的功能，比如按键功能自定义、Logi Flow、滚轮速度可调等。我最喜欢的就是它的滚轮，当你拨动滚轮施加的初速度超过某个阈值，他就会开启快速滚动模式，滚轮就像轴承一样快速转动，直到速度降到阈值以下立即停止，还蛮有意思的。其他的基础功能做的也不错，连接速度、响应速度、稳定性都是一流的，外形也是人体工学设计，握着很舒服。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OzbmMc.webp" alt="MX Master 2S"></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>第一次出现问题是在去年夏天，本来它一直用的很好，结果突然就指针不能动了，点了点左右键还是正常的，其他像滚轮、前后键也都是正常的。</p><p>在测试了其他鼠标后确定了不是电脑问题，尝试更新了一下驱动，也没有效果。于是拨通了罗技的售后电话，u1s1，这罗技的售后电话是真难找，他们那个热线经常换号码，打过去显示的还不是什么罗技售后热线，而是“XX亲子轮滑培训”，真是奇奇怪怪。由于罗技的产品是一年保修，已经远远过了保修期，而且售后小哥说这个不支持寄修，所以就尝试远程指导我，无非就是重装个驱动、重置下设备，当然也没找到问题根源，售后小哥说也是第一次遇到这种情况，估计是光电传感器坏了，只能让我自己线下去找第三方修。当时打算搁置一段时间再修，先用备用鼠标顶着，没想到没过几天它自己好了，我就用回了Master2S。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>几个月后第二次出现了指针失灵的问题，我百度了好久终于在B站一个帖子上发现了别人跟我一模一样的问题，这才找到了问题的根源。原来，这款鼠标的拇指键在使用久了之后，会出现无法回弹的状况，使得该按键一直处于被按下的状态，而这个模式下指针是无法移动的，其他按键不受影响。这是这款鼠标的通病。通过up主的拆解图来看，拇指键的上层是一个与外壳一体的机械结构，回弹性较差；拇指键的下层是一块装有按键的电路板，所用按键是一片轻触微动开关，键程极短；由于上层部件与下层部件之间紧密贴合，没有缓冲空间，加上按键键程短、机械结构回弹弱，所以就很容易造成拇指键卡死，导致指针失灵。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>网上提供的解决办法有几种，比如可以把拇指键连接线剪掉，或者直接把拇指键模组拆除，亦或是更换微动按键。这些方法都可以，甚至，你敲一敲鼠标他也能自己回弹了，只不过“敲”这个方法治标不治本，过个几个星期问题又会复现。因为手头螺丝刀找不到了，本人又比较懒，就一直用“敲”的办法，拖了一年多。<br>这两天收拾抽屉正好把螺丝刀找到了，就顺手拆了一下鼠标，彻底解决拇指键的问题。为了保留拇指键能力，我选择了加大按键与机械结构的间隙——其实也就是把固定螺丝松半圈。本来想换个按键的，奈何电烙铁丢老家仓库了，没办法。<br>这鼠标拆起来很容易，起开螺丝，上下壳一扒拉就开了。一共6颗螺丝，其中2颗T5螺丝裸露在充电口两侧，另外左右两块橡胶垫下各有2颗M2螺丝。橡胶垫本来应该用热风枪的，可惜家里没有，就暴力硬撕了，事后涂点胶再粘上。扒开外壳，中间有一根FFC排线要小心断开。拇指键分板固定在上壳，由两颗黑色螺丝固定，拧松个半圈就够了。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/Ozbn1X.webp" alt="内部结构"><br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OzbiMi.webp" alt="拇指键模块背面"><br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/Ozb1Ht.webp" alt="拇指键模块正面"></p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>这款鼠标的滚轮实在是太糙了，中间的橡胶圈老化的很厉害，边缘还会产生一圈类似铜绿的锈渍，这东西还越擦越脏，简直惨不忍睹。淘宝倒是有配套的全金属滚轮模组卖，不过价格不便宜，也有些小毛病，想想还是算了，不如攒钱买Master3。</p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8/">生活日常</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%95%B0%E7%A0%81/">数码</category>
      
      
      <comments>https://gavin-chen.top/post/2a10698b.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>雾屿蓝</title>
      <link>https://gavin-chen.top/post/2f20fd25.html</link>
      <guid>https://gavin-chen.top/post/2f20fd25.html</guid>
      <pubDate>Fri, 07 Jul 2023 03:19:21 GMT</pubDate>
      
      <description>罗翔老师的哲学感悟</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OxJTnB.webp" alt="罗翔"></p><ol><li><p>古希腊哲学家爱比荷泰德说：“我们登上并非我们所选择的舞台，演绎并非我们所选择的剧本。”谁的剧本是自己选的？大家有时是不是很羡慕别人家的剧本？我有时也很羡慕别人的剧本，但是没办法，你的剧本不是你选择的。你只能选择努力演好你的剧本。虽然很痛苦，但只要努力演好，痛苦中也有精彩。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>唯有真理的光照，才能学会谦卑，走出自我的偏狭，而自由而不放纵，独立而不狂狷，尽责而不懈怠。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>我们必须接受这样一个事实，那就是没有人能活在确定性之中，对人生而言，我们唯一能确定的就是不确定的人生。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>我们常说天道酬勤，但事实上，人生的许多成就，个人的努力虽然重要，但自己所能决定的其实很少。有许多重要的关头，许多的贵人相助其实是可遇不可求的。所以只能以感恩的心来接受，并希望在自己有能力和有机会时也能够去祝福他人。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>当伸出一个手指指责他人，会有四个手指头对着自己。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>不要对人性抱以过高的期待，永远要警惕人性深处的幽暗。法治的前提就是对人性败坏的假设，所以任何人组成的权力机构都要受到法律严格的约束，权力从来就不应被完全信任。如果抛弃了这个假设，认为人性良善，法治也一定会为人治所取代，对人性美好的假设往往都带来了空前的灾难。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>有时看到别人对我的批评，尤其是无理的指责，我也非常生气。但这个时候总有声音在提醒我，批评可以戳破人自恋的幻象，给人虚荣的气球放放气，让人不至于飘到无边的高处。在坚实的地面上，人才能有真实的生活。走出自恋，走出仇恨，成为一个真正富裕的人。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>功利性读书让你只想成功，无法接受失败。但我始终认为，一个人的真正成功不是在于你取得多少辉煌，而是在挫折中，你能不能勇敢地爬起来。只有非功利性阅读，才能让你坦然接受失败。在大量与功利无关的文学作品、名人传记中，主人公的失败、困苦、绝望比比皆是。那么多伟大的灵魂，他们也曾有跌倒的时候，你为什么不能跌倒？</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>道德的使命首先是自律，而非他律，道德谴责的第一步永远是对自己发出的，我们必须先质问自己，在相似的情景下，我们会如何行为？</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>伪善的人最喜欢空谈崇高的话题。他们活在崇高的理念之下，用这种理念逃避对具体个体的责任，为自己的虚伪披上神圣的外袍。</p><p align="right">——罗翔《圆圈正义》</p></li><li><p>我们必须接受失望，因为失望是有限的，但我们永远不能放弃希望，因为希望是无限的。</p><p align="right">——马丁·路德·金</p></li></ol>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E8%AF%97%E5%92%8C%E8%BF%9C%E6%96%B9/">诗和远方</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E5%93%B2%E5%AD%A6/">哲学</category>
      
      
      <comments>https://gavin-chen.top/post/2f20fd25.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>LDO和DCDC</title>
      <link>https://gavin-chen.top/post/7c8508a1.html</link>
      <guid>https://gavin-chen.top/post/7c8508a1.html</guid>
      <pubDate>Mon, 29 May 2023 12:47:38 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h2 id=&quot;LDO&quot;&gt;&lt;a href=&quot;#LDO&quot; class=&quot;headerlink&quot; title=&quot;LDO&quot;&gt;&lt;/a&gt;LDO&lt;/h2&gt;&lt;p&gt;LDO（Low-Dropout</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h2 id="LDO"><a href="#LDO" class="headerlink" title="LDO"></a>LDO</h2><p>LDO（Low-Dropout Regulator，低压差稳压器），又称低压差线性稳压器、低压降稳压器，是线性直流稳压器（Linear Regulator）的一种，用途同是提供稳定的直流电压电源。相比于一般线性直流稳压器，低压差稳压器能于更小输出输入电压差的情况下工作。</p><p>注意，LDO是特指线性稳压器中损耗电压（drop-out voltage）较小的那一类。像经典的LM7805，只有输入电压在7伏以上的时候才能稳定输出5伏，也就是损耗高达2伏，这种线性稳压器就不是LDO。一般现代化的LDO经常有损耗低到0.2、0.3伏的。</p><p>常见的LDO器件有很多，比如我们熟悉的1117芯片，它可以把外界的5V输入电压转换成内部其他芯片所需要的3.3V电压。<br>根据制造厂商不同，前缀也不同，常见的就是AMS公司生产的<strong>AMS1117</strong>型号芯片，但是目前山寨较多。根据<a href="https://www.bilibili.com/video/BV1464y1v7Jd/?spm_id_from=333.337.search-card.all.click">工科男孙老师</a>的评测，TI公司的TLV1117性能最佳，长晶的CJT1117性价比最高，山寨的AMS1117不建议使用。</p><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OoDIBg.webp" alt=""></p><p>在使用方面需要注意的一点是，因为钽电容的寄生电阻较大，陶瓷电容的寄生电阻较小，而1117的稳定工作正是需要寄生电阻，所以在电路中，我们的输出滤波电容尽量使用钽电容，而不要使用陶瓷电容（mlcc，Multi-LayerCeramicCapacitor），否则会产生更大的纹波，导致电路的不稳定。另外1117还有一些缺点，比如体积太大，还有静态电流过高，一般在mA级别，不适合低功耗场景。</p><blockquote><p>LDO的缺点：<br>在高压差、大电流的情况下很容易发烫。LDO内部相当于有个可调电阻来控制输出的电压，多余的电压由内部可调电阻消耗掉，转换效率会比较低</p></blockquote><h3 id="LDO稳压原理"><a href="#LDO稳压原理" class="headerlink" title="LDO稳压原理"></a>LDO稳压原理</h3><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/OoV9k1.png" alt=""></p><p>LDO内部电路一般包括：基准电压、分压取样电路、误差放大电路、调整电路四个模块。LDO的原理是通过内部的反馈回路来监测输出电压，当输出电压偏离设定值时，控制回路会调整放大器的工作状态，使输出电压回到设定值附近。因此，LDO可以有效地抑制输入电压和负载变化对输出电压的影响，从而提供稳定的电源。</p><h3 id="LDO功耗计算"><a href="#LDO功耗计算" class="headerlink" title="LDO功耗计算"></a>LDO功耗计算</h3><p>LDO消耗的功率可以用如下的公式计算，其中 <script type="math/tex">I_B</script> 是静态电流，一般来说远小于 <script type="math/tex">I_{OUT}</script>，所以可以忽略，LDO功率就近似等于输入输出电压差与输出电流的乘积。</p><script type="math/tex; mode=display">P=(V_{IN}-V_{OUT}) × I_{OUT} + V_{IN}×I_B</script><h3 id="LDO温升计算"><a href="#LDO温升计算" class="headerlink" title="LDO温升计算"></a>LDO温升计算</h3><p>温升计算可以按下面的公式，其中P是LDO消耗的功率，<script type="math/tex">R_{th}</script> 是LDO的热阻，这个参数可以在LDO的规格书中找到，<script type="math/tex">T_a</script> 是环境温度，有了这三个参数，我们就能计算出LDO工作时的温度。</p><script type="math/tex; mode=display">T_j=P×R_{th(j-a)}+T_a</script><h2 id="DCDC"><a href="#DCDC" class="headerlink" title="DCDC"></a>DCDC</h2><p>DC/DC，直流-直流变换器，也叫switching regulator，即开关稳压器，或者叫 <strong>开关电源</strong> 。</p><blockquote><p>SMPS：</p><p>Switching Mode Power Supply，开关模式电源。根据输入及输出电压形式的不同，包括：<br>交流-交流（AC/AC）变换器：变频器、变压器<br>交流-直流（AC/DC）变换器：整流器<br>直流-交流（DC/AC）变换器：逆变器<br>直流-直流（DC/DC）变换器：电压变换器、电流变换器</p></blockquote><p>DC/DC按电压等级变换关系分 <strong>升压电源</strong> 和 <strong>降压电源</strong> 两类，按输入输出关系分 <strong>隔离电源</strong> 和 <strong>无隔离电源</strong> 两类。<br>例如，降压斩波器（Buck Converter）只能降压不能升压，升压斩波器（Boost Converter） 只能升压不能降压。而降压-升压斩波器（Buck-Boost Converter），则能做到既可以降压又可以升压。</p><p>DCDC内部相当于有一个周期性开闭的开关，通过控制开关的时间间隔来控制输出的电压（例如12V转5V的开关电源其PWM高低电平占空比就为5:7），所以发热就会小的多，转换效率也可以达到很高。但由于周期性的开关，所以也会导致输出纹波较大，电源平稳度不太高，而且由于会产生PWM波，其所需要的周边电路也会比LDO器件更加复杂。</p><div class="table-container"><table><thead><tr><th style="text-align:center">LDO</th><th style="text-align:center">DCDC</th></tr></thead><tbody><tr><td style="text-align:center">适合低压差小电流场景</td><td style="text-align:center">适合高压差大电流场景</td></tr><tr><td style="text-align:center">纹波小</td><td style="text-align:center">纹波大</td></tr><tr><td style="text-align:center">效率低</td><td style="text-align:center">效率高</td></tr><tr><td style="text-align:center">发热高</td><td style="text-align:center">发热低</td></tr><tr><td style="text-align:center">成本低</td><td style="text-align:center">成本高</td></tr><tr><td style="text-align:center">周边电路简单</td><td style="text-align:center">周边电路复杂</td></tr><tr><td style="text-align:center">静态功耗低</td><td style="text-align:center">静态功耗高</td></tr></tbody></table></div>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E7%A1%AC%E4%BB%B6%E7%9F%A5%E8%AF%86/">硬件知识</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E7%94%B5%E6%BA%90/">电源</category>
      
      <category domain="https://gavin-chen.top/tags/%E7%A8%B3%E5%8E%8B%E5%99%A8/">稳压器</category>
      
      
      <comments>https://gavin-chen.top/post/7c8508a1.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>超级圆角</title>
      <link>https://gavin-chen.top/post/7c589660.html</link>
      <guid>https://gavin-chen.top/post/7c589660.html</guid>
      <pubDate>Sun, 05 Mar 2023 07:33:37 GMT</pubDate>
      
      <description>更美观的圆角矩形</description>
      
      
      
      <content:encoded><![CDATA[<p>在前端设计中，常使用border-radius属性构造圆角矩形，以形成视觉上的美感。在工业设计中，也存在大量圆角过渡设计。在工业设计中，根据两条线连接的方式，划分了G0-G4五个等级<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature"></span><span class="reference-title">参考资料</span></span></span>。</p><ul><li>G0——点连续：只要两个点碰到就可以；</li><li>G1——相切连续：没有棱角，所有点之间都是相切关系；</li><li>G2——曲率连续：平滑过渡，曲率是连续变化的；</li><li>G3——曲率变化率连续：更平滑，曲率的变化率也是连续的；</li><li>G4——曲率变化率的变化率连续：极致丝滑。</li></ul><p>我们常用的border-radius可以实现G1级别的切线连续圆角，而现在，越来越多的设计开始使用G2以上级别的圆角。G2以上级别的圆角过渡更加平滑，也更美观、更耐看。<br>目前博客的音乐控制器、小组件等就是采用的G2级别的曲率连续圆角。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/YzpDX.webp" alt=""></p><center style='font-size:1.1rem'>图1 切线连续圆角（左）与曲率连续圆角（右）对比<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature"></span><span class="reference-title">参考资料</span></span></span></center><h2 id="新建paint-js"><a href="#新建paint-js" class="headerlink" title="新建paint.js"></a>新建paint.js</h2><p>在路径<code>source/js</code>文件夹下新建一个<code>paint.js</code>文件，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SmoothCorners</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">inputProperties</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;--smooth-level&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">paint</span>(<span class="params">ctx, geom, properties</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> radius = <span class="built_in">parseInt</span>(properties.<span class="title function_">get</span>(<span class="string">&#x27;--smooth-level&#x27;</span>).<span class="title function_">toString</span>());</span><br><span class="line">        <span class="keyword">const</span> path = <span class="keyword">new</span> <span class="title class_">Path2D</span>();</span><br><span class="line">        path.<span class="title function_">moveTo</span>(radius, <span class="number">0</span>);</span><br><span class="line">        path.<span class="title function_">lineTo</span>(geom.<span class="property">width</span> - radius, <span class="number">0</span>);</span><br><span class="line">        path.<span class="title function_">quadraticCurveTo</span>(geom.<span class="property">width</span>, <span class="number">0</span>, geom.<span class="property">width</span>, radius);</span><br><span class="line">        path.<span class="title function_">lineTo</span>(geom.<span class="property">width</span>, geom.<span class="property">height</span> - radius);</span><br><span class="line">        path.<span class="title function_">quadraticCurveTo</span>(geom.<span class="property">width</span>, geom.<span class="property">height</span>, geom.<span class="property">width</span> - radius, geom.<span class="property">height</span>);</span><br><span class="line">        path.<span class="title function_">lineTo</span>(radius, geom.<span class="property">height</span>);</span><br><span class="line">        path.<span class="title function_">quadraticCurveTo</span>(<span class="number">0</span>, geom.<span class="property">height</span>, <span class="number">0</span>, geom.<span class="property">height</span> - radius);</span><br><span class="line">        path.<span class="title function_">lineTo</span>(<span class="number">0</span>, radius);</span><br><span class="line">        path.<span class="title function_">quadraticCurveTo</span>(<span class="number">0</span>, <span class="number">0</span>, radius, <span class="number">0</span>);</span><br><span class="line">        ctx.<span class="title function_">fill</span>(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">registerPaint</span>(<span class="string">&#x27;smooth-corners&#x27;</span>, <span class="title class_">SmoothCorners</span>);</span><br></pre></td></tr></table></figure><h2 id="注册为Paint-Worklet"><a href="#注册为Paint-Worklet" class="headerlink" title="注册为Paint Worklet"></a>注册为Paint Worklet</h2><p>在自建js函数中加入以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;paintWorklet&#x27;</span> <span class="keyword">in</span> <span class="variable constant_">CSS</span>) &#123;<span class="variable constant_">CSS</span>.<span class="property">paintWorklet</span>.<span class="title function_">addModule</span>(<span class="string">&#x27;js/paint.js&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure><p>或者，也可以在主题设置文件<code>_config.butterfly.yml</code>中更改：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inject:</span><br><span class="line">  head:</span><br><span class="line">  bottom:</span><br><span class="line"><span class="addition">+    - &lt;script&gt;if (&#x27;paintWorklet&#x27; in CSS) &#123;CSS.paintWorklet.addModule(&#x27;js/paint.js&#x27;);&#125;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>在对应样式中添加以下属性参数即可，此时主要通过<code>--smooth-level</code>值调整圆角大小。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-radius</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">mask-image</span>: <span class="built_in">paint</span>(smooth-corners);</span><br><span class="line">-webkit-<span class="attribute">mask-image</span>: <span class="built_in">paint</span>(smooth-corners);</span><br><span class="line"><span class="attr">--smooth-level</span>: <span class="number">7</span>; <span class="comment">/*曲率连续圆角*/</span></span><br></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.uisdc.com/xiaomi-logo-design">小米200万的Logo是如何绘制的？先掌握「连续曲率」知识点！</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://wow.techbrood.com/fiddle/60930">使用CSS Paint API实现曲率圆角效果</a></div>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%89%8D%E7%AB%AF%E5%90%8E%E7%AB%AF/">前端后端</category>
      
      
      <category domain="https://gavin-chen.top/tags/CSS/">CSS</category>
      
      <category domain="https://gavin-chen.top/tags/JavaScript/">JavaScript</category>
      
      
      <comments>https://gavin-chen.top/post/7c589660.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>侧边栏组件 - 日历</title>
      <link>https://gavin-chen.top/post/8b6f77a8.html</link>
      <guid>https://gavin-chen.top/post/8b6f77a8.html</guid>
      <pubDate>Wed, 01 Mar 2023 10:35:33 GMT</pubDate>
      
      <description>让侧边栏更有价值！</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p>侧边栏的开发空间很大，一些使用频率很高的功能可以集成在这里，方便我们的使用。所以我做了一个日历的小组件，样式参考的是TOP WIDGETS。<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/VmADj.webp" alt=""></p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><div class="tip info faa-horizontal animated"><p>感谢<a href="https://blog.leonus.cn/">Leonus</a>大佬提醒，漏了lunar.js和css代码，部分js另作修改，现已更正。</p></div><h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><ul><li><p><strong>lunar.js</strong><br>lunar.js是ChatGPT在Github上找的。<br><a href="https://github.com/wvv8oo/lunar/blob/master/lib/chinese-lunar.js">原作仓库地址</a></p></li><li><p><strong>demo.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 刷新时钟时间</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cardRefreshTimes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> a_t_r = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;aside-time-right&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (a_t_r) a_t_r.<span class="property">innerHTML</span> = now.<span class="title function_">getHours</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="string">&quot;:&quot;</span> + now.<span class="title function_">getMinutes</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="string">&quot;:&quot;</span> + now.<span class="title function_">getSeconds</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置重复执行函数，周期1000ms</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cardRefreshTimes</span>();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 侧边栏日历卡片</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cardTimes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">        year = now.<span class="title function_">getFullYear</span>(),</span><br><span class="line">        month = now.<span class="title function_">getMonth</span>(),</span><br><span class="line">        week = now.<span class="title function_">getDay</span>(),</span><br><span class="line">        date = now.<span class="title function_">getDate</span>(), dates, weekStr, monthStr, asideTime, asideDay, asideDayNum, animalYear, ganzhiYear, lunarMon, lunarDay;</span><br><span class="line">    <span class="keyword">var</span> year_flag = year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span> || year % <span class="number">400</span> == <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">switch</span> (week) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: weekStr = <span class="string">&quot;周日&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: weekStr = <span class="string">&quot;周一&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: weekStr = <span class="string">&quot;周二&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: weekStr = <span class="string">&quot;周三&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: weekStr = <span class="string">&quot;周四&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: weekStr = <span class="string">&quot;周五&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: weekStr = <span class="string">&quot;周六&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;异常情况&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (month) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: monthStr = <span class="string">&quot;一月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: monthStr = <span class="string">&quot;二月&quot;</span>; dates = year_flag ? <span class="number">29</span> : <span class="number">28</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: monthStr = <span class="string">&quot;三月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: monthStr = <span class="string">&quot;四月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: monthStr = <span class="string">&quot;五月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: monthStr = <span class="string">&quot;六月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: monthStr = <span class="string">&quot;七月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>: monthStr = <span class="string">&quot;八月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>: monthStr = <span class="string">&quot;九月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>: monthStr = <span class="string">&quot;十月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>: monthStr = <span class="string">&quot;十一月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>: monthStr = <span class="string">&quot;十二月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;异常情况&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> week_first = (week + <span class="number">8</span> - date % <span class="number">7</span>) % <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">var</span> count_days = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> count_flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> ds;</span><br><span class="line">    <span class="keyword">var</span> row_h = <span class="number">7</span> - week_first; <span class="comment">//第一行天数</span></span><br><span class="line">    <span class="keyword">var</span> row_f = (dates - row_h) % <span class="number">7</span>; <span class="comment">//最后一行的天数</span></span><br><span class="line">    <span class="keyword">var</span> rows = row_f == <span class="number">0</span> ? <span class="title class_">Math</span>.<span class="title function_">floor</span>((dates - row_h) / <span class="number">7</span>) + <span class="number">1</span> : <span class="title class_">Math</span>.<span class="title function_">floor</span>((dates - row_h) / <span class="number">7</span>) + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> calendar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-main&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> gap = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-date&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (rows) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;1.2rem&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;2.4rem&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;2.4rem&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span> + r) == <span class="literal">null</span>) &#123;</span><br><span class="line">            calendar.<span class="property">innerHTML</span> += <span class="string">&quot;&lt;div class=&#x27;calendar-r&quot;</span> + r + <span class="string">&quot;&#x27;&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> d = <span class="number">0</span>; d &lt; <span class="number">7</span>; d++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r == <span class="number">0</span> &amp;&amp; d == week_first) &#123; <span class="comment">//本月第一天</span></span><br><span class="line">                count_days = <span class="number">1</span>;</span><br><span class="line">                count_flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_days == date) &#123; <span class="comment">//当日日期</span></span><br><span class="line">                ds = <span class="string">&quot; class=&#x27;now&#x27;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> ds = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span> + r + <span class="string">&quot; .calendar-d&quot;</span> + d + <span class="string">&quot; a&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">                calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span> + r).<span class="property">innerHTML</span> += <span class="string">&quot;&lt;div class=&#x27;calendar-d&quot;</span> + d + <span class="string">&quot;&#x27;&gt;&lt;a&quot;</span> + ds + <span class="string">&quot;&gt;&quot;</span> + count_days + <span class="string">&quot;&lt;/a&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_days &gt;= dates) &#123;</span><br><span class="line">                count_days = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                count_flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_flag) count_days += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lunar = chineseLunar.<span class="title function_">solarToLunar</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(year, month, date));</span><br><span class="line">    animalYear = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;A&quot;</span>); <span class="comment">//生肖属相</span></span><br><span class="line">    ganzhiYear = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;T&quot;</span>).<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>); <span class="comment">//天干地支</span></span><br><span class="line">    lunarMon = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;M&quot;</span>); <span class="comment">//月份</span></span><br><span class="line">    lunarDay = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;d&quot;</span>); <span class="comment">//日期</span></span><br><span class="line">    asideTime = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2023/01/01 00:00:00&quot;</span>);<span class="comment">// 侧边栏倒计时</span></span><br><span class="line">    asideDay = (now - asideTime) / <span class="number">1e3</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>;</span><br><span class="line">    asideDayNum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(asideDay);</span><br><span class="line">    <span class="keyword">var</span> asideWeekNum = ((week - asideDayNum % <span class="number">7</span>) &gt;= <span class="number">0</span>) ? (<span class="title class_">Math</span>.<span class="title function_">ceil</span>(asideDayNum / <span class="number">7</span>)) : (<span class="title class_">Math</span>.<span class="title function_">ceil</span>(asideDayNum / <span class="number">7</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> c_m = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-month&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_w = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-week&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_d = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-date&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_a = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-animal&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_l = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-lunar&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> a_t_l = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;aside-time-left&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c_m) c_m.<span class="property">innerHTML</span> = monthStr; <span class="comment">//月份</span></span><br><span class="line">    <span class="keyword">if</span> (c_w) c_w.<span class="property">innerHTML</span> = weekStr; <span class="comment">//星期</span></span><br><span class="line">    <span class="keyword">if</span> (c_d) c_d.<span class="property">innerHTML</span> = date.<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>); <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">if</span> (c_a) c_a.<span class="property">innerHTML</span> = ganzhiYear + animalYear + <span class="string">&quot;年&quot;</span>; <span class="comment">//年份</span></span><br><span class="line">    <span class="keyword">if</span> (c_l) c_l.<span class="property">innerHTML</span> = lunarMon + lunarDay; <span class="comment">//农历</span></span><br><span class="line">    <span class="keyword">if</span> (a_t_l) a_t_l.<span class="property">innerHTML</span> = year + <span class="string">&quot;&amp;nbsp;&amp;nbsp;&lt;a style=&#x27;font-size:1.1rem;font-weight:bold;&#x27;&gt;第&lt;/a&gt;&amp;nbsp;&quot;</span> + asideWeekNum + <span class="string">&quot;&amp;nbsp;&lt;a style=&#x27;font-size:1.1rem;font-weight:bold;&#x27;&gt;周&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>demo.css</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.card-widget</span><span class="selector-class">.card-times</span> <span class="selector-class">.item-headline</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card-widget</span><span class="selector-class">.card-times</span> &#123;</span><br><span class="line">    <span class="attr">--calendar-bg</span>: <span class="built_in">rgb</span>(<span class="number">244</span> <span class="number">244</span> <span class="number">244</span> / <span class="number">70%</span>);</span><br><span class="line">    <span class="attribute">padding</span>: .<span class="number">8rem</span> <span class="meta">!important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> <span class="selector-class">.card-widget</span><span class="selector-class">.card-times</span> &#123;</span><br><span class="line">    <span class="attr">--calendar-bg</span>: <span class="built_in">rgba</span>(<span class="number">46</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.card-times</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-main</span> <span class="selector-class">.calendar-rh</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.7</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-calendar</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: fit-content;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-calendar</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--calendar-bg);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: .<span class="number">8rem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-area-top</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-calendar</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: .<span class="number">5rem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-time-left</span>,</span><br><span class="line"><span class="selector-id">#aside-time-right</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--calendar-bg);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: .<span class="number">5rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">2rem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-time-left</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">64%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#aside-time-right</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">36%</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: .<span class="number">5rem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-area-left</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-area-right</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-month</span>,</span><br><span class="line"><span class="selector-id">#calendar-week</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.1rem</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#0096ff</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: .<span class="number">5rem</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-month</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="built_in">calc</span>(<span class="number">7.14%</span> - .<span class="number">5rem</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-date</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3rem</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">3rem</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1.2rem</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-animal</span>,</span><br><span class="line"><span class="selector-id">#calendar-lunar</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: .<span class="number">9rem</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-main</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#calendar-main</span> <span class="selector-tag">a</span><span class="selector-class">.now</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#0096ff</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.calendar-r0</span>,</span><br><span class="line"><span class="selector-class">.calendar-r1</span>,</span><br><span class="line"><span class="selector-class">.calendar-r2</span>,</span><br><span class="line"><span class="selector-class">.calendar-r3</span>,</span><br><span class="line"><span class="selector-class">.calendar-r4</span>,</span><br><span class="line"><span class="selector-class">.calendar-rh</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1.2rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.calendar-d0</span>,</span><br><span class="line"><span class="selector-class">.calendar-d1</span>,</span><br><span class="line"><span class="selector-class">.calendar-d2</span>,</span><br><span class="line"><span class="selector-class">.calendar-d3</span>,</span><br><span class="line"><span class="selector-class">.calendar-d4</span>,</span><br><span class="line"><span class="selector-class">.calendar-d5</span>,</span><br><span class="line"><span class="selector-class">.calendar-d6</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">14.28%</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><div class="tip warning faa-horizontal animated"><p>以下是旧版文章</p></div><h3 id="新建widget-yml"><a href="#新建widget-yml" class="headerlink" title="新建widget.yml"></a>新建widget.yml</h3><p>在<code>source/_data</code>路径下新建一个<code>widget.yml</code>文件<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">top:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">class_name:</span> <span class="string">card-times</span></span><br><span class="line">    <span class="attr">id_name:</span> </span><br><span class="line">    <span class="attr">name:</span></span><br><span class="line">    <span class="attr">icon:</span></span><br><span class="line">    <span class="attr">html:</span></span><br><span class="line">      <span class="string">&lt;div</span> <span class="string">id=&quot;aside-area-top&quot;&gt;</span></span><br><span class="line">        <span class="string">&lt;div</span> <span class="string">id=&quot;aside-time-left&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">        <span class="string">&lt;div</span> <span class="string">id=&quot;aside-time-right&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">      <span class="string">&lt;/div&gt;</span></span><br><span class="line">      <span class="string">&lt;div</span> <span class="string">id=&quot;aside-calendar&quot;&gt;</span></span><br><span class="line">        <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-area-left&quot;&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-week&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-date&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-animal&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-lunar&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">        <span class="string">&lt;/div&gt;</span></span><br><span class="line">        <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-area-right&quot;&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-month&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">          <span class="string">&lt;div</span> <span class="string">id=&quot;calendar-main&quot;&gt;</span></span><br><span class="line">            <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-rh&quot;&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d0&quot;&gt;&lt;a&gt;日&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d1&quot;&gt;&lt;a&gt;一&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d2&quot;&gt;&lt;a&gt;二&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d3&quot;&gt;&lt;a&gt;三&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d4&quot;&gt;&lt;a&gt;四&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d5&quot;&gt;&lt;a&gt;五&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">              <span class="string">&lt;div</span> <span class="string">class=&quot;calendar-d6&quot;&gt;&lt;a&gt;六&lt;/a&gt;&lt;/div&gt;</span></span><br><span class="line">            <span class="string">&lt;/div&gt;</span></span><br><span class="line">          <span class="string">&lt;/div&gt;</span></span><br><span class="line">        <span class="string">&lt;/div&gt;</span></span><br><span class="line">      <span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="runtime-js"><a href="#runtime-js" class="headerlink" title="runtime.js"></a>runtime.js</h3><p>路径<code>source/js</code>下新建<code>runtime.js</code>文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">var</span> year, month, week, date, dates, weekStr, monthStr;</span><br><span class="line"><span class="keyword">var</span> asideTime, asideDay, asideDayNum;</span><br><span class="line"><span class="keyword">var</span> animalYear, ganzhiYear, lunarMon, lunarDay;</span><br><span class="line"><span class="title function_">cardTimes</span>();</span><br><span class="line"><span class="comment">// 刷新时钟时间</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cardRefreshTimes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a_t_r = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;aside-time-right&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(a_t_r)a_t_r.<span class="property">innerHTML</span> = now.<span class="title function_">getHours</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="string">&quot;:&quot;</span> + now.<span class="title function_">getMinutes</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="string">&quot;:&quot;</span> + now.<span class="title function_">getSeconds</span>().<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置重复执行函数，周期1000ms</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cardRefreshTimes</span>();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p><h3 id="calendar-js"><a href="#calendar-js" class="headerlink" title="calendar.js"></a>calendar.js</h3><p>路径<code>source/js</code>下新建<code>calendar.js</code>文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 侧边栏日历卡片</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cardTimes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    year = now.<span class="title function_">getFullYear</span>();</span><br><span class="line">    month = now.<span class="title function_">getMonth</span>();</span><br><span class="line">    week = now.<span class="title function_">getDay</span>();</span><br><span class="line">    date = now.<span class="title function_">getDate</span>();</span><br><span class="line">    <span class="keyword">var</span> year_flag = year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; year % <span class="number">100</span> != <span class="number">0</span> || year % <span class="number">400</span> == <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">switch</span> (week) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: weekStr = <span class="string">&quot;周日&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: weekStr = <span class="string">&quot;周一&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: weekStr = <span class="string">&quot;周二&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: weekStr = <span class="string">&quot;周三&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: weekStr = <span class="string">&quot;周四&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: weekStr = <span class="string">&quot;周五&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: weekStr = <span class="string">&quot;周六&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;异常情况&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (month) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: monthStr = <span class="string">&quot;一月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: monthStr = <span class="string">&quot;二月&quot;</span>; dates = year_flag ? <span class="number">29</span> : <span class="number">28</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: monthStr = <span class="string">&quot;三月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: monthStr = <span class="string">&quot;四月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: monthStr = <span class="string">&quot;五月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: monthStr = <span class="string">&quot;六月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: monthStr = <span class="string">&quot;七月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>: monthStr = <span class="string">&quot;八月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>: monthStr = <span class="string">&quot;九月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>: monthStr = <span class="string">&quot;十月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>: monthStr = <span class="string">&quot;十一月&quot;</span>; dates = <span class="number">30</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>: monthStr = <span class="string">&quot;十二月&quot;</span>; dates = <span class="number">31</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;异常情况&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> week_first = (week + <span class="number">8</span> - date % <span class="number">7</span>) % <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">var</span> count_days = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> count_flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> ds;</span><br><span class="line">    <span class="keyword">var</span> row_h = <span class="number">7</span> - week_first; <span class="comment">//第一行天数</span></span><br><span class="line">    <span class="keyword">var</span> row_f = (dates - row_h) % <span class="number">7</span>; <span class="comment">//最后一行的天数</span></span><br><span class="line">    <span class="keyword">var</span> rows = row_f == <span class="number">0</span> ? <span class="title class_">Math</span>.<span class="title function_">floor</span>((dates - row_h) / <span class="number">7</span>) + <span class="number">1</span> : <span class="title class_">Math</span>.<span class="title function_">floor</span>((dates - row_h) / <span class="number">7</span>) + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> calendar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-main&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> gap = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-date&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (rows) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;&quot;</span>;<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;1.2rem&quot;</span>;<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;2.4rem&quot;</span>;<span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>: gap.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&quot;2.4rem&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> r = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span> + r) == <span class="literal">null</span>) &#123;</span><br><span class="line">            calendar.<span class="property">innerHTML</span> += <span class="string">&quot;&lt;div class=&#x27;calendar-r&quot;</span>+r+<span class="string">&quot;&#x27;&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> d = <span class="number">0</span>; d &lt; <span class="number">7</span>; d++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r == <span class="number">0</span> &amp;&amp; d == week_first) &#123; <span class="comment">//本月第一天</span></span><br><span class="line">                count_days = <span class="number">1</span>;</span><br><span class="line">                count_flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_days == date) &#123; <span class="comment">//当日日期</span></span><br><span class="line">                ds = <span class="string">&quot; class=&#x27;now&#x27;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> ds = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span> + r + <span class="string">&quot; .calendar-d&quot;</span> + d + <span class="string">&quot; a&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">                calendar.<span class="title function_">querySelector</span>(<span class="string">&quot;.calendar-r&quot;</span>+r).<span class="property">innerHTML</span> += <span class="string">&quot;&lt;div class=&#x27;calendar-d&quot;</span>+d+<span class="string">&quot;&#x27;&gt;&lt;a&quot;</span>+ds+<span class="string">&quot;&gt;&quot;</span>+count_days+<span class="string">&quot;&lt;/a&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_days &gt;= dates) &#123;</span><br><span class="line">                count_days = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                count_flag = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count_flag) count_days += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> lunar = chineseLunar.<span class="title function_">solarToLunar</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(year, month, date));</span><br><span class="line">    animalYear = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;A&quot;</span>); <span class="comment">//生肖属相</span></span><br><span class="line">    ganzhiYear = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;T&quot;</span>).<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>); <span class="comment">//天干地支</span></span><br><span class="line">    lunarMon = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;M&quot;</span>); <span class="comment">//月份</span></span><br><span class="line">    lunarDay = chineseLunar.<span class="title function_">format</span>(lunar, <span class="string">&quot;d&quot;</span>); <span class="comment">//日期</span></span><br><span class="line">    asideTime = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2023/01/01 00:00:00&quot;</span>);<span class="comment">// 侧边栏倒计时</span></span><br><span class="line">    asideDay = (now - asideTime) / <span class="number">1e3</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>;</span><br><span class="line">    asideDayNum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(asideDay);</span><br><span class="line">    <span class="keyword">var</span> asideWeekNum = ((week - asideDayNum % <span class="number">7</span>) &gt;= <span class="number">0</span>) ? (<span class="title class_">Math</span>.<span class="title function_">ceil</span>(asideDayNum / <span class="number">7</span>)) : (<span class="title class_">Math</span>.<span class="title function_">ceil</span>(asideDayNum / <span class="number">7</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> c_m = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-month&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_w = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-week&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_d = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-date&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_a = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-animal&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> c_l = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;calendar-lunar&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> a_t_l = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;aside-time-left&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (c_m) c_m.<span class="property">innerHTML</span> = monthStr; <span class="comment">//月份</span></span><br><span class="line">    <span class="keyword">if</span> (c_w) c_w.<span class="property">innerHTML</span> = weekStr; <span class="comment">//星期</span></span><br><span class="line">    <span class="keyword">if</span> (c_d) c_d.<span class="property">innerHTML</span> = date.<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>); <span class="comment">//日期</span></span><br><span class="line">    <span class="keyword">if</span> (c_a) c_a.<span class="property">innerHTML</span> = ganzhiYear + animalYear + <span class="string">&quot;年&quot;</span>; <span class="comment">//年份</span></span><br><span class="line">    <span class="keyword">if</span> (c_l) c_l.<span class="property">innerHTML</span> = lunarMon + lunarDay; <span class="comment">//农历</span></span><br><span class="line">    <span class="keyword">if</span> (a_t_l) a_t_l.<span class="property">innerHTML</span> = year + <span class="string">&quot;&amp;nbsp;&amp;nbsp;&lt;a style=&#x27;font-size:1.1rem;font-weight:bold;&#x27;&gt;第&lt;/a&gt;&amp;nbsp;&quot;</span> + asideWeekNum + <span class="string">&quot;&amp;nbsp;&lt;a style=&#x27;font-size:1.1rem;font-weight:bold;&#x27;&gt;周&lt;/a&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="pjax适配"><a href="#pjax适配" class="headerlink" title="pjax适配"></a>pjax适配</h3><p>在<code>whenDOMReady()</code>里加入<code>cardTimes()</code>函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">whenDOMReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// pjax加载完成（切换页面）后需要执行的函数和代码</span></span><br><span class="line">    <span class="title function_">cardTimes</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ***********</span></span><br><span class="line"><span class="comment">// 其他代码放中间</span></span><br><span class="line"><span class="comment">// ***********</span></span><br><span class="line"><span class="title function_">whenDOMReady</span>(); <span class="comment">// 打开网站先执行一次</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;pjax:complete&quot;</span>, whenDOMReady); <span class="comment">// pjax加载完成（切换页面）后再执行一次</span></span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/Butterfly/">Butterfly</category>
      
      
      <comments>https://gavin-chen.top/post/8b6f77a8.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>利用Vercel + OneDrive搭建个人网盘</title>
      <link>https://gavin-chen.top/post/e87ec7ea.html</link>
      <guid>https://gavin-chen.top/post/e87ec7ea.html</guid>
      <pubDate>Sat, 25 Feb 2023 15:39:27 GMT</pubDate>
      
      <description>白嫖E5，免服务器搭建个人网盘，可直链！</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>基于开源项目 <a href="https://github.com/spencerwooo/onedrive-vercel-index">onedrive-vercel-index</a> ，搭建本博客配套的个人网盘——藏兵谷。<br><img src="https://s2.loli.net/2023/02/25/6tjdMl2kRUxO5DW.webp" alt=""></p><h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p>这个问题得从上一个项目——音乐控制器说起。<br>看过站长介绍应该知道我喜欢听周杰伦的歌，你说我好不容易整了这么多音乐播放器，结果还听不了我喜欢的歌，那不白搭么。由于版权问题，无法在线获取VIP曲目，所以一般采用的方法就是把音乐资源存在自己的服务器上，通过直链在线读取。<br>但是我没有服务器，这就得操作操作了。<br>我先是找了一些百度网盘、阿里网盘等转直链的插件，可插件生成的直链用在aplayer上总是无法读取，pass。接着尝试用gitee做仓储仓库，gitee各种限制，每次上传20个文件，文件大小不超过10M，最后还做不了直链，想来应该是早就禁止了。于是换github建存储仓库，这里上传文件没有什么限制，起初尝试了一下jsDeliver加速，aplayer上无法读取，只好部署到vercel，这次aplayer终于可以读取，就是速度方面实在感人，最重要的是文件管理很不方便，但总算是能听周董啦。后来我在github看到了 <a href="https://github.com/spencerwooo/onedrive-vercel-index">onedrive-vercel-index</a> 这个开源项目，觉得优点还蛮多的，就有了做个人网盘的想法。</p><h2 id="有什么用"><a href="#有什么用" class="headerlink" title="有什么用"></a>有什么用</h2><ol><li>图片只能存图片，那么个人网盘则可以存放网站所需的其他类型的文件，无需花钱购买云服务。</li><li>微软<code>E5账号</code>可免费获得<code>Microsoft 365全家桶</code>，以及<code>OneDrive 5T网盘空间</code>，为期90天。</li><li>搭建个人网盘后，微软会自动帮你续期上条优惠，不用单独配置续期脚本，等于白嫖。</li><li>作为网盘功能也不少，支持直链下载，支持多文件打包下载；支持超多文件格式在线预览，支持多种视频格式在线播放。</li></ol><h2 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h2><p>官方手册：<a href="https://ovi.swo.moe/zh/docs/getting-started">https://ovi.swo.moe/zh/docs/getting-started</a><br>关于E5账号：<br><a href="https://zhuanlan.zhihu.com/p/586918075">白嫖微软E5开发者 免费使用Office正版、OneDrive 5T存储空间！</a><br>参考教程：<br><a href="https://blog.qinglin.co/2562.html">利用vercel零成本搭建oneindex网盘</a><br><a href="https://www.iamdt.cn/archives/22/">免费搭建你的OneDrive公共网盘——Vercel特供版</a></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>跟着教程走基本没什么问题，但我用了三天后出现了编号<code>500</code>报错，通过翻阅Discussions，我尝试了删除redis缓存然后重新认证的方法，问题解决。<br>更多问题可在Discussions里找到解决办法。</p><p><strong>目前，参星阁主页和 <a href="https://music.gavin-chen.top">“幻音坊”</a> 皆已添加周董专属歌单，共有经典曲目39首。</strong></p>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/APlayer/">APlayer</category>
      
      <category domain="https://gavin-chen.top/tags/%E7%BD%91%E7%9B%98/">网盘</category>
      
      
      <comments>https://gavin-chen.top/post/e87ec7ea.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>控制中心 - 音乐控制器（Aplayer伴侣）</title>
      <link>https://gavin-chen.top/post/37b27065.html</link>
      <guid>https://gavin-chen.top/post/37b27065.html</guid>
      <pubDate>Sat, 11 Feb 2023 06:09:05 GMT</pubDate>
      
      <description>扒掉苹果的裤子！超好用超美观的音乐控制器！</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="构想"><a href="#构想" class="headerlink" title="构想"></a>构想</h2><ol><li>因为我的QQ是侧边隐藏的，aplayer也是侧边隐藏的，两者时常会误触，虽说各放一边就能避免这个问题，但我还是想把它做的优雅一点，毕竟这个博客就是为了Aplayer做的（认真脸）。</li><li>Aplayer本身的UI做的很不错，但按钮太小，样式太简约，不够个性化。一开始的构想是想做一个可以随处拖动的小圆球，就像iOS的AssistiveTouch小方块一样。后来看到安知鱼大佬做的音乐胶囊，非常接近我的设计预想，虽然是固定的，但也解决了和QQ侧边隐藏冲突的问题，真的是非常好看。但是看完教程后发现它无法显示歌单，而且歌词特别小，所以只能放弃了。</li><li>我开始尝试着修改Aplayer的js源码，先是歌词的样式，修改了滚动速度和歌词大小，非常成功，达到了我预想的效果，就是你们现在看到的“桌面歌词”；然后尝试查找js源码里写好的一些方法，然而我几乎为0的js水平无法让我理解源码的结构，所以尝试失败了。</li><li>终于，我翻到了Aplayer的中文文档，发现了Aplayer其实提供了很多的API接口，还有很多audio的原生属性，顿时感觉之前好傻，一下子思路顺畅了许多——既然魔改Aplayer的原UI那么困难，那么为什么不自己写个界面，然后调用API的方法呢？于是就有了现在这个音乐控制器。<br>说它是音乐控制器，其实很严谨，因为我只是给Aplayer加了个遥控器，而不是新做了一个播放器，所以功能基本上是和aplayer一样的。如果要增加其他功能，则要另写方法了。比如，在线搜索、歌曲收藏等。</li></ol><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>音乐控制器是控制中心下的一个模块，所以通过控制中心按钮打开。目前已实现的功能如下：<br><div class="note info modern no-icon flat"><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>歌曲信息显示：曲名、封面、歌手</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>暂停/播放</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>上一首/下一首</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>循环/随机播放</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>进度条显示/拖动控制</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>音量条显示/拖动控制</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>桌面歌词</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>歌单显示，支持切歌</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>导航栏mini音乐控制模块</p>           </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>           <p>切换其他歌单</p>           </div></div></p><h3 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h3><ol><li><p>主界面<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/cRcDK.webp" alt=""></p></li><li><p>歌单界面<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/cRd8a.webp" alt=""></p></li><li><p>导航栏迷你音乐控制器、桌面歌词</p></li></ol><p><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/cRVkS.webp" alt=""></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>由于其他功能还没做好，建议F12大法直接扒。<br>下面列出代码可能不适用，谨慎参考！</p><h3 id="console-pug"><a href="#console-pug" class="headerlink" title="console.pug"></a>console.pug</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">div#console</span><br><span class="line">    //- 标头</span><br><span class="line">    div.console-head</span><br><span class="line">        span 控制中心</span><br><span class="line">        div.close-btn(onclick=&quot;ctrl.hideConsole()&quot; href=&quot;javascript:void(0);&quot;)</span><br><span class="line">            i.fas.fa-circle-xmark</span><br><span class="line"></span><br><span class="line">    //- 音乐控制器</span><br><span class="line">    div.console-music-ctrl-item.item-show#console-music-item-main</span><br><span class="line">        div#console-music-cover</span><br><span class="line">        a#console-music-title 曲名</span><br><span class="line">        a#console-music-author 作者</span><br><span class="line">        div.console-progressbar-div</span><br><span class="line">            div#progress-low</span><br><span class="line">                a#progress-low-btn --:--</span><br><span class="line">            div#music-progressbar</span><br><span class="line">                div#p_bar_bg</span><br><span class="line">                    div#p_bar</span><br><span class="line">            div#progress-high</span><br><span class="line">                a#progress-high-btn --:--</span><br><span class="line">        div#console-music-ctrl-btns</span><br><span class="line">            div#music-ctrl-first</span><br><span class="line">                a#music-ctrl-btn-first</span><br><span class="line">                    i.fas.fa-shuffle</span><br><span class="line">            div#music-ctrl-left</span><br><span class="line">                a#music-ctrl-btn-left(onclick=&quot;ctrl.musicBackward()&quot; title=&quot;上一曲&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                    i.fas.fa-backward</span><br><span class="line">            div#music-ctrl-center</span><br><span class="line">                a#music-ctrl-btn-center(onclick=&quot;ctrl.musicSwitch()&quot; title=&quot;音乐开关&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                    i.fas.fa-play</span><br><span class="line">            div#music-ctrl-right</span><br><span class="line">                a#music-ctrl-btn-right(onclick=&quot;ctrl.musicForward()&quot; title=&quot;下一曲&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                    i.fas.fa-forward</span><br><span class="line">            div#music-ctrl-end</span><br><span class="line">                a#music-ctrl-btn-end</span><br><span class="line">                    i.fas.fa-indent</span><br><span class="line">        div.console-progressbar-div</span><br><span class="line">            div#volume-low</span><br><span class="line">                a#volume-low-btn</span><br><span class="line">                    i.fas.fa-volume-off</span><br><span class="line">            div#music-volumebar</span><br><span class="line">                div#v_bar_bg</span><br><span class="line">                    div#v_bar</span><br><span class="line">            div#volume-high</span><br><span class="line">                a#volume-high-btn</span><br><span class="line">                    i.fas.fa-volume-high</span><br><span class="line"></span><br><span class="line">    div.console-music-ctrl-item#console-music-item-list</span><br><span class="line">        div.console-list-head</span><br><span class="line">            a.headline 当前歌单</span><br><span class="line">            a.music-list-title 网易云</span><br><span class="line">        div.console-list-body</span><br><span class="line">            ol#console-music-list</span><br><span class="line">        div.console-list-foot</span><br><span class="line"></span><br><span class="line">    //- 系统控制按钮</span><br><span class="line">    div.console-btn-group</span><br><span class="line">        div.console-btn-item#darkItem</span><br><span class="line">            a.switchButton#darkSwitchBtn(onclick=&quot;ctrl.switchDarkMode()&quot; title=&quot;深色模式&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                i#iconDarkMode.fas.fa-moon</span><br><span class="line">        div.console-btn-item#charItem</span><br><span class="line">            a.switchButton#charSwitchBtn(type=&quot;button&quot; title=&quot;簡/繁&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                i#iconCharMode.fas(style=&quot;font-size:1.5rem;&quot;) 繁</span><br><span class="line">        div.console-btn-item#ircItem</span><br><span class="line">            a.switchButton#ircSwitchBtn(onclick=&quot;ctrl.ircShowHide()&quot; title=&quot;桌面歌词&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                i#iconIrcMode.fas(style=&quot;font-size:1.5rem;&quot;) 词</span><br><span class="line">        div.console-btn-item#asideItem</span><br><span class="line">            a.switchButton#asideSwitchBtn(onclick=&quot;ctrl.hideAsideBtn()&quot; title=&quot;单栏/双栏&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot; data-pjax-state=&quot;external&quot;)</span><br><span class="line">                i#iconAside.fas.fa-arrows-alt-h</span><br><span class="line"></span><br><span class="line">    div.console-mask(onclick=&quot;ctrl.consoleBackBtn()&quot; href=&quot;javascript:void(0);&quot; rel=&quot;external nofollow&quot;)</span><br></pre></td></tr></table></figure><h3 id="自定义CSS"><a href="#自定义CSS" class="headerlink" title="自定义CSS"></a>自定义CSS</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* *********************控制中心音乐********************* */</span></span><br><span class="line"><span class="comment">/* 隐藏原来的Aplayer */</span></span><br><span class="line"><span class="selector-class">.aplayer-body</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console</span> <span class="selector-class">.console-music-ctrl-item</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">1rem</span> auto <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">18rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="built_in">var</span>(--style-border);</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--card-bg);</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">3.5rem</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-item-main</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1.3rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-item-main</span><span class="selector-class">.item-show</span>, </span><br><span class="line"><span class="selector-id">#console-music-item-list</span><span class="selector-class">.item-show</span>, </span><br><span class="line"><span class="selector-id">#console-music-item-lrc</span><span class="selector-class">.item-show</span>, </span><br><span class="line"><span class="selector-id">#console-songsheet-item-list</span><span class="selector-class">.item-show</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">pointer-events</span>: all;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 封面 */</span></span><br><span class="line"><span class="selector-id">#console-music-cover</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">/* height: calc(100% - 12rem); */</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 曲名和作者 */</span></span><br><span class="line"><span class="selector-id">#console-music-title</span>,</span><br><span class="line"><span class="selector-id">#console-music-author</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-title</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2.4rem</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--anzhiyu-reverse);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-author</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1.6rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 组件外框 */</span></span><br><span class="line"><span class="selector-class">.console-progressbar-div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-ctrl-btns</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-ctrl-first</span>, <span class="selector-id">#music-ctrl-left</span>, <span class="selector-id">#music-ctrl-center</span>, <span class="selector-id">#music-ctrl-right</span>, <span class="selector-id">#music-ctrl-end</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-ctrl-btn-first</span>, <span class="selector-id">#music-ctrl-btn-left</span>, <span class="selector-id">#music-ctrl-btn-center</span>, <span class="selector-id">#music-ctrl-btn-right</span>,<span class="selector-id">#music-ctrl-btn-end</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 字色和字号 */</span></span><br><span class="line"><span class="selector-id">#music-ctrl-btn-first</span>, <span class="selector-id">#music-ctrl-btn-left</span>, <span class="selector-id">#music-ctrl-btn-right</span>, <span class="selector-id">#music-ctrl-btn-end</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.console-music-ctrl-item</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color); <span class="comment">/*#99a9bf*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-ctrl-btn-center</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--anzhiyu-reverse);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2.4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-ctrl-btn-first</span><span class="selector-pseudo">:hover</span>, <span class="selector-id">#music-ctrl-btn-left</span><span class="selector-pseudo">:hover</span>, <span class="selector-id">#music-ctrl-btn-right</span><span class="selector-pseudo">:hover</span>, <span class="selector-id">#music-ctrl-btn-end</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--anzhiyu-reverse);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#progress-low-btn</span>, <span class="selector-id">#progress-high-btn</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.7rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">136</span>,<span class="number">136</span>,<span class="number">136</span>,<span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 进度条和音量条 */</span></span><br><span class="line"><span class="selector-id">#progress-low</span>, <span class="selector-id">#progress-high</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-progressbar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#volume-low</span>, <span class="selector-id">#volume-high</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#music-volumebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#progress-low</span>, <span class="selector-id">#progress-high</span>, <span class="selector-id">#music-progressbar</span>, </span><br><span class="line"><span class="selector-id">#volume-low</span>, <span class="selector-id">#volume-high</span>, <span class="selector-id">#music-volumebar</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#p_bar_bg</span>, <span class="selector-id">#v_bar_bg</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">1rem</span>);</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0.4rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0.3rem</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">136</span>, <span class="number">136</span>, <span class="number">136</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#p_bar</span>, <span class="selector-id">#v_bar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0.3rem</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">  <span class="attribute">transition</span>: background-color <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 控制中心文本不可选中 */</span></span><br><span class="line"><span class="selector-id">#console</span> <span class="selector-tag">a</span>, <span class="selector-id">#console</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* *********************歌单显示********************** */</span></span><br><span class="line"><span class="selector-class">.console-list-head</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">1.8rem</span>; <span class="comment">/*和外弧度保持一致*/</span></span><br><span class="line">  <span class="attribute">border-top-right-radius</span>: <span class="number">1.8rem</span>; <span class="comment">/*和外弧度保持一致*/</span></span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--vercel-border-color);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--vercel-background);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">flex-flow</span>: column;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.console-list-foot</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1.8rem</span>; <span class="comment">/*和外弧度保持一致*/</span></span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">1.8rem</span>; <span class="comment">/*和外弧度保持一致*/</span></span><br><span class="line">  <span class="attribute">border-bottom-right-radius</span>: <span class="number">1.8rem</span>; <span class="comment">/*和外弧度保持一致*/</span></span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--vercel-border-color);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--vercel-background);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.console-list-body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">5.8rem</span>);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-list</span>, <span class="selector-id">#console-songsheet-list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">list-style</span>: none; <span class="comment">/*消除序号*/</span></span><br><span class="line">  <span class="attribute">padding-inline-start</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-list</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--vercel-hover-bg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 隐藏滚动条 */</span></span><br><span class="line"><span class="selector-id">#console-music-list</span>::-webkit-scrollbar &#123;<span class="attribute">display</span>:none&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-music-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child) <span class="selector-tag">div</span><span class="selector-class">.list-music-info2</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--vercel-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.list-music-info1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.list-music-info2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">2.5rem</span>);</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.list-music-author</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">136</span>,<span class="number">136</span>,<span class="number">136</span>);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.8rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.list-music-id</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.8rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">136</span>,<span class="number">136</span>,<span class="number">136</span>);</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.list-music-id</span><span class="selector-class">.hide</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.list-music-state</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.list-music-state</span><span class="selector-class">.show</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.console-list-head</span> <span class="selector-tag">a</span><span class="selector-class">.headline</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-id">#music-list-title</span>, <span class="selector-tag">a</span><span class="selector-id">#songsheet-title</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-id">#music-list-title</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* *********************歌单列表*********************** */</span></span><br><span class="line"><span class="selector-id">#console-songsheet-list</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-songsheet-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">3rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 取消滚动条 */</span></span><br><span class="line"><span class="selector-id">#console-songsheet-list</span>::-webkit-scrollbar &#123;<span class="attribute">display</span>:none&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-songsheet-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--vercel-hover-bg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-songsheet-list</span> <span class="selector-tag">li</span> <span class="selector-tag">div</span><span class="selector-class">.songsheet-info2</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--vercel-border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.songsheet-info1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.songsheet-info2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">2.5rem</span>);</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1rem</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.list-songsheet-cover</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.list-songsheet-title</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">1.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* *************加载转圈************* */</span></span><br><span class="line"><span class="selector-id">#console-loading-icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-loading-icon</span><span class="selector-class">.show</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#console-loading-icon</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="自定义JS"><a href="#自定义JS" class="headerlink" title="自定义JS"></a>自定义JS</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pjax适配</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">whenDOMReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// pjax加载完成（切换页面）后需要执行的函数和代码</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pjax开启&quot;</span>);</span><br><span class="line">    <span class="title function_">musicState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 音乐状态检测（已添加事件监听器，修复点击aplayer后导航栏和控制中心不同步的问题）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">musicState</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> music_state = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">paused</span>;</span><br><span class="line">    <span class="keyword">if</span> (music_state) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console #music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console #music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console #music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console #music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">secToTime</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(s)) s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> min = <span class="title class_">Math</span>.<span class="title function_">floor</span>(s / <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">var</span> sec = <span class="title class_">Math</span>.<span class="title function_">floor</span>(s % <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">var</span> t = min.<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="string">&quot;:&quot;</span> + sec.<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctrl = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示中控台</span></span><br><span class="line">    <span class="attr">showConsole</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console-music-item-main&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">        ctrl.<span class="title function_">initConsoleState</span>();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 隐藏中控台</span></span><br><span class="line">    <span class="attr">hideConsole</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> items = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.item-show&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;items.<span class="property">length</span>; i++) items[i].<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 菜单返回</span></span><br><span class="line">    <span class="attr">consoleBackBtn</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> top_item = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.item-show&quot;</span>);</span><br><span class="line">        <span class="keyword">switch</span> (top_item.<span class="property">id</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;console-music-item-mini&#x27;</span>: <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;console-music-item-main&#x27;</span>: ctrl.<span class="title function_">hideConsole</span>(); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;console-music-item-list&#x27;</span>:</span><br><span class="line">                top_item.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-main&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;console-songsheet-item-list&#x27;</span>:</span><br><span class="line">                top_item.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-list&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;console-music-item-lrc&#x27;</span>:</span><br><span class="line">                top_item.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-main&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>: <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;异常情况&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 桌面歌词</span></span><br><span class="line">    <span class="attr">ircShowHide</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> irc = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer &gt; .aplayer-lrc-hide&quot;</span>); <span class="comment">//这里防止与音乐页面的控制冲突</span></span><br><span class="line">        <span class="keyword">if</span> (irc === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer &gt; .aplayer-lrc&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;aplayer-lrc-hide&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#ircItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;on&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer &gt; .aplayer-lrc&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;aplayer-lrc-hide&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#ircItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;on&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 导航栏音乐</span></span><br><span class="line">    <span class="attr">musicSwitch</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> music_state = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">paused</span>;</span><br><span class="line">        <span class="keyword">if</span> (music_state) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">toggle</span>();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">musicForward</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">skipForward</span>();</span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">musicBackward</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">skipBack</span>();</span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">getMusicInfo</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> music_id = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">list</span>.<span class="property">index</span>; <span class="comment">//当前曲目的id</span></span><br><span class="line">        <span class="keyword">var</span> music_cover = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">list</span>.<span class="property">audios</span>[music_id].<span class="property">cover</span>;</span><br><span class="line">        <span class="keyword">var</span> music_author = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">list</span>.<span class="property">audios</span>[music_id].<span class="property">author</span>;</span><br><span class="line">        <span class="keyword">var</span> music_title = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">list</span>.<span class="property">audios</span>[music_id].<span class="property">title</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-cover&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;&lt;img src=&#x27;&quot;</span> + music_cover + <span class="string">&quot;&#x27; style=&#x27;width:100%;height:100%;border-radius:0.5rem;&#x27;&gt;&quot;</span>;<span class="comment">// 歌曲信息</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-title&quot;</span>).<span class="property">innerHTML</span> = music_title;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-author&quot;</span>).<span class="property">innerHTML</span> = music_author;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 音乐进度更新</span></span><br><span class="line">    <span class="attr">refreshProgress</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> nowTime = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">currentTime</span>;<span class="comment">// 当前时间</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isNaN</span>(nowTime)) nowTime = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> nowTimeString = <span class="title function_">secToTime</span>(nowTime);</span><br><span class="line">        <span class="keyword">var</span> allTime = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">duration</span>;<span class="comment">// 总时间</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isNaN</span>(allTime)) allTime = <span class="number">0</span>; <span class="comment">//无歌曲时会返回NaN</span></span><br><span class="line">        <span class="keyword">var</span> allTimeString = <span class="title function_">secToTime</span>(allTime);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-low-btn&quot;</span>).<span class="property">innerHTML</span> = nowTimeString;<span class="comment">// 进度条时间</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-high-btn&quot;</span>).<span class="property">innerHTML</span> = allTimeString;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#p_bar&quot;</span>).<span class="property">style</span>.<span class="property">width</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#p_bar_bg&quot;</span>).<span class="property">offsetWidth</span> * (nowTime / allTime) + <span class="string">&quot;px&quot;</span>;<span class="comment">// 进度条进度</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 导入歌单</span></span><br><span class="line">    <span class="attr">importMusicList</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> audios = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">list</span>.<span class="property">audios</span>;</span><br><span class="line">        <span class="keyword">var</span> list_html;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; audios.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            list_html = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-list&quot;</span>).<span class="property">innerHTML</span>;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-list&quot;</span>).<span class="property">innerHTML</span> = list_html + <span class="string">&quot;&lt;li class=&#x27;music-list-item&#x27;&gt;&lt;div class=&#x27;list-music-info1&#x27;&gt;&lt;a class=&#x27;list-music-id&#x27; data-pjax-state=&#x27;&#x27;&gt;&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;&lt;/a&gt;&lt;a class=&#x27;list-music-state&#x27; data-pjax-state=&#x27;&#x27;&gt;&lt;i class=&#x27;iconfont icon-waveform&#x27;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class=&#x27;list-music-info2&#x27;&gt;&lt;a class=&#x27;list-music-title&#x27; data-pjax-state=&#x27;&#x27;&gt;&quot;</span> + audios[i].<span class="property">title</span> + <span class="string">&quot;&lt;/a&gt;&lt;a class=&#x27;list-music-author&#x27; data-pjax-state=&#x27;&#x27;&gt; - &quot;</span> + audios[i].<span class="property">author</span> + <span class="string">&quot;&lt;/a&gt;&lt;/div&gt;&lt;/li&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">// console.log(&quot;第&quot; + (i + 1) + &quot;首导入成功！&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 歌单切换</span></span><br><span class="line">    <span class="attr">changeMusicList</span>: <span class="keyword">function</span>(<span class="params">Music_id, Music_server</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ap = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>;</span><br><span class="line">        <span class="keyword">var</span> music_list_url_str = <span class="string">&quot;https://metingjs.gavin-chen.top/api?server=&quot;</span> + <span class="title class_">Music</span>_server + <span class="string">&quot;&amp;type=playlist&quot;</span> + <span class="string">&quot;&amp;id=&quot;</span> + <span class="title class_">Music</span>_id;</span><br><span class="line">        ap.<span class="property">list</span>.<span class="title function_">clear</span>();</span><br><span class="line">        <span class="title function_">fetch</span>(music_list_url_str).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 在这里使用返回的JSON数据</span></span><br><span class="line">            newSongsheetLen = data.<span class="property">length</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newSongsheetLen);</span><br><span class="line">            ap.<span class="property">list</span>.<span class="title function_">add</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化console图标</span></span><br><span class="line">    <span class="attr">initConsoleState</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> irc = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer &gt; .aplayer-lrc-hide&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> aplayer = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer &gt; .aplayer-lrc&quot;</span>);</span><br><span class="line">        irc === <span class="literal">null</span> &amp;&amp; aplayer != <span class="literal">null</span></span><br><span class="line">            ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#ircItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;on&quot;</span>)</span><br><span class="line">            : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#ircItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;on&quot;</span>);</span><br><span class="line">        saveToLocal.<span class="title function_">get</span>(<span class="string">&#x27;aside-status&#x27;</span>) === <span class="string">&#x27;hide&#x27;</span></span><br><span class="line">            ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#asideItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;on&quot;</span>)</span><br><span class="line">            : <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#asideItem&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;on&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> console_musicBody = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#console .console-music-ctrl-item&quot;</span>); <span class="comment">// 更新控制中心尺寸</span></span><br><span class="line">        <span class="keyword">var</span> console_musicCover = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-cover&quot;</span>);</span><br><span class="line">        console_musicCover.<span class="property">style</span>.<span class="property">height</span> = console_musicCover.<span class="property">offsetWidth</span> + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">        console_musicBody.<span class="property">style</span>.<span class="property">height</span> = (console_musicCover.<span class="property">offsetWidth</span> + <span class="number">236</span>) + <span class="string">&quot;px&quot;</span>; <span class="comment">//(12rem + 1.3rem + 1.3rem) * 16 = 233.6px</span></span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">        <span class="keyword">var</span> nowVolume = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">volume</span>;<span class="comment">// 当前音量</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#v_bar&quot;</span>).<span class="property">style</span>.<span class="property">width</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#v_bar_bg&quot;</span>).<span class="property">offsetWidth</span> * nowVolume + <span class="string">&quot;px&quot;</span>;<span class="comment">// 音量条进度</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主页/音乐列表/歌单列表 切换</span></span><br><span class="line"><span class="keyword">var</span> music_list_switch = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-ctrl-btn-end&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> music_list_title = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-list-title&quot;</span>);</span><br><span class="line">music_list_switch.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-main&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-list&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">music_list_title.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-item-list&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-songsheet-item-list&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;item-show&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 歌单列表监听器</span></span><br><span class="line"><span class="keyword">var</span> songsheet0 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;songsheet-X&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> songsheet1 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;songsheet-A&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> songsheet2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;songsheet-B&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> songsheet3 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;songsheet-C&quot;</span>);</span><br><span class="line">songsheet0.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-loading-icon&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在切换至默认专辑&quot;</span>);</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    ctrl.<span class="title function_">changeMusicList</span>(<span class="string">&quot;8086610771&quot;</span>,<span class="string">&quot;netease&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-list-title&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;网易云&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">songsheet1.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-loading-icon&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在切换至纯音乐专辑&quot;</span>);</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    ctrl.<span class="title function_">changeMusicList</span>(<span class="string">&quot;651630118&quot;</span>,<span class="string">&quot;netease&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-list-title&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;纯音乐&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">songsheet2.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-loading-icon&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在切换至古风专辑&quot;</span>);</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    ctrl.<span class="title function_">changeMusicList</span>(<span class="string">&quot;5296755943&quot;</span>,<span class="string">&quot;netease&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-list-title&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;古风&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">songsheet3.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-loading-icon&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在切换至镜子Vlog专辑&quot;</span>);</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    ctrl.<span class="title function_">changeMusicList</span>(<span class="string">&quot;4932756913&quot;</span>,<span class="string">&quot;netease&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-list-title&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;镜子Vlog&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 音乐列表监听器</span></span><br><span class="line"><span class="keyword">var</span> console_music_list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-list&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> music_id = <span class="literal">null</span>;</span><br><span class="line">console_music_list.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ap = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span></span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">target</span> &amp;&amp; e.<span class="property">target</span>.<span class="property">nodeName</span>.<span class="title function_">toUpperCase</span>() == <span class="string">&quot;LI&quot;</span>) &#123;</span><br><span class="line">        music_id = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.list-music-id&quot;</span>).<span class="property">innerHTML</span>);</span><br><span class="line">        ap.<span class="property">list</span>.<span class="title function_">switch</span>(music_id - <span class="number">1</span>);</span><br><span class="line">        ap.<span class="title function_">play</span>();</span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">target</span> &amp;&amp; e.<span class="property">target</span>.<span class="property">nodeName</span>.<span class="title function_">toUpperCase</span>() == <span class="string">&quot;DIV&quot;</span>) &#123;</span><br><span class="line">        music_id = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="property">parentElement</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.list-music-id&quot;</span>).<span class="property">innerHTML</span>);</span><br><span class="line">        ap.<span class="property">list</span>.<span class="title function_">switch</span>(music_id - <span class="number">1</span>);</span><br><span class="line">        ap.<span class="title function_">play</span>();</span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">target</span> &amp;&amp; (e.<span class="property">target</span>.<span class="property">nodeName</span>.<span class="title function_">toUpperCase</span>() == <span class="string">&quot;A&quot;</span> || e.<span class="property">target</span>.<span class="property">nodeName</span>.<span class="title function_">toUpperCase</span>() == <span class="string">&quot;I&quot;</span>)) &#123;</span><br><span class="line">        music_id = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="property">parentElement</span>.<span class="property">parentElement</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.list-music-id&quot;</span>).<span class="property">innerHTML</span>);</span><br><span class="line">        ap.<span class="property">list</span>.<span class="title function_">switch</span>(music_id - <span class="number">1</span>);</span><br><span class="line">        ap.<span class="title function_">play</span>();</span><br><span class="line">        ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="title function_">alert</span>(<span class="string">&quot;ERROR!&quot;</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 音量条监听器</span></span><br><span class="line"><span class="keyword">var</span> music_volumebar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-volumebar&quot;</span>); <span class="comment">//扩大热区</span></span><br><span class="line"><span class="keyword">var</span> v_bar_bg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;v_bar_bg&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> v_bar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;v_bar&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> v_low = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;volume-low-btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> v_high = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;volume-high-btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> v_bar_bg_Len = v_bar_bg.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条总长Width</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按键按下</span></span><br><span class="line">music_volumebar.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousedown&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">//添加监听事件</span></span><br><span class="line">    v_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.6rem&quot;</span>;</span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    v_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    v_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> x = e.<span class="property">pageX</span>; <span class="comment">// 获取按下时鼠标初始位置 // pageX是绝对位置 offsetX是相对位置</span></span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">width</span> = (<span class="number">0</span> + e.<span class="property">offsetX</span>) + <span class="string">&quot;px&quot;</span>; <span class="comment">// 按下时重新设置进度条</span></span><br><span class="line">    <span class="keyword">let</span> v_bar_Len = v_bar.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条的初始Width</span></span><br><span class="line">    v_bar_bg_Len = v_bar_bg.<span class="property">offsetWidth</span>;</span><br><span class="line">    <span class="keyword">let</span> newVolume = e.<span class="property">offsetX</span> / v_bar_bg_Len;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">volume</span>(newVolume, <span class="literal">true</span>); <span class="comment">// 更改音量</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">// 拖动需要写到down里面</span></span><br><span class="line">        <span class="keyword">let</span> diff = x - e.<span class="property">pageX</span>; <span class="comment">// 获取移动的距离</span></span><br><span class="line">        <span class="keyword">let</span> v_bar_Len_New = v_bar_Len - diff; <span class="comment">// 计算当前进度条的Width</span></span><br><span class="line">        <span class="keyword">if</span> (v_bar_Len_New &lt; <span class="number">0</span>) &#123; <span class="comment">// 当超出进度条范围，控制</span></span><br><span class="line">            v_bar_Len_New = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v_bar_Len_New &gt; v_bar_bg_Len) &#123;</span><br><span class="line">            v_bar_Len_New = v_bar_bg_Len;</span><br><span class="line">        &#125;</span><br><span class="line">        v_bar.<span class="property">style</span>.<span class="property">width</span> = v_bar_Len_New + <span class="string">&quot;px&quot;</span>; <span class="comment">// 更改进度条Width</span></span><br><span class="line">        newVolume = v_bar_Len_New / v_bar_bg_Len;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">volume</span>(newVolume, <span class="literal">true</span>); <span class="comment">// 更改音量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触摸按下</span></span><br><span class="line">music_volumebar.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">//添加监听事件</span></span><br><span class="line">    v_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.6rem&quot;</span>;</span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    v_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    v_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> x = e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>; <span class="comment">// 获取按下时鼠标初始位置 // pageX是绝对位置 offsetX是相对位置</span></span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">width</span> = (<span class="number">0</span> + e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">offsetX</span>) + <span class="string">&quot;px&quot;</span>; <span class="comment">// 按下时重新设置进度条</span></span><br><span class="line">    <span class="keyword">let</span> v_bar_Len = v_bar.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条的初始Width</span></span><br><span class="line">    v_bar_bg_Len = v_bar_bg.<span class="property">offsetWidth</span>;</span><br><span class="line">    <span class="keyword">let</span> newVolume = e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">offsetX</span> / v_bar_bg_Len;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">volume</span>(newVolume, <span class="literal">true</span>); <span class="comment">// 更改音量</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">ontouchmove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">// 拖动需要写到down里面</span></span><br><span class="line">        <span class="keyword">let</span> diff = x - e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>; <span class="comment">// 获取移动的距离</span></span><br><span class="line">        <span class="keyword">let</span> v_bar_Len_New = v_bar_Len - diff; <span class="comment">// 计算当前进度条的Width</span></span><br><span class="line">        <span class="keyword">if</span> (v_bar_Len_New &lt; <span class="number">0</span>) &#123; <span class="comment">// 当超出进度条范围，控制</span></span><br><span class="line">            v_bar_Len_New = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v_bar_Len_New &gt; v_bar_bg_Len) &#123;</span><br><span class="line">            v_bar_Len_New = v_bar_bg_Len;</span><br><span class="line">        &#125;</span><br><span class="line">        v_bar.<span class="property">style</span>.<span class="property">width</span> = v_bar_Len_New + <span class="string">&quot;px&quot;</span>; <span class="comment">// 更改进度条Width</span></span><br><span class="line">        newVolume = v_bar_Len_New / v_bar_bg_Len;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">volume</span>(newVolume, <span class="literal">true</span>); <span class="comment">// 更改音量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 进度条监听器</span></span><br><span class="line"><span class="keyword">var</span> music_progressbar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-progressbar&quot;</span>); <span class="comment">//扩大热区</span></span><br><span class="line"><span class="keyword">var</span> p_bar_bg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p_bar_bg&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p_bar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p_bar&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p_low = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-low-btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p_high = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-high-btn&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p_bar_Len_New = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> p_bar_bg_Len = p_bar_bg.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条总长Width</span></span><br><span class="line"><span class="keyword">var</span> ctrl_flag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> mousemove_flag = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按键按下</span></span><br><span class="line">music_progressbar.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousedown&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">//添加监听事件</span></span><br><span class="line">    p_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.6rem&quot;</span>;</span><br><span class="line">    p_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    p_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    p_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    ctrl_flag = <span class="number">0</span>;</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> x = e.<span class="property">pageX</span>; <span class="comment">// 获取按下时鼠标初始位置 // pageX是绝对位置 offsetX是相对位置</span></span><br><span class="line">    <span class="keyword">let</span> p_bar_Len = p_bar.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条的初始Width</span></span><br><span class="line">    p_bar_bg_Len = p_bar_bg.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条总长Width，不知道为什么，第一次获取的值不对，这里还得再更新一次</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">// 拖动需要写到down里面</span></span><br><span class="line">        <span class="keyword">let</span> diff = x - e.<span class="property">pageX</span>; <span class="comment">// 获取移动的距离</span></span><br><span class="line">        mousemove_flag = <span class="number">0</span>;</span><br><span class="line">        p_bar_Len_New = p_bar_Len - diff; <span class="comment">// 计算当前进度条的Width</span></span><br><span class="line">        <span class="keyword">if</span> (p_bar_Len_New &lt; <span class="number">0</span>) &#123; <span class="comment">// 当超出进度条范围，控制</span></span><br><span class="line">            p_bar_Len_New = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p_bar_Len_New &gt; p_bar_bg_Len) &#123;</span><br><span class="line">            p_bar_Len_New = p_bar_bg_Len;</span><br><span class="line">        &#125;</span><br><span class="line">        p_bar.<span class="property">style</span>.<span class="property">width</span> = p_bar_Len_New + <span class="string">&quot;px&quot;</span>; <span class="comment">// 更改进度条Width</span></span><br><span class="line">        <span class="keyword">let</span> all_Time = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">duration</span>;</span><br><span class="line">        <span class="keyword">let</span> current_time = (p_bar_Len_New / p_bar_bg_Len) * all_Time;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-low-btn&quot;</span>).<span class="property">innerHTML</span> = <span class="title function_">secToTime</span>(current_time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触摸按下</span></span><br><span class="line">music_progressbar.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">//添加监听事件</span></span><br><span class="line">    p_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.6rem&quot;</span>;</span><br><span class="line">    p_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    p_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    p_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--anzhiyu-reverse)&quot;</span>;</span><br><span class="line">    ctrl_flag = <span class="number">0</span>;</span><br><span class="line">    global_music_flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> x = e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>; <span class="comment">// 获取按下时鼠标初始位置 // pageX是绝对位置 offsetX是相对位置</span></span><br><span class="line">    <span class="keyword">let</span> p_bar_Len = p_bar.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条的初始Width</span></span><br><span class="line">    p_bar_bg_Len = p_bar_bg.<span class="property">offsetWidth</span>; <span class="comment">// 获取进度条总长Width，不知道为什么，第一次获取的值不对，这里还得再更新一次</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">ontouchmove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="comment">// 拖动需要写到down里面</span></span><br><span class="line">        <span class="keyword">let</span> diff = x - e.<span class="property">targetTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>; <span class="comment">// 获取移动的距离</span></span><br><span class="line">        mousemove_flag = <span class="number">0</span>;</span><br><span class="line">        p_bar_Len_New = p_bar_Len - diff; <span class="comment">// 计算当前进度条的Width</span></span><br><span class="line">        <span class="keyword">if</span> (p_bar_Len_New &lt; <span class="number">0</span>) &#123; <span class="comment">// 当超出进度条范围，控制</span></span><br><span class="line">            p_bar_Len_New = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p_bar_Len_New &gt; p_bar_bg_Len) &#123;</span><br><span class="line">            p_bar_Len_New = p_bar_bg_Len;</span><br><span class="line">        &#125;</span><br><span class="line">        p_bar.<span class="property">style</span>.<span class="property">width</span> = p_bar_Len_New + <span class="string">&quot;px&quot;</span>; <span class="comment">// 更改进度条Width</span></span><br><span class="line">        <span class="keyword">let</span> all_Time = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">duration</span>;</span><br><span class="line">        <span class="keyword">let</span> current_time = (p_bar_Len_New / p_bar_bg_Len) * all_Time;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;progress-low-btn&quot;</span>).<span class="property">innerHTML</span> = <span class="title function_">secToTime</span>(current_time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按键抬起</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">//当鼠标弹起的时候，不做任何操作</span></span><br><span class="line">    v_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.4rem&quot;</span>;</span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    v_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    v_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.4rem&quot;</span>;</span><br><span class="line">    p_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (ctrl_flag == <span class="number">0</span> &amp;&amp; mousemove_flag == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> all_Time = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">duration</span>;</span><br><span class="line">        <span class="keyword">let</span> new_Time = (p_bar_Len_New / p_bar_bg_Len) * all_Time;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">seek</span>(new_Time); <span class="comment">//更改进度</span></span><br><span class="line">    &#125;</span><br><span class="line">    global_music_flag = <span class="number">0</span>;</span><br><span class="line">    ctrl_flag = <span class="number">1</span>;</span><br><span class="line">    mousemove_flag = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触摸抬起</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">ontouchend</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    v_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.4rem&quot;</span>;</span><br><span class="line">    v_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    v_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    v_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_bar_bg.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;0.4rem&quot;</span>;</span><br><span class="line">    p_bar.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_low.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    p_high.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&quot;var(--font-color)&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (ctrl_flag == <span class="number">0</span> &amp;&amp; mousemove_flag == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> all_Time = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="property">audio</span>.<span class="property">duration</span>;</span><br><span class="line">        <span class="keyword">let</span> new_Time = (p_bar_Len_New / p_bar_bg_Len) * all_Time;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>.<span class="title function_">seek</span>(new_Time); <span class="comment">//更改进度</span></span><br><span class="line">    &#125;</span><br><span class="line">    global_music_flag = <span class="number">0</span>;</span><br><span class="line">    ctrl_flag = <span class="number">1</span>;</span><br><span class="line">    mousemove_flag = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">ontouchmove</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// runtime</span></span><br><span class="line"><span class="keyword">var</span> global_music_flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> meting_load = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> listener = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> old_music_id = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> now_music_id = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> newSongsheetLen = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> t_load;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置重复执行函数，周期100ms</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span> != <span class="literal">undefined</span>) meting_load = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (meting_load == <span class="number">0</span> &amp;&amp; listener == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 监测aplayer加载完开始注入音乐列表</span></span><br><span class="line">        ctrl.importMusicList();</span><br><span class="line">        <span class="comment">// 音乐开始与暂停监听</span></span><br><span class="line">        <span class="keyword">var</span> ap = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;meting-js&quot;</span>).<span class="property">aplayer</span>;</span><br><span class="line">        ap.<span class="title function_">on</span>(<span class="string">&#x27;play&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            ctrl.<span class="title function_">getMusicInfo</span>();</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);<span class="comment">// 更新播放/暂停键</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            old_music_id = now_music_id;<span class="comment">// 更新列表标志</span></span><br><span class="line">            now_music_id = ap.<span class="property">list</span>.<span class="property">index</span>;</span><br><span class="line">            <span class="keyword">var</span> ids = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;#console-music-list .list-music-id&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> states = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;#console-music-list .list-music-state&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ids.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">parseInt</span>(ids[i].<span class="property">innerHTML</span>) == now_music_id + <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (old_music_id != <span class="literal">null</span>) &#123;</span><br><span class="line">                        ids[old_music_id].<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">                        states[old_music_id].<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">                        ids[old_music_id].<span class="property">parentElement</span>.<span class="property">parentElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    ids[now_music_id].<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">                    states[now_music_id].<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">                    ids[now_music_id].<span class="property">parentElement</span>.<span class="property">parentElement</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;var(--vercel-hover-bg)&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ap.<span class="title function_">on</span>(<span class="string">&#x27;pause&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-Switch i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-pause&quot;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#music-ctrl-btn-center i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-play&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 播放模式按钮监听（循环 / 随机）</span></span><br><span class="line">        <span class="keyword">var</span> play_mode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;music-ctrl-btn-first&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> ap_play_mode = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer-icon.aplayer-icon-order&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> loop_str = <span class="string">&#x27;&lt;path d=&quot;M0.622 18.334h19.54v7.55l11.052-9.412-11.052-9.413v7.549h-19.54v3.725z&quot;&gt;&lt;/path&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> random_str = <span class="string">&#x27;&lt;path d=&quot;M22.667 4l7 6-7 6 7 6-7 6v-4h-3.653l-3.76-3.76 2.827-2.827 2.587 2.587h2v-8h-2l-12 12h-6v-4h4.347l12-12h3.653v-4zM2.667 8h6l3.76 3.76-2.827 2.827-2.587-2.587h-4.347v-4z&quot;&gt;&lt;/path&gt;&#x27;</span>;</span><br><span class="line">        play_mode.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> ap_play_mode_str = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.aplayer-icon.aplayer-icon-order svg path&quot;</span>).<span class="property">outerHTML</span>;</span><br><span class="line">            <span class="keyword">if</span> (ap_play_mode_str == loop_str) &#123;</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-repeat&quot;</span>);</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-shuffle&quot;</span>);</span><br><span class="line">                ap_play_mode.<span class="title function_">click</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ap_play_mode_str == random_str) &#123;</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-shuffle&quot;</span>);</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-repeat&quot;</span>);</span><br><span class="line">                ap_play_mode.<span class="title function_">click</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="title function_">alert</span>(<span class="string">&quot;程序错误，请刷新！&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        ap_play_mode.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> ap_play_mode_str = ap_play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;svg path&quot;</span>).<span class="property">outerHTML</span>;</span><br><span class="line">            <span class="keyword">if</span> (ap_play_mode_str == loop_str) &#123;</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-shuffle&quot;</span>);</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-repeat&quot;</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;进入顺序播放模式&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ap_play_mode_str == random_str) &#123;</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;fa-repeat&quot;</span>);</span><br><span class="line">                play_mode.<span class="title function_">querySelector</span>(<span class="string">&quot;i&quot;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;fa-shuffle&quot;</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;进入随机播放模式&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="title function_">alert</span>(<span class="string">&quot;程序错误，请刷新！&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 歌单切换监听</span></span><br><span class="line">        ap.<span class="title function_">on</span>(<span class="string">&quot;listclear&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-music-list&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        ap.<span class="title function_">on</span>(<span class="string">&quot;listadd&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> current_len = ap.<span class="property">list</span>.<span class="property">audios</span>.<span class="property">length</span>;</span><br><span class="line">            t_load = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                current_len = ap.<span class="property">list</span>.<span class="property">audios</span>.<span class="property">length</span>;</span><br><span class="line">                <span class="keyword">if</span> (current_len &lt; newSongsheetLen) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;current_len: &quot;</span> + current_len);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开始导入&quot;</span>)</span><br><span class="line">                    ctrl.importMusicList();</span><br><span class="line">                    global_music_flag = <span class="number">1</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;导入完毕&quot;</span>)</span><br><span class="line">                    <span class="built_in">clearInterval</span>(t_load);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;console-loading-icon&quot;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">                    ctrl.<span class="title function_">consoleBackBtn</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">50</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        listener = <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//音乐进度更新</span></span><br><span class="line">    <span class="keyword">if</span> (meting_load == <span class="number">0</span> &amp;&amp; global_music_flag == <span class="number">0</span>) ctrl.<span class="title function_">refreshProgress</span>();</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">whenDOMReady</span>(); <span class="comment">// 打开网站先执行一次</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;pjax:complete&quot;</span>, whenDOMReady); <span class="comment">// pjax加载完成（切换页面）后再执行一次</span></span><br></pre></td></tr></table></figure><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="控制中心"><a href="#控制中心" class="headerlink" title="控制中心"></a>控制中心</h3><p>控制中心部分可以查看<a href="https://gavin-chen.top/post/ac62cfd5.html">Hexo+Butterfly博客搭建记录（3）</a></p><h3 id="mPlayer2"><a href="#mPlayer2" class="headerlink" title="mPlayer2"></a>mPlayer2</h3><ol><li>原吸底Aplayer若想隐藏可自行添加CSS</li><li>原来坐下角APlayer的位置我放了一个mPlayer2，是<a href="https://dodododooo.com/note/">dodododooo</a>大佬做的，不仅UI精美，而且功能特别强大，支持QQ音乐、网易云、酷狗三大平台在线搜索歌曲，还有收藏功能。<br>教程超级简单，直接看他的仓库吧。<br><a href="https://github.com/dodododooo/mPlayer2">仓库地址</a><br>效果如下：<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/cY1DY.webp" alt=""></li></ol><h3 id="幻音坊"><a href="#幻音坊" class="headerlink" title="幻音坊"></a>幻音坊</h3><p><a href="https://blog.yeooe.cn/">叶椰子</a>大佬做的，模仿QQ音乐界面风格，颜值拉满！！！直接吹爆好吧！！！！！！！！！！！！！！！！！（原谅我这颜控 &gt;_&lt; ）</p><p>本来打算直接在原音乐页面上改的，但我不是一图流风格，得慢慢调才行。突然看到<a href="https://blog.zhheo.com/">Heo</a>大佬也复刻了一个，而且还是独立的域名，顿时又感觉自己太傻了（脑子真的瓦特了&gt;_&lt;）。于是乎，直接fork了Heo的github仓库，托管到vercel，到cloudflare给它配个二级域名，一套下来两三分钟搞定！</p><p><a href="https://blog.yeooe.cn/post/abd735f.html">叶椰子教程地址</a><br><a href="https://github.com/zhheo/HeoMusic">Heo仓库地址</a><br>效果如下：<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/cYn1U.webp" alt=""></p><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><h3 id="新增歌单列表"><a href="#新增歌单列表" class="headerlink" title="新增歌单列表"></a>新增歌单列表</h3><ol><li>增加了歌单列表，支持歌单切换。</li><li>页面切换添加过渡效果。</li><li>效果图：<br><img src="https://blog-hexo-img.oss-cn-shanghai.aliyuncs.com/dMh4l.webp" alt=""></li></ol>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9/">博客魔改</category>
      
      
      <category domain="https://gavin-chen.top/tags/APlayer/">APlayer</category>
      
      <category domain="https://gavin-chen.top/tags/Butterfly/">Butterfly</category>
      
      
      <comments>https://gavin-chen.top/post/37b27065.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>青山黛</title>
      <link>https://gavin-chen.top/post/cddbd99a.html</link>
      <guid>https://gavin-chen.top/post/cddbd99a.html</guid>
      <pubDate>Thu, 19 Jan 2023 00:15:24 GMT</pubDate>
      
      <description>云边有个小卖部~</description>
      
      
      
      <content:encoded><![CDATA[<ol><li><p>云边有个小卖部，货架上堆着岁月和夕阳，背后就是山。老人靠着躺椅假装睡着，小孩子偷走一块糖。泪水几点钟落地，飞鸟要去向何方。人们聚和离，云朵来又往。讲故事的人，总有一个故事不愿讲。时光飞逝，悄悄话变成纸张。</p><p align="right">——张嘉佳</p></li><li><p>我愿做一枚白昼的月亮<br>不求炫目的荣华<br>不淆世俗的浪潮</p><p align="right">——顾城《白昼的月亮》</p></li><li><p>我想当一个诗人的时候，我就失去了诗，我想当一个人的时候，我就失去了我自己。在你什么也不想要的时候，一切如期而来。</p><p align="right">——顾城《执者失之》</p></li><li><p>你<br>一会看我<br>一会看云<br>我觉得<br>你看我时很远<br>你看云时很近</p><p align="right">——顾城《远和近》</p></li><li><p>你学过的每一样东西<br>你遭受的每一次苦难<br>都会在你一生中的<br>某个时候派上用场</p><p align="right">——菲茨杰拉德</p></li><li><p>围在城里的人想逃出来，站在城外的人想冲进去，婚姻也罢、事业也罢，人生的欲望大都如此。</p><p align="right">——钱钟书《围城》</p></li><li><p>一尘不染不是没有尘埃，而是尘埃任它飞扬，我自做我的阳光。</p><p align="right">——林清玄</p></li><li><p>日出未必意味着光明，太阳也无非是颗辰星而已，只有在我们醒着时，才是真正的破晓。</p><p align="right">——梭罗《瓦尔登湖》</p></li></ol>]]></content:encoded>
      
      
      <category domain="https://gavin-chen.top/categories/%E8%AF%97%E5%92%8C%E8%BF%9C%E6%96%B9/">诗和远方</category>
      
      
      <category domain="https://gavin-chen.top/tags/%E6%83%85%E6%84%9F/">情感</category>
      
      <category domain="https://gavin-chen.top/tags/%E5%93%B2%E5%AD%A6/">哲学</category>
      
      
      <comments>https://gavin-chen.top/post/cddbd99a.html#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
